/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */

define("dijit/layout/BorderContainer","dojo/_base/array dojo/cookie dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/touch ../_WidgetBase ../_Widget ../_TemplatedMixin ./LayoutContainer ./utils".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=n("dijit.layout._Splitter",[h,p],{live:!0,templateString:'<div class="dijitSplitter" data-dojo-attach-event="onkeydown:_onKeyDown,press:_startDrag,onmouseenter:_onMouse,onmouseleave:_onMouse" tabIndex="0" role="separator"><div class="dijitSplitterThumb"></div></div>',constructor:function(){this._handlers=[]},postMixInProperties:function(){this.inherited(arguments),this.horizontal=/top|bottom/.test(this.region),this._factor=/top|left/.test(this.region)?1:-1,this._cookieName=this.container.id+"_"+this.region},buildRendering:function(){this.inherited(arguments),r.add(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V"));if(this.container.persist){var e=t(this._cookieName);e&&(this.child.domNode.style[this.horizontal?"height":"width"]=e)}},_computeMaxSize:function(){var t=this.horizontal?"h":"w",n=s.getMarginBox(this.child.domNode)[t],r=e.filter(this.container.getChildren(),function(e){return"center"==e.region})[0],t=s.getContentBox(r.domNode)[t]-10;return Math.min(this.child.maxSize,n+t)},_startDrag:function(e){this.cover||(this.cover=i.place("<div class=dijitSplitterCover></div>",this.child.domNode,"after")),r.add(this.cover,"dijitSplitterCoverActive"),this.fake&&i.destroy(this.fake),(this._resize=this.live)||((this.fake=this.domNode.cloneNode(!0)).removeAttribute("id"),r.add(this.domNode,"dijitSplitterShadow"),i.place(this.fake,this.domNode,"after")),r.add(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active"),this.fake&&r.remove(this.fake,"dijitSplitterHover dijitSplitter"+(this.horizontal?"H":"V")+"Hover");var t=this._factor,n=this.horizontal,u=n?"pageY":"pageX",c=e[u],h=this.domNode.style,n=n?"h":"w",p=o.getComputedStyle(this.child.domNode),d=s.getMarginBox(this.child.domNode,p)[n],v=this._computeMaxSize(),m=Math.max(this.child.minSize,s.getPadBorderExtents(this.child.domNode,p)[n]+10),n=this.region,g="top"==n||"bottom"==n?"top":"left",y=parseInt(h[g],10),b=this._resize,w=a.hitch(this.container,"_layoutChildren",this.child.id),n=this.ownerDocument;this._handlers=this._handlers.concat([f(n,l.move,this._drag=function(e,n){var r=e[u]-c,i=t*r+d,s=Math.max(Math.min(i,v),m);(b||n)&&w(s),h[g]=r+y+t*(s-i)+"px"}),f(n,"dragstart",function(e){e.stopPropagation(),e.preventDefault()}),f(this.ownerDocumentBody,"selectstart",function(e){e.stopPropagation(),e.preventDefault()}),f(n,l.release,a.hitch(this,"_stopDrag"))]),e.stopPropagation(),e.preventDefault()},_onMouse:function(e){e="mouseover"==e.type||"mouseenter"==e.type,r.toggle(this.domNode,"dijitSplitterHover",e),r.toggle(this.domNode,"dijitSplitter"+(this.horizontal?"H":"V")+"Hover",e)},_stopDrag:function(e){try{this.cover&&r.remove(this.cover,"dijitSplitterCoverActive"),this.fake&&i.destroy(this.fake),r.remove(this.domNode,"dijitSplitterActive dijitSplitter"+(this.horizontal?"H":"V")+"Active dijitSplitterShadow"),this._drag(e),this._drag(e,!0)}finally{this._cleanupHandlers(),delete this._drag}this.container.persist&&t(this._cookieName,this.child.domNode.style[this.horizontal?"height":"width"],{expires:365})},_cleanupHandlers:function(){for(var e;e=this._handlers.pop();)e.remove()},_onKeyDown:function(e){this._resize=!0;var t=this.horizontal,n=1;switch(e.keyCode){case t?u.UP_ARROW:u.LEFT_ARROW:n*=-1;case t?u.DOWN_ARROW:u.RIGHT_ARROW:break;default:return}t=s.getMarginSize(this.child.domNode)[t?"h":"w"]+this._factor*n,this.container._layoutChildren(this.child.id,Math.max(Math.min(t,this._computeMaxSize()),this.child.minSize)),e.stopPropagation(),e.preventDefault()},destroy:function(){this._cleanupHandlers(),delete this.child,delete this.container,delete this.cover,delete this.fake,this.inherited(arguments)}}),g=n("dijit.layout._Gutter",[h,p],{templateString:'<div class="dijitGutter" role="presentation"></div>',postMixInProperties:function(){this.inherited(arguments),this.horizontal=/top|bottom/.test(this.region)},buildRendering:function(){this.inherited(arguments),r.add(this.domNode,"dijitGutter"+(this.horizontal?"H":"V"))}});return n=n("dijit.layout.BorderContainer",d,{gutters:!0,liveSplitters:!0,persist:!1,baseClass:"dijitBorderContainer",_splitterClass:m,postMixInProperties:function(){this.gutters||(this.baseClass+="NoGutter"),this.inherited(arguments)},_setupChild:function(e){this.inherited(arguments);var t=e.region,n=e.isLeftToRight();"leading"==t&&(t=n?"left":"right"),"trailing"==t&&(t=n?"right":"left"),t&&"center"!=t&&(e.splitter||this.gutters)&&!e._splitterWidget&&(n=e.splitter?this._splitterClass:g,a.isString(n)&&(n=a.getObject(n)),n=new n({id:e.id+"_splitter",container:this,child:e,region:t,live:this.liveSplitters}),n.isSplitter=!0,e._splitterWidget=n,t="bottom"==t||t==(this.isLeftToRight()?"right":"left"),i.place(n.domNode,e.domNode,t?"before":"after"),n.startup())},layout:function(){this._layoutChildren()},removeChild:function(e){var t=e._splitterWidget;t&&(t.destroy(),delete e._splitterWidget),this.inherited(arguments)},getChildren:function(){return e.filter(this.inherited(arguments),function(e){return!e.isSplitter})},getSplitter:function(t){return e.filter(this.getChildren(),function(e){return e.region==t})[0]._splitterWidget},resize:function(e,t){if(!this.cs||!this.pe){var n=this.domNode;this.cs=o.getComputedStyle(n),this.pe=s.getPadExtents(n,this.cs),this.pe.r=o.toPixelValue(n,this.cs.paddingRight),this.pe.b=o.toPixelValue(n,this.cs.paddingBottom),o.set(n,"padding","0px")}this.inherited(arguments)},_layoutChildren:function(t,n){if(this._borderBox&&this._borderBox.h){var r=[];e.forEach(this._getOrderedChildren(),function(e){r.push(e),e._splitterWidget&&r.push(e._splitterWidget)}),v.layoutChildren(this.domNode,{l:this.pe.l,t:this.pe.t,w:this._borderBox.w-this.pe.w,h:this._borderBox.h-this.pe.h},r,t,n)}},destroyRecursive:function(){e.forEach(this.getChildren(),function(e){var t=e._splitterWidget;t&&t.destroy(),delete e._splitterWidget}),this.inherited(arguments)}}),n.ChildWidgetProperties={splitter:!1,minSize:0,maxSize:Infinity},a.mixin(n.ChildWidgetProperties,d.ChildWidgetProperties),a.extend(c,n.ChildWidgetProperties),n._Splitter=m,n._Gutter=g,n}),define("dijit/layout/ContentPane","dojo/_base/kernel dojo/_base/lang ../_Widget ../_Container ./_ContentPaneResizeMixin dojo/string dojo/html dojo/i18n!../nls/loading dojo/_base/array dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-construct dojo/_base/xhr dojo/i18n dojo/when".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){return f("dijit.layout.ContentPane",[n,r,i],{href:"",content:"",extractContent:!1,parseOnLoad:!0,parserScope:e._scopeName,preventCache:!1,preload:!1,refreshOnShow:!1,loadingMessage:"<span class='dijitContentPaneLoading'><span class='dijitInline dijitIconLoading'></span>${loadingState}</span>",errorMessage:"<span class='dijitContentPaneError'><span class='dijitInline dijitIconError'></span>${errorState}</span>",isLoaded:!1,baseClass:"dijitContentPane",ioArgs:{},onLoadDeferred:null,_setTitleAttr:null,stopParser:!0,template:!1,markupFactory:function(e,t,n){var r=new n(e,t);return!r.href&&r._contentSetter&&r._contentSetter.parseDeferred&&!r._contentSetter.parseDeferred.isFulfilled()?r._contentSetter.parseDeferred.then(function(){return r}):r},create:function(e,n){if((!e||!e.template)&&n&&!("href"in e)&&!("content"in e)){n=c.byId(n);for(var r=n.ownerDocument.createDocumentFragment();n.firstChild;)r.appendChild(n.firstChild);e=t.delegate(e,{content:r})}this.inherited(arguments,[e,n])},postMixInProperties:function(){this.inherited(arguments);var e=v.getLocalization("dijit","loading",this.lang);this.loadingMessage=s.substitute(this.loadingMessage,e),this.errorMessage=s.substitute(this.errorMessage,e)},buildRendering:function(){this.inherited(arguments),this.containerNode||(this.containerNode=this.domNode),this.domNode.removeAttribute("title")},startup:function(){this.inherited(arguments),this._contentSetter&&a.forEach(this._contentSetter.parseResults,function(e){!e._started&&!e._destroyed&&t.isFunction(e.startup)&&(e.startup(),e._started=!0)},this)},_startChildren:function(){a.forEach(this.getChildren(),function(e){!e._started&&!e._destroyed&&t.isFunction(e.startup)&&(e.startup(),e._started=!0)}),this._contentSetter&&a.forEach(this._contentSetter.parseResults,function(e){!e._started&&!e._destroyed&&t.isFunction(e.startup)&&(e.startup(),e._started=!0)},this)},setHref:function(t){return e.deprecated("dijit.layout.ContentPane.setHref() is deprecated. Use set('href', ...) instead.","","2.0"),this.set("href",t)},_setHrefAttr:function(e){return this.cancel(),this.onLoadDeferred=new l(t.hitch(this,"cancel")),this.onLoadDeferred.then(t.hitch(this,"onLoad")),this._set("href",e),this.preload||this._created&&this._isShown()?this._load():this._hrefChanged=!0,this.onLoadDeferred},setContent:function(t){e.deprecated("dijit.layout.ContentPane.setContent() is deprecated.  Use set('content', ...) instead.","","2.0"),this.set("content",t)},_setContentAttr:function(e){return this._set("href",""),this.cancel(),this.onLoadDeferred=new l(t.hitch(this,"cancel")),this._created&&this.onLoadDeferred.then(t.hitch(this,"onLoad")),this._setContent(e||""),this._isDownloaded=!1,this.onLoadDeferred},_getContentAttr:function(){return this.containerNode.innerHTML},cancel:function(){this._xhrDfd&&-1==this._xhrDfd.fired&&this._xhrDfd.cancel(),delete this._xhrDfd,this.onLoadDeferred=null},destroy:function(){this.cancel(),this.inherited(arguments)},destroyRecursive:function(e){this._beingDestroyed||this.inherited(arguments)},_onShow:function(){this.inherited(arguments);if(this.href&&!this._xhrDfd&&(!this.isLoaded||this._hrefChanged||this.refreshOnShow))return this.refresh()},refresh:function(){return this.cancel(),this.onLoadDeferred=new l(t.hitch(this,"cancel")),this.onLoadDeferred.then(t.hitch(this,"onLoad")),this._load(),this.onLoadDeferred},_load:function(){this._setContent(this.onDownloadStart(),!0);var e=this,n={preventCache:this.preventCache||this.refreshOnShow,url:this.href,handleAs:"text"};t.isObject(this.ioArgs)&&t.mixin(n,this.ioArgs);var r=this._xhrDfd=(this.ioMethod||d.get)(n),i;r.then(function(t){i=t;try{return e._isDownloaded=!0,e._setContent(t,!1)}catch(n){e._onError("Content",n)}},function(t){return r.canceled||e._onError("Download",t),delete e._xhrDfd,t}).then(function(){return e.onDownloadEnd(),delete e._xhrDfd,i}),delete this._hrefChanged},_onLoadHandler:function(e){this._set("isLoaded",!0);try{this.onLoadDeferred.resolve(e)}catch(t){console.error("Error "+this.widgetId+" running custom onLoad code: "+t.message)}},_onUnloadHandler:function(){this._set("isLoaded",!1);try{this.onUnload()}catch(e){console.error("Error "+this.widgetId+" running custom onUnload code: "+e.message)}},destroyDescendants:function(e){this.isLoaded&&this._onUnloadHandler();var t=this._contentSetter;a.forEach(this.getChildren(),function(t){t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e),t._destroyed=!0}),t&&(a.forEach(t.parseResults,function(t){t._destroyed||(t.destroyRecursive?t.destroyRecursive(e):t.destroy&&t.destroy(e),t._destroyed=!0)}),delete t.parseResults),e||p.empty(this.containerNode),delete this._singleChild},_setContent:function(e,n){this.destroyDescendants();var r=this._contentSetter;r&&r instanceof o._ContentSetter||(r=this._contentSetter=new o._ContentSetter({node:this.containerNode,_onError:t.hitch(this,this._onError),onContentError:t.hitch(this,function(e){e=this.onContentError(e);try{this.containerNode.innerHTML=e}catch(t){console.error("Fatal "+this.id+" could not change content due to "+t.message,t)}})}));var i=t.mixin({cleanContent:this.cleanContent,extractContent:this.extractContent,parseContent:!e.domNode&&this.parseOnLoad,parserScope:this.parserScope,startup:!1,dir:this.dir,lang:this.lang,textDir:this.textDir},this._contentSetterParams||{}),i=r.set(t.isObject(e)&&e.domNode?e.domNode:e,i),s=this;return m(i&&i.then?i:r.parseDeferred,function(){delete s._contentSetterParams,n||(s._started&&(s._startChildren(),s._scheduleLayout()),s._onLoadHandler(e))})},_onError:function(e,t,n){this.onLoadDeferred.reject(t),e=this["on"+e+"Error"].call(this,t),n?console.error(n,t):e&&this._setContent(e,!0)},onLoad:function(){},onUnload:function(){},onDownloadStart:function(){return this.loadingMessage},onContentError:function(){},onDownloadError:function(){return this.errorMessage},onDownloadEnd:function(){}})}),define("dgrid/Grid","dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(e,t,n,r,i,s,o){function u(e,t){t&&t.nodeType&&e.appendChild(t)}function a(e,t,n,r){if(this.formatter){r=this.formatter;var i=this.grid.formatterScope;n.innerHTML="string"==typeof r&&i?i[r](t,e):r(t,e)}else null!=t&&n.appendChild(document.createTextNode(t))}var f=8>r("ie")&&!r("quirks"),l=/[^\._a-zA-Z0-9-]/g;return t=t("dgrid.Grid",s,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(e){return"object"!=typeof e?this.columns[e]:this.cell(e).column},listType:"grid",cell:function(e,t){if(e.column&&e.element)return e;e.target&&e.target.nodeType&&(e=e.target);var n;if(e.nodeType)do{if(this._rowIdToObject[e.id])break;var r=e.columnId;if(r){t=r,n=e;break}e=e.parentNode}while(e&&e!=this.domNode);if(!n&&"undefined"!=typeof t){var i=this.row(e);if(r=i&&i.element)for(var r=r.getElementsByTagName("td"),s=0;s<r.length;s++)if(r[s].columnId==t){n=r[s];break}}if(null!=e)return{row:i||this.row(e),column:t&&this.column(t),element:n}},createRowCells:function(e,t,n){var s=i("table.dgrid-row-table[role=presentation]"),o=9>r("ie")||r("quirks")?i(s,"tbody"):s,u,a,c,p,d,v,m,g,y,b;n=n||this.subRows,a=0;for(c=n.length;a<c;a++){v=n[a],u=i(o,"tr"),v.className&&i(u,"."+v.className),p=0;for(d=v.length;p<d;p++){m=v[p],g=m.id,y=m.className||m.field&&"field-"+m.field,y=i(e+(".dgrid-cell.dgrid-cell-padding"+(g?".dgrid-column-"+g:"")+(y?"."+y:"")).replace(l,"-")+"[role="+("th"===e?"columnheader":"gridcell")+"]"),y.columnId=g,f?(g=i(y,"!dgrid-cell-padding div.dgrid-cell-padding"),y.contents=g):g=y;if(b=m.colSpan)y.colSpan=b;if(b=m.rowSpan)y.rowSpan=b;t(g,m),u.appendChild(y)}}return s},left:function(e,t){return e.element||(e=this.cell(e)),this.cell(this._move(e,-(t||1),"dgrid-cell"))},right:function(e,t){return e.element||(e=this.cell(e)),this.cell(this._move(e,t||1,"dgrid-cell"))},renderRow:function(e,t){var n=this.createRowCells("td",function(n,r){var i=e;r.get?i=r.get(e):"field"in r&&"_item"!=r.field&&(i=i[r.field]),r.renderCell?u(n,r.renderCell(e,i,n,t)):a.call(r,e,i,n,t)},t&&t.subRows);return i("div[role=row]>",n)},renderHeader:function(){var e=this,t=this.headerNode,s=t.childNodes.length;for(t.setAttribute("role","row");s--;)i(t.childNodes[s],"!");s=this.createRowCells("th",function(e,t){var n=t.headerNode=e;f&&(e=e.parentNode);var r=t.field;r&&(e.field=r),t.renderHeaderCell?u(n,t.renderHeaderCell(n)):("label"in t||t.field)&&n.appendChild(document.createTextNode("label"in t?t.label:t.field)),!1!==t.sortable&&r&&"_item"!=r&&(e.sortable=!0,e.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows),this._rowIdToObject[s.id=this.id+"-header"]=this.columns,t.appendChild(s),this._sortListener&&this._sortListener.remove(),this._sortListener=n(s,"click,keydown",function(i){if("click"==i.type||32==i.keyCode||!r("opera")&&13==i.keyCode){var s=i.target,o,u,a;do if(s.sortable){a=[{attribute:o=s.field||s.columnId,descending:(u=e._sort[0])&&u.attribute==o&&!u.descending}],o={bubbles:!0,cancelable:!0,grid:e,parentType:i.type,sort:a},n.emit(i.target,"dgrid-sort",o)&&(e._sortNode=s,e.set("sort",a));break}while((s=s.parentNode)&&s!=t)}})},resize:function(){var e=this.headerNode.firstChild,t=this.contentNode,n;this.inherited(arguments);if(!r("ie")||7<r("ie")&&!r("quirks"))if(t.style.width="",t&&e&&(n=e.offsetWidth)!=t.offsetWidth)t.style.width=n+"px"},destroy:function(){this._destroyColumns(),this._sortListener&&this._sortListener.remove(),this.inherited(arguments)},_setSort:function(e,t){this.inherited(arguments),this.updateSortArrow(this._sort)},updateSortArrow:function(e,t){this._lastSortedArrow&&(i(this._lastSortedArrow,"<!dgrid-sort-up!dgrid-sort-down"),i(this._lastSortedArrow,"!"),delete this._lastSortedArrow),t&&(this._sort=e);if(e[0]){var n=e[0].attribute,r=e[0].descending,s=this._sortNode,o,u,a;delete this._sortNode;if(!s)for(a in o=this.columns,o)if(u=o[a],u.field==n){s=u.headerNode;break}s&&(s=s.contents||s,this._lastSortedArrow=i(s.firstChild,"-div.dgrid-sort-arrow.ui-icon[role=presentation]"),this._lastSortedArrow.innerHTML="&nbsp;",i(s,r?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(e,t){return this.addCssRule("#"+o.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+e,t)},_configColumns:function(e,t){var n=[],r=t instanceof Array;return o.each(t,function(i,s){"string"==typeof i&&(t[s]=i={label:i}),!r&&!i.field&&(i.field=s),s=i.id=i.id||(isNaN(s)?s:e+s),r&&(this.columns[s]=i),this._configColumn&&this._configColumn(i,s,t,e),i.grid=this,"function"==typeof i.init&&i.init(),n.push(i)},this),r?t:n},_destroyColumns:function(){var e=this.subRows,t=e&&e.length,n,r,i,s;this.cleanup();for(n=0;n<t;n++){r=0;for(s=e[n].length;r<s;r++)i=e[n][r],"function"==typeof i.destroy&&i.destroy()}},configStructure:function(){var e=this.subRows,t=this._columns=this.columns;this.columns=!t||t instanceof Array?{}:t;if(e)for(t=0;t<e.length;t++)e[t]=this._configColumns(t+"-",e[t]);else this.subRows=[this._configColumns("",t)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(e){this._destroyColumns(),this.subRows=null,this.columns=e,this._updateColumns()},_setSubRows:function(e){this._destroyColumns(),this.subRows=e,this._updateColumns()},setColumns:function(t){e.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4"),this.set("columns",t)},setSubRows:function(t){e.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4"),this.set("subRows",t)},_updateColumns:function(){this.configStructure(),this.renderHeader(),this.refresh(),this._lastCollection&&this.renderArray(this._lastCollection),this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}}),t.appendIfNode=u,t.defaultRenderCell=a,t}),define("dgrid/editor","dojo/_base/kernel dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/on dojo/aspect dojo/has dojo/query ./Grid put-selector/put dojo/_base/sniff".split(" "),function(e,t,n,r,i,s,o,u,a,f){function l(e,t){e.value=t;if("radio"==e.type||"checkbox"==e.type)e.checked=e.defaultChecked=!!t}function c(e,t){if("number"==typeof t)e=isNaN(e)?e:parseFloat(e);else if("boolean"==typeof t)e="true"==e?!0:"false"==e?!1:e;else if(t instanceof Date){var n=new Date(e);e=isNaN(n.getTime())?e:n}return e}function h(e,t,n,r,s){var o,u,a;if((n&&n.valueOf())!=(r&&r.valueOf())&&(o=e.cell(t),u=o.row,a=o.column,a.field&&u)){if(o={grid:e,cell:o,rowId:u.id,oldValue:n,value:r,bubbles:!0,cancelable:!0},s&&s.type&&(o.parentType=s.type),!i.emit(t,"dgrid-datachange",o)){var f;return(f=t.widget)?(f._dgridIgnoreChange=!0,f.set("value",n),setTimeout(function(){f._dgridIgnoreChange=!1},0)):(f=t.input)&&l(f,n),n}e.updateDirty?(e.updateDirty(u.id,a.field,r),a.autoSave&&setTimeout(function(){e._trackError("save")},0)):u.data[a.field]=r}return r}function p(e,t,n,r){var i;if(!n.isValid||n.isValid())if(r=h(e,(n.domNode||n).parentNode,y?b:n._dgridLastValue,"function"==typeof n.get?c(n.get("value")):c(n["checkbox"==n.type||"radio"==n.type?"checked":"value"]),r),y?b=r:n._dgridLastValue=r,"radio"===n.type&&n.name&&!t.editOn&&t.field)for(i in r=e.row(n),u("input[type=radio][name="+n.name+"]",e.contentNode).forEach(function(r){var i=e.row(r);r!==n&&r._dgridLastValue&&(r._dgridLastValue=!1,e.updateDirty?e.updateDirty(i.id,t.field,!1):i.data[t.field]=!1)}),e.dirty)r.id!==i&&e.dirty[i][t.field]&&e.updateDirty(i,t.field,!1)}function d(e){var n=e.editor,r=e.editOn,s=e.grid,u="string"!=typeof n,a,l,c;a=e.editorArgs||{},"function"==typeof a&&(a=a.call(s,e));if(u)l=new n(a),u=l.focusNode||l.domNode,u.className+=" dgrid-input",l.connect(l,r?"onBlur":"onChange",function(){l._dgridIgnoreChange||p(s,e,this,{type:"widget"})});else if(c=function(t){var n=t.target;"_dgridLastValue"in n&&-1<n.className.indexOf("dgrid-input")&&p(s,e,n,t)},e.grid._hasInputListener||(s._hasInputListener=!0,s.on("change",function(e){c(e)})),l=u=f(("textarea"==n?"textarea":"input[type="+n+"]")+".dgrid-input",t.mixin({name:e.field,tabIndex:isNaN(e.tabIndex)?-1:e.tabIndex},a)),9>o("ie")||o("ie")&&o("quirks"))"radio"==n||"checkbox"==n?i(l,"click",function(e){c(e)}):i(l,"change",function(e){c(e)});return i(u,"mousedown",function(e){e.stopPropagation()}),l}function v(e,n){function r(){var e=y;v.blur(),"function"==typeof u.focus&&setTimeout(function(){u.focus(e)},c&&9>o("ie")?15:0)}var s=d(e),u=e.grid,c=s.domNode,h=s.domNode||s,v=s.focusNode||h,m=c?function(){s.set("value",s._dgridLastValue)}:function(){l(s,s._dgridLastValue),p(e.grid,e,s)};return i(v,"keydown",function(t){t=t.keyCode||t.which,27==t?(m(),b=s._dgridLastValue,r()):13==t&&!1!==e.dismissOnEnter&&r()}),(e._editorBlurHandle=i.pausable(s,"blur",function(){var n=h.parentNode,r=n.children.length-1,o={alreadyHooked:!0},l=u.cell(h);i.emit(l.element,"dgrid-editor-hide",{grid:u,cell:l,column:e,editor:s,bubbles:!0,cancelable:!1}),e._editorBlurHandle.pause(),n.removeChild(h);for(f(l.element,"!dgrid-cell-editing");r--;)f(n.firstChild,"!");a.appendIfNode(n,e.renderCell(e.grid.row(n).data,b,n,w?t.delegate(o,w):o)),y=b=w=null})).pause(),s}function m(e,t,n,r){var s=e.domNode,o=t.grid;s||l(e,r),n.innerHTML="",f(n,".dgrid-cell-editing"),f(n,e.domNode||e),s&&(e._started||e.startup(),e._dgridIgnoreChange=!0,e.set("value",r),setTimeout(function(){e._dgridIgnoreChange=!1},0)),e._dgridLastValue=r,y&&(b=r,i.emit(n,"dgrid-editor-show",{grid:o,cell:o.cell(n),column:t,editor:e,bubbles:!0,cancelable:!1}))}function g(e){var t,n,i,s,o,u;e.column||(e=this.cell(e));if(!e||!e.element)return null;t=e.column,s=t.field,n=e.element.contents||e.element;if(o=t.editorInstance){if(y!=n&&(!t.canEdit||t.canEdit(e.row.data,i)))return y=n,e=e.row,i=(i=this.dirty&&this.dirty[e.id])&&s in i?i[s]:t.get?t.get(e.data):e.data[s],m(t.editorInstance,t,n,i),u=new r,setTimeout(function(){o.focus&&o.focus(),t._editorBlurHandle&&t._editorBlurHandle.resume(),u.resolve(o)},0),u.promise}else if(t.editor&&(o=n.widget||n.input))return u=new r,o.focus&&o.focus(),u.resolve(o),u.promise;return null}var y,b,w;return t.getObject("dgrid.editor",!0),dgrid.editor=function(t,r,o){var u=t.renderCell||a.defaultRenderCell,f=[],l;return t||(t={}),t.editor=r=r||t.editor||"text",t.editOn=o=o||t.editOn,l="string"!=typeof r,t.widgetArgs&&(e.deprecated("column.widgetArgs","use column.editorArgs instead","dgrid 0.4"),t.editorArgs=t.widgetArgs),s.after(t,"init",o?function(){var e=t.grid;e.edit||(e.edit=g),t.editorInstance=v(t,u)}:function(){var e=t.grid;e.edit||(e.edit=g),l&&f.push(s.before(e,"removeRow",function(n){(n=(n=e.cell(n,t.id).element)&&(n.contents||n).widget)&&n.destroyRecursive()}))}),s.after(t,"destroy",function(){n.forEach(f,function(e){e.remove()}),t._editorBlurHandle&&t._editorBlurHandle.remove(),o&&l&&t.editorInstance.destroyRecursive()}),t.renderCell=o?function(e,n,r,s){return(!s||!s.alreadyHooked)&&i("TD"==r.tagName?r:r.parentNode,o,function(){w=s,t.grid.edit(this)}),u.call(t,e,n,r,s)}:function(e,n,r,i){if(!!t.canEdit&&!t.canEdit(e,n))return u.call(t,e,n,r,i);e=d(t),m(e,t,r,n),r[l?"widget":"input"]=e},t}}),define("dgrid/extensions/ColumnResizer","dojo/_base/declare dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-geometry dojo/has ../util/misc put-selector/put dojo/_base/html xstyle/css!../css/extensions/ColumnResizer.css".split(" "),function(e,t,n,r,i,s,o,u,a){function f(e){for(var t=e.length,n=t,r=e[0].length,i=Array(t);t--;)i[t]=Array(r);for(var s={},t=0;t<n;t++)for(var o=i[t],u=e[t],a=0,f=0;a<r;a++){var l=u[f],c;if("undefined"==typeof o[a]){o[a]=l.id;if(l.rowSpan&&1<l.rowSpan){c=i;for(var h=l.rowSpan,p=t,d=a,v=l.id,m=1;m<h;m++)c[p+m][d]=v}if(0<t&&l.colSpan&&1<l.colSpan)for(c=1;c<l.colSpan;c++)if(o[++a]=l.id,l.rowSpan&&1<l.rowSpan)for(var h=i,p=l.rowSpan,d=t,v=a,m=l.id,g=1;g<p;g++)h[d+g][v]=m;s[l.id]=e[0][a].id,f++}}return s}function l(e,n,r,i){if(!(0>=r)){var s=e.columns[n],o={grid:e,columnId:n,width:r,bubbles:!0,cancelable:!0};i&&(o.parentType=i);if(!e._resizedColumns||t.emit(e.headerNode,"dgrid-columnresize",o))return"auto"===r?delete s.width:(s.width=r,r+="px"),(i=e._columnSizes[n])?i.set("width",r):i=u.addCssRule("#"+u.escapeCssIdentifier(e.domNode.id)+" .dgrid-column-"+n,"width: "+r+";"),e._columnSizes[n]=i,e.resize(),!0}}var c,h=0,p={create:function(){c=a("div.dgrid-column-resizer")},destroy:function(){a(c,"!"),c=null},show:function(e){e=s.position(e.domNode,!0),c.style.top=e.y+"px",c.style.height=e.h+"px",a(document.body,c)},move:function(e){c.style.left=e+"px"},hide:function(){c.parentNode.removeChild(c)}};return e("dgrid.extensions.ColumnResizer",null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments),h++||p.create()},destroy:function(){this.inherited(arguments);for(var e in this._columnSizes)this._columnSizes[e].remove();--h||p.destroy()},resizeColumnWidth:function(e,t){return l(this,e,t)},configStructure:function(){var e=this._oldColumnSizes=r.mixin({},this._columnSizes),t;this._resizedColumns=!1,this._columnSizes={},this.inherited(arguments);for(t in e)t in this._columnSizes||e[t].remove();delete this._oldColumnSizes},_configColumn:function(e){this.inherited(arguments);var t=e.id,n;"width"in e&&((n=this._oldColumnSizes[t])?n.set("width",e.width+"px"):n=u.addCssRule("#"+this.domNode.id+" .dgrid-column-"+t,"width: "+e.width+"px;"),this._columnSizes[t]=n)},renderHeader:function(){this.inherited(arguments);var e=this,i;if(this.columnSets&&this.columnSets.length)for(var s=this.columnSets.length;s--;)i=r.mixin(i||{},f(this.columnSets[s]));else this.subRows&&1<this.subRows.length&&(i=f(this.subRows));for(var s=n(".dgrid-cell",e.headerNode),l=s.length;l--;){var c=s[l],h=c.columnId,p=e.columns[h],d=c.childNodes;if(p&&!1!==p.resizable){p=a("div.dgrid-resize-header-container");for(c.contents=p;0<d.length;)a(p,d[0]);a(c,p,"div.dgrid-resize-handle.resizeNode-"+h).columnId=i?i[h]:h}}e.mouseMoveListen||(t(e.headerNode,".dgrid-resize-handle:mousedown"+(o("touch")?",.dgrid-resize-handle:touchstart":""),function(t){e._resizeMouseDown(t,this),e.mouseMoveListen.resume(),e.mouseUpListen.resume()}),e._listeners.push(e.mouseMoveListen=t.pausable(document,"mousemove"+(o("touch")?",touchmove":""),u.throttleDelayed(function(t){e._updateResizerPosition(t)}))),e._listeners.push(e.mouseUpListen=t.pausable(document,"mouseup"+(o("touch")?",touchend":""),function(t){e._resizeMouseUp(t),e.mouseMoveListen.pause(),e.mouseUpListen.pause()})),e.mouseMoveListen.pause(),e.mouseUpListen.pause())},_resizeMouseDown:function(e,t){e.preventDefault(),i.setSelectable(this.domNode,!1),this._startX=this._getResizeMouseLocation(e),this._targetCell=n(".dgrid-column-"+t.columnId,this.headerNode)[0],this._updateResizerPosition(e),p.show(this)},_resizeMouseUp:function(e){var t=this._columnSizes,r,s,o;this.adjustLastColumn&&(o=this.headerNode.clientWidth-1),this._resizedColumns||(r=n(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?r=r.filter(function(e){return"0"==e.columnId.split("-")[0]&&!(e.columnId in t)}):this.subRows&&1<this.subRows.length&&(r=r.filter(function(e){return"0"==e.columnId.charAt(0)&&!(e.columnId in t)})),s=r.map(function(e){return e.offsetWidth}),r.forEach(function(e,t){this.resizeColumnWidth(e.columnId,s[t])},this),this._resizedColumns=!0),i.setSelectable(this.domNode,!0),r=this._targetCell;var u=this._getResizeMouseLocation(e)-this._startX,a=r.offsetWidth+u,f=this._getResizedColumnWidths(),c=f.totalWidth,f=f.lastColId,h=n(".dgrid-column-"+f,this.headerNode)[0].offsetWidth;a<this.minWidth&&(a=this.minWidth),l(this,r.columnId,a,e.type)&&r.columnId!=f&&this.adjustLastColumn&&(c+u<o?l(this,f,"auto",e.type):h-u<=this.minWidth&&l(this,f,this.minWidth,e.type)),p.hide(),delete this._startX,delete this._targetCell},_updateResizerPosition:function(e){if(this._targetCell){e=this._getResizeMouseLocation(e);var t=this._targetCell.offsetWidth,n=e;t+(e-this._startX)<this.minWidth&&(n=this._startX-(t-this.minWidth)),p.move(n)}},_getResizeMouseLocation:function(e){var t=0;return e.pageX?t=e.pageX:e.clientX&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft),t},_getResizedColumnWidths:function(){var e=0,t=n(".dgrid-cell",this.headerNode);this.columnSets&&this.columnSets.length?t=t.filter(function(e){return"0"==e.columnId.split("-")[1]}):this.subRows&&1<this.subRows.length&&(t=t.filter(function(e){return"0"==e.columnId.charAt(0)}));var r=t.length;if(!r)return{};for(var i=t[r-1].columnId;r--;)e+=t[r].offsetWidth;return{totalWidth:e,lastColId:i}}})}),define("dojo/_base/config",["../has","require"],function(e,t){var n={},r=t.rawConfig,i;for(i in r)n[i]=r[i];return!n.locale&&"undefined"!=typeof navigator&&(n.locale=(navigator.language||navigator.userLanguage).toLowerCase()),n}),define("dojo/_base/kernel",["../has","./config","require","module"],function(e,t,n,r){var i,s={},o={},u={config:t,global:this,dijit:s,dojox:o},s={dojo:["dojo",u],dijit:["dijit",s],dojox:["dojox",o]};r=n.map&&n.map[r.id.match(/[^\/]+/)[0]];for(i in r)s[i]?s[i][0]=r[i]:s[i]=[r[i],{}];for(i in s)r=s[i],r[1]._scopeName=r[0],t.noGlobals||(this[r[0]]=r[1]);u.scopeMap=s,u.baseUrl=u.config.baseUrl=n.baseUrl,u.isAsync=n.async,u.locale=t.locale,r="$Rev: 43d05c6 $".match(/\d+/),u.version={major:1,minor:9,patch:1,flag:"",revision:r?+r[0]:NaN,toString:function(){var e=u.version;return e.major+"."+e.minor+"."+e.patch+e.flag+" ("+e.revision+")"}},Function("d","d.eval = function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(u),u.exit=function(){},"undefined"!=typeof console||(console={});var s="assert count debug dir dirxml error group groupEnd info profile profileEnd time timeEnd trace warn log".split(" "),a;for(r=0;a=s[r++];)console[a]||function(){var e=a+"";console[e]="log"in console?function(){var t=Array.apply({},arguments);t.unshift(e+":"),console.log(t.join(" "))}:function(){},console[e]._fake=!0}();e.add("dojo-debug-messages",!!t.isDebug),u.deprecated=u.experimental=function(){},e("dojo-debug-messages")&&(u.deprecated=function(e,t,n){e="DEPRECATED: "+e,t&&(e+=" "+t),n&&(e+=" -- will be removed in version: "+n),console.warn(e)},u.experimental=function(e,t){var n="EXPERIMENTAL: "+e+" -- APIs subject to change without notice.";t&&(n+=" "+t),console.warn(n)});if(t.modulePaths){u.deprecated("dojo.modulePaths","use paths configuration"),e={};for(i in t.modulePaths)e[i.replace(/\./g,"/")]=t.modulePaths[i];n({paths:e})}return u.moduleUrl=function(e,t){u.deprecated("dojo.moduleUrl()","use require.toUrl","2.0");var r=null;return e&&(r=n.toUrl(e.replace(/\./g,"/")+(t?"/"+t:"")+"/*.*").replace(/\/\*\.\*/,"")+(t?"":"/")),r},u._hasResource={},u}),define("dojo/sniff",["./has"],function(e){var t=navigator,n=t.userAgent,r=t.appVersion,t=parseFloat(r);e.add("air",0<=n.indexOf("AdobeAIR")),e.add("msapp",parseFloat(n.split("MSAppHost/")[1])||void 0),e.add("khtml",0<=r.indexOf("Konqueror")?t:void 0),e.add("webkit",parseFloat(n.split("WebKit/")[1])||void 0),e.add("chrome",parseFloat(n.split("Chrome/")[1])||void 0),e.add("safari",0<=r.indexOf("Safari")&&!e("chrome")?parseFloat(r.split("Version/")[1]):void 0),e.add("mac",0<=r.indexOf("Macintosh")),e.add("quirks","BackCompat"==document.compatMode);if(n.match(/(iPhone|iPod|iPad)/)){var i=RegExp.$1.replace(/P/,"p"),s=n.match(/OS ([\d_]+)/)?RegExp.$1:"1",s=parseFloat(s.replace(/_/,".").replace(/_/g,""));e.add(i,s),e.add("ios",s)}return e.add("android",parseFloat(n.split("Android ")[1])||void 0),e.add("bb",(0<=n.indexOf("BlackBerry")||0<=n.indexOf("BB10"))&&parseFloat(n.split("Version/")[1])||void 0),e.add("svg","undefined"!=typeof SVGAngle),e("webkit")||(0<=n.indexOf("Opera")&&e.add("opera",9.8<=t?parseFloat(n.split("Version/")[1])||t:t),i=0,document.all&&!e("opera")?i=parseFloat(r.split("MSIE ")[1])||void 0:r.indexOf("Trident")&&(i=parseFloat(r.split("rv:")[1])||void 0),i&&((r=document.documentMode)&&5!=r&&Math.floor(i)!=r&&(i=r),e.add("ie",i)),!e("ie")&&0<=n.indexOf("Gecko")&&!e("khtml")&&!e("webkit")&&e.add("mozilla",t),e("mozilla")&&e.add("ff",parseFloat(n.split("Firefox/")[1]||n.split("Minefield/")[1])||void 0),e.add("wii","undefined"!=typeof opera&&opera.wiiremote)),e}),define("dojo/_base/lang",["./kernel","../has","../sniff"],function(e,t){t.add("bug-for-in-skips-shadowed",function(){for(var e in{toString:1})return 0;return 1});var n=t("bug-for-in-skips-shadowed")?"hasOwnProperty valueOf isPrototypeOf propertyIsEnumerable toLocaleString toString constructor".split(" "):[],r=n.length,i=function(t,n,r){var i,s=0,o=e.global;if(!r){if(!t.length)return o;i=t[s++];try{r=e.scopeMap[i]&&e.scopeMap[i][1]}catch(u){}r=r||(i in o?o[i]:n?o[i]={}:void 0)}for(;r&&(i=t[s++]);)r=i in r?r[i]:n?r[i]={}:void 0;return r},s=Object.prototype.toString,o=function(e,t,n){return(n||[]).concat(Array.prototype.slice.call(e,t||0))},u=/\{([^\}]+)\}/g,a={_extraNames:n,_mixin:function(e,i,s){var o,u,a,f={};for(o in i)if(u=i[o],!(o in e)||e[o]!==u&&(!(o in f)||f[o]!==u))e[o]=s?s(u):u;if(t("bug-for-in-skips-shadowed")&&i)for(a=0;a<r;++a)if(o=n[a],u=i[o],!(o in e)||e[o]!==u&&(!(o in f)||f[o]!==u))e[o]=s?s(u):u;return e},mixin:function(e,t){e||(e={});for(var n=1,r=arguments.length;n<r;n++)a._mixin(e,arguments[n]);return e},setObject:function(e,t,n){var r=e.split(".");return e=r.pop(),(n=i(r,!0,n))&&e?n[e]=t:void 0},getObject:function(e,t,n){return i(e.split("."),t,n)},exists:function(e,t){return void 0!==a.getObject(e,!1,t)},isString:function(e){return"string"==typeof e||e instanceof String},isArray:function(e){return e&&(e instanceof Array||"array"==typeof e)},isFunction:function(e){return"[object Function]"===s.call(e)},isObject:function(e){return void 0!==e&&(null===e||"object"==typeof e||a.isArray(e)||a.isFunction(e))},isArrayLike:function(e){return e&&void 0!==e&&!a.isString(e)&&!a.isFunction(e)&&(!e.tagName||"form"!=e.tagName.toLowerCase())&&(a.isArray(e)||isFinite(e.length))},isAlien:function(e){return e&&!a.isFunction(e)&&/\{\s*\[native code\]\s*\}/.test(String(e))},extend:function(e,t){for(var n=1,r=arguments.length;n<r;n++)a._mixin(e.prototype,arguments[n]);return e},_hitchArgs:function(t,n){var r=a._toArray(arguments,2),i=a.isString(n);return function(){var s=a._toArray(arguments),o=i?(t||e.global)[n]:n;return o&&o.apply(t||this,r.concat(s))}},hitch:function(t,n){if(2<arguments.length)return a._hitchArgs.apply(e,arguments);n||(n=t,t=null);if(a.isString(n)){t=t||e.global;if(!t[n])throw['lang.hitch: scope["',n,'"] is null (scope="',t,'")'].join("");return function(){return t[n].apply(t,arguments||[])}}return t?function(){return n.apply(t,arguments||[])}:n},delegate:function(){function e(){}return function(t,n){e.prototype=t;var r=new e;return e.prototype=null,n&&a._mixin(r,n),r}}(),_toArray:t("ie")?function(){function e(e,t,n){n=n||[];for(t=t||0;t<e.length;t++)n.push(e[t]);return n}return function(t){return(t.item?e:o).apply(this,arguments)}}():o,partial:function(t){return a.hitch.apply(e,[null].concat(a._toArray(arguments)))},clone:function(e){if(!e||"object"!=typeof e||a.isFunction(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return RegExp(e);var t,n,r;if(a.isArray(e)){t=[],n=0;for(r=e.length;n<r;++n)n in e&&t.push(a.clone(e[n]))}else t=e.constructor?new e.constructor:{};return a._mixin(t,e,a.clone)},trim:String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(e,t,n){return e.replace(n||u,a.isFunction(t)?t:function(e,n){return a.getObject(n,!1,t)})}};return a.mixin(e,a),a}),define("dojo/_base/declare",["./kernel","../has","./lang"],function(e,t,n){function r(e,t){throw Error("declare"+(t?" "+t:"")+": "+e)}function i(e,t,n){var i,s,o,u,a,f,l,c=this._inherited=this._inherited||{};"string"==typeof e&&(i=e,e=t,t=n),n=0,u=e.callee,(i=i||u.nom)||r("can't deduce a name to call inherited()",this.declaredClass),a=this.constructor._meta,o=a.bases,l=c.p;if(i!=x){if(c.c!==u&&(l=0,f=o[0],a=f._meta,a.hidden[i]!==u)){(s=a.chains)&&"string"==typeof s[i]&&r("calling chained method with inherited: "+i,this.declaredClass);do if(a=f._meta,s=f.prototype,a&&(s[i]===u&&s.hasOwnProperty(i)||a.hidden[i]===u))break;while(f=o[++l]);l=f?l:-1}if(f=o[++l])if(s=f.prototype,f._meta&&s.hasOwnProperty(i))n=s[i];else{u=b[i];do if(s=f.prototype,(n=s[i])&&(f._meta?s.hasOwnProperty(i):n!==u))break;while(f=o[++l])}n=f&&n||b[i]}else{if(c.c!==u&&(l=0,(a=o[0]._meta)&&a.ctor!==u)){s=a.chains;for((!s||"manual"!==s.constructor)&&r("calling chained constructor with inherited",this.declaredClass);(f=o[++l])&&(!(a=f._meta)||a.ctor!==u););l=f?l:-1}for(;(f=o[++l])&&!(n=(a=f._meta)?a.ctor:f););n=f&&n}c.c=n,c.p=l;if(n)return!0===t?n:n.apply(this,t||e)}function s(e,t){return"string"==typeof e?this.__inherited(e,t,!0):this.__inherited(e,!0)}function o(e,t,n){var r=this.getInherited(e,t);if(r)return r.apply(this,n||t||e)}function u(e){for(var t=this.constructor._meta.bases,n=0,r=t.length;n<r;++n)if(t[n]===e)return!0;return this instanceof e}function a(e,r){for(var i in r)i!=x&&r.hasOwnProperty(i)&&(e[i]=r[i]);if(t("bug-for-in-skips-shadowed"))for(var s=n._extraNames,o=s.length;o;)i=s[--o],i!=x&&r.hasOwnProperty(i)&&(e[i]=r[i])}function f(e){return g.safeMixin(this.prototype,e),this}function l(e,t){return g([this].concat(e),t||{})}function c(e,t){return function(){var n=arguments,r=n,i=n[0],s,o;o=e.length;var u;if(!(this instanceof n.callee))return m(n);if(t&&(i&&i.preamble||this.preamble)){u=Array(e.length),u[0]=n;for(s=0;;){(i=n[0])&&(i=i.preamble)&&(n=i.apply(this,n)||n),i=e[s].prototype,(i=i.hasOwnProperty("preamble")&&i.preamble)&&(n=i.apply(this,n)||n);if(++s==o)break;u[s]=n}}for(s=o-1;0<=s;--s)i=e[s],(i=(o=i._meta)?o.ctor:i)&&i.apply(this,u?u[s]:n);(i=this.postscript)&&i.apply(this,r)}}function h(e,t){return function(){var n=arguments,r=n,i=n[0];if(!(this instanceof n.callee))return m(n);t&&(i&&(i=i.preamble)&&(r=i.apply(this,r)||r),(i=this.preamble)&&i.apply(this,r)),e&&e.apply(this,n),(i=this.postscript)&&i.apply(this,n)}}function p(e){return function(){var t=arguments,n=0,r,i;if(!(this instanceof t.callee))return m(t);for(;r=e[n];++n)if(r=(i=r._meta)?i.ctor:r){r.apply(this,t);break}(r=this.postscript)&&r.apply(this,t)}}function d(e,t,n){return function(){var r,i,s=0,o=1;n&&(s=t.length-1,o=-1);for(;r=t[s];s+=o)i=r._meta,(r=(i?i.hidden:r.prototype)[e])&&r.apply(this,arguments)}}function v(e){return E.prototype=e.prototype,e=new E,E.prototype=null,e}function m(e){var t=e.callee,n=v(t);return t.apply(n,e),n}function g(e,t,o){"string"!=typeof e&&(o=t,t=e,e=""),o=o||{};var m,E,C,k,A,_,B,j=1,I=t;if("[object Array]"==w.call(t)){j=e,C=[],k=[{cls:0,refs:[]}],_={};for(var q=1,U=t.length,W=0,X,V,$,Y;W<U;++W){(X=t[W])?"[object Function]"!=w.call(X)&&r("mixin #"+W+" is not a callable constructor.",j):r("mixin #"+W+" is unknown. Did you use dojo.require to pull it in?",j),V=X._meta?X._meta.bases:[X],$=0;for(X=V.length-1;0<=X;--X)Y=V[X].prototype,Y.hasOwnProperty("declaredClass")||(Y.declaredClass="uniqName_"+S++),Y=Y.declaredClass,_.hasOwnProperty(Y)||(_[Y]={count:0,refs:[],cls:V[X]},++q),Y=_[Y],$&&$!==Y&&(Y.refs.push($),++$.count),$=Y;++$.count,k[0].refs.push($)}for(;k.length;){$=k.pop(),C.push($.cls);for(--q;E=$.refs,1==E.length;){$=E[0];if(!$||--$.count){$=0;break}C.push($.cls),--q}if($){W=0;for(U=E.length;W<U;++W)$=E[W],--$.count||k.push($)}}q&&r("can't build consistent linearization",j),X=t[0],C[0]=X?X._meta&&X===C[C.length-X._meta.bases.length]?X._meta.bases.length:1:0,_=C,C=_[0],j=_.length-C,t=_[j]}else _=[0],t?"[object Function]"==w.call(t)?(C=t._meta,_=_.concat(C?C.bases:t)):r("base class is not a callable constructor.",e):null!==t&&r("unknown base class. Did you use dojo.require to pull it in?",e);if(t)for(E=j-1;;--E){m=v(t);if(!E)break;C=_[E],(C._meta?a:y)(m,C.prototype),k=new Function,k.superclass=t,k.prototype=m,t=m.constructor=k}else m={};g.safeMixin(m,o),C=o.constructor,C!==b.constructor&&(C.nom=x,m.constructor=C);for(E=j-1;E;--E)(C=_[E]._meta)&&C.chains&&(B=y(B||{},C.chains));m["-chains-"]&&(B=y(B||{},m["-chains-"])),C=!B||!B.hasOwnProperty(x),_[0]=k=B&&"manual"===B.constructor?p(_):1==_.length?h(o.constructor,C):c(_,C),k._meta={bases:_,hidden:o,chains:B,parents:I,ctor:o.constructor},k.superclass=t&&t.prototype,k.extend=f,k.createSubclass=l,k.prototype=m,m.constructor=k,m.getInherited=s,m.isInstanceOf=u,m.inherited=T,m.__inherited=i,e&&(m.declaredClass=e,n.setObject(e,k));if(B)for(A in B)m[A]&&"string"==typeof B[A]&&A!=x&&(C=m[A]=d(A,_,"after"===B[A]),C.nom=A);return k}var y=n.mixin,b=Object.prototype,w=b.toString,E=new Function,S=0,x="constructor",T=e.config.isDebug?o:i;return e.safeMixin=g.safeMixin=function(e,r){var i,s;for(i in r)if(s=r[i],(s!==b[i]||!(i in b))&&i!=x)"[object Function]"==w.call(s)&&(s.nom=i),e[i]=s;if(t("bug-for-in-skips-shadowed"))for(var o=n._extraNames,u=o.length;u;)if(i=o[--u],s=r[i],(s!==b[i]||!(i in b))&&i!=x)"[object Function]"==w.call(s)&&(s.nom=i),e[i]=s;return e},e.declare=g}),define("dojo/parser","require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(D,z,u,x,M,N,O,P,K,Q,R,E,F,L,S,T){function G(b){return eval("("+b+")")}function U(e){var t=e._nameCaseMap,n=e.prototype;if(!t||t._extendCnt<A){var t=e._nameCaseMap={},r;for(r in n)"_"!==r.charAt(0)&&(t[r.toLowerCase()]=r);t._extendCnt=A}return t}function H(e,t){var n=e.join();if(!y[n]){for(var r=[],i=0,s=e.length;i<s;i++){var o=e[i];r[r.length]=y[o]=y[o]||u.getObject(o)||~o.indexOf("/")&&(t?t(o):D(o))}i=r.shift(),y[n]=r.length?i.createSubclass?i.createSubclass(r):i.extend.apply(i,r):i}return y[n]}new Date("X");var A=0;K.after(u,"extend",function(){A++},!0);var y={},J={_clearCache:function(){A++,y={}},_functionFromScript:function(e,t){var n="",r="",i=e.getAttribute(t+"args")||e.getAttribute("args"),s=e.getAttribute("with"),i=(i||"").split(/\s*,\s*/);return s&&s.length&&x.forEach(s.split(/\s*,\s*/),function(e){n+="with("+e+"){",r+="}"}),new Function(i,n+e.innerHTML+r)},instantiate:function(e,t,n){t=t||{},n=n||{};var r=(n.scope||z._scopeName)+"Type",i="data-"+(n.scope||z._scopeName)+"-",s=i+"type",o=i+"mixins",u=[];return x.forEach(e,function(e){var n=r in t?t[r]:e.getAttribute(s)||e.getAttribute(r);if(n){var i=e.getAttribute(o),n=i?[n].concat(i.split(/\s*,\s*/)):[n];u.push({node:e,types:n})}}),this._instantiate(u,t,n)},_instantiate:function(e,t,n,r){function i(e){return!t._started&&!n.noStart&&x.forEach(e,function(e){"function"==typeof e.startup&&!e._started&&e.startup()}),e}return e=x.map(e,function(e){var r=e.ctor||H(e.types,n.contextRequire);if(!r)throw Error("Unable to resolve constructor for: '"+e.types.join()+"'");return this.construct(r,e.node,t,n,e.scripts,e.inherited)},this),r?Q(e).then(i):i(e)},construct:function(e,t,n,r,i,s){function o(e){v&&u.setObject(v,e);for(p=0;p<w.length;p++)K[w[p].advice||"after"](e,w[p].method,u.hitch(e,w[p].func),!0);for(p=0;p<E.length;p++)E[p].call(e);for(p=0;p<T.length;p++)e.watch(T[p].prop,T[p].func);for(p=0;p<N.length;p++)S(e,N[p].event,N[p].func);return e}var a=e&&e.prototype;r=r||{};var f={};r.defaults&&u.mixin(f,r.defaults),s&&u.mixin(f,s);var l;F("dom-attributes-explicit")?l=t.attributes:F("dom-attributes-specified-flag")?l=x.filter(t.attributes,function(e){return e.specified}):(s=(/^input$|^img$/i.test(t.nodeName)?t:t.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),l=x.map(s.split(/\s+/),function(e){var n=e.toLowerCase();return{name:e,value:"LI"==t.nodeName&&"value"==e||"enctype"==n?t.getAttribute(n):t.getAttributeNode(n).value}}));var c=r.scope||z._scopeName;s="data-"+c+"-";var h={};"dojo"!==c&&(h[s+"props"]="data-dojo-props",h[s+"type"]="data-dojo-type",h[s+"mixins"]="data-dojo-mixins",h[c+"type"]="dojoType",h[s+"id"]="data-dojo-id");for(var p=0,d,c=[],v,m;d=l[p++];){var g=d.name,y=g.toLowerCase();d=d.value;switch(h[y]||y){case"data-dojo-type":case"dojotype":case"data-dojo-mixins":break;case"data-dojo-props":m=d;break;case"data-dojo-id":case"jsid":v=d;break;case"data-dojo-attach-point":case"dojoattachpoint":f.dojoAttachPoint=d;break;case"data-dojo-attach-event":case"dojoattachevent":f.dojoAttachEvent=d;break;case"class":f["class"]=t.className;break;case"style":f.style=t.style&&t.style.cssText;break;default:if(g in a||(g=U(e)[y]||g),g in a)switch(typeof a[g]){case"string":f[g]=d;break;case"number":f[g]=d.length?Number(d):NaN;break;case"boolean":f[g]="false"!=d.toLowerCase();break;case"function":""===d||-1!=d.search(/[^\w\.]+/i)?f[g]=new Function(d):f[g]=u.getObject(d,!1)||new Function(d),c.push(g);break;default:y=a[g],f[g]=y&&"length"in y?d?d.split(/\s*,\s*/):[]:y instanceof Date?""==d?new Date(""):"now"==d?new Date:R.fromISOString(d):y instanceof P?z.baseUrl+d:G(d)}else f[g]=d}}for(l=0;l<c.length;l++)h=c[l].toLowerCase(),t.removeAttribute(h),t[h]=null;if(m)try{m=G.call(r.propsThis,"{"+m+"}"),u.mixin(f,m)}catch(b){throw Error(b.toString()+" in data-dojo-props='"+m+"'")}u.mixin(f,n),i||(i=e&&(e._noScript||a._noScript)?[]:L("> script[type^='dojo/']",t));var w=[],E=[],T=[],N=[];if(i)for(p=0;p<i.length;p++)h=i[p],t.removeChild(h),n=h.getAttribute(s+"event")||h.getAttribute("event"),r=h.getAttribute(s+"prop"),m=h.getAttribute(s+"method"),c=h.getAttribute(s+"advice"),l=h.getAttribute("type"),h=this._functionFromScript(h,s),n?"dojo/connect"==l?w.push({method:n,func:h}):"dojo/on"==l?N.push({event:n,func:h}):f[n]=h:"dojo/aspect"==l?w.push({method:m,advice:c,func:h}):"dojo/watch"==l?T.push({prop:r,func:h}):E.push(h);return e=(i=e.markupFactory||a.markupFactory)?i(f,t,e):new e(f,t),e.then?e.then(o):o(e)},scan:function(e,t){function n(e){if(!e.inherited){e.inherited={};var t=e.node,r=n(e.parent),t={dir:t.getAttribute("dir")||r.dir,lang:t.getAttribute("lang")||r.lang,textDir:t.getAttribute(f)||r.textDir},i;for(i in t)t[i]&&(e.inherited[i]=t[i])}return e.inherited}var r=[],i=[],s={},o=(t.scope||z._scopeName)+"Type",u="data-"+(t.scope||z._scopeName)+"-",a=u+"type",f=u+"textdir",u=u+"mixins",l=e.firstChild,c=t.inherited;if(!c){var h=function(e,t){return e.getAttribute&&e.getAttribute(t)||e.parentNode&&h(e.parentNode,t)},c={dir:h(e,"dir"),lang:h(e,"lang"),textDir:h(e,f)},p;for(p in c)c[p]||delete c[p]}for(var c={inherited:c},d,v;;)if(l)if(1!=l.nodeType)l=l.nextSibling;else if(d&&"script"==l.nodeName.toLowerCase())(m=l.getAttribute("type"))&&/^dojo\/\w/i.test(m)&&d.push(l),l=l.nextSibling;else if(v)l=l.nextSibling;else{var m=l.getAttribute(a)||l.getAttribute(o);p=l.firstChild;if(!m&&(!p||3==p.nodeType&&!p.nextSibling))l=l.nextSibling;else{v=null;if(m){var g=l.getAttribute(u);d=g?[m].concat(g.split(/\s*,\s*/)):[m];try{v=H(d,t.contextRequire)}catch(y){}v||x.forEach(d,function(e){~e.indexOf("/")&&!s[e]&&(s[e]=!0,i[i.length]=e)}),g=v&&!v.prototype._noScript?[]:null,c={types:d,ctor:v,parent:c,node:l,scripts:g},c.inherited=n(c),r.push(c)}else c={node:l,scripts:d,parent:c};d=g,v=l.stopParser||v&&v.prototype.stopParser&&!t.template,l=p}}else{if(!c||!c.node)break;l=c.node.nextSibling,v=!1,c=c.parent,d=c.scripts}var b=new E;return i.length?(F("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+i.join(", ")),(t.contextRequire||D)(i,function(){b.resolve(x.filter(r,function(e){if(!e.ctor)try{e.ctor=H(e.types,t.contextRequire)}catch(n){}for(var r=e.parent;r&&!r.types;)r=r.parent;var i=e.ctor&&e.ctor.prototype;return e.instantiateChildren=!(i&&i.stopParser&&!t.template),e.instantiate=!r||r.instantiate&&r.instantiateChildren,e.instantiate}))})):b.resolve(r),b.promise},_require:function(e,t){var n=G("{"+e.innerHTML+"}"),r=[],i=[],s=new E,o=t&&t.contextRequire||D,a;for(a in n)r.push(a),i.push(n[a]);return o(i,function(){for(var e=0;e<r.length;e++)u.setObject(r[e],arguments[e]);s.resolve(arguments)}),s.promise},_scanAmd:function(e,t){var n=new E,r=n.promise;n.resolve(!0);var i=this;return L("script[type='dojo/require']",e).forEach(function(e){r=r.then(function(){return i._require(e,t)}),e.parentNode.removeChild(e)}),r},parse:function(e,t){var n;!t&&e&&e.rootNode?(t=e,n=t.rootNode):!e||!u.isObject(e)||"nodeType"in e?n=e:t=e,n=n?N.byId(n):O.body(),t=t||{};var r=t.template?{template:!0}:{},i=[],s=this,o=this._scanAmd(n,t).then(function(){return s.scan(n,t)}).then(function(e){return s._instantiate(e,r,t,!0)}).then(function(e){return i=i.concat(e)}).otherwise(function(e){throw console.error("dojo/parser::parse() error",e),e});return u.mixin(i,o),i}};return z.parser=J,M.parseOnLoad&&T(100,J,"parse"),J}),define("dojo/dom-construct","exports ./_base/kernel ./sniff ./_base/window ./dom ./dom-attr".split(" "),function(e,t,n,r,i,s){function o(e,t){var n=t.parentNode;n&&n.insertBefore(e,t)}function u(e){if(e.canHaveChildren)try{e.innerHTML="";return}catch(t){}for(var n;n=e.lastChild;)a(n,e)}function a(e,t){e.firstChild&&u(e),t&&(n("ie")&&t.canHaveChildren&&"removeNode"in e?e.removeNode(!1):t.removeChild(e))}var f={option:["select"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},l=/<\s*([\w\:]+)/,c={},h=0,p="__"+t._scopeName+"ToDomId",d;for(d in f)f.hasOwnProperty(d)&&(t=f[d],t.pre="option"==d?'<select multiple="multiple">':"<"+t.join("><")+">",t.post="</"+t.reverse().join("></")+">");var v;8>=n("ie")&&(v=function(e){e.__dojo_html5_tested="yes";var t=m("div",{innerHTML:"<nav>a</nav>",style:{visibility:"hidden"}},e.body);1!==t.childNodes.length&&"abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".replace(/\b\w+\b/g,function(t){e.createElement(t)}),g(t)}),e.toDom=function(e,t){t=t||r.doc;var i=t[p];i||(t[p]=i=++h+"",c[i]=t.createElement("div")),8>=n("ie")&&!t.__dojo_html5_tested&&t.body&&v(t),e+="";var s=e.match(l),o=s?s[1].toLowerCase():"",i=c[i];if(s&&f[o]){s=f[o],i.innerHTML=s.pre+e+s.post;for(s=s.length;s;--s)i=i.firstChild}else i.innerHTML=e;if(1==i.childNodes.length)return i.removeChild(i.firstChild);for(o=t.createDocumentFragment();s=i.firstChild;)o.appendChild(s);return o},e.place=function(t,n,r){n=i.byId(n),"string"==typeof t&&(t=/^\s*</.test(t)?e.toDom(t,n.ownerDocument):i.byId(t));if("number"==typeof r){var s=n.childNodes;!s.length||s.length<=r?n.appendChild(t):o(t,s[0>r?0:r])}else switch(r){case"before":o(t,n);break;case"after":r=t,(s=n.parentNode)&&(s.lastChild==n?s.appendChild(r):s.insertBefore(r,n.nextSibling));break;case"replace":n.parentNode.replaceChild(t,n);break;case"only":e.empty(n),n.appendChild(t);break;case"first":if(n.firstChild){o(t,n.firstChild);break};default:n.appendChild(t)}return t};var m=e.create=function(t,n,o,u){var a=r.doc;return o&&(o=i.byId(o),a=o.ownerDocument),"string"==typeof t&&(t=a.createElement(t)),n&&s.set(t,n),o&&e.place(t,o,u),t};e.empty=function(e){u(i.byId(e))};var g=e.destroy=function(e){(e=i.byId(e))&&a(e,e.parentNode)}}),define("dojo/_base/window",["./kernel","./lang","../sniff"],function(e,t,n){var r={global:e.global,doc:this.document||null,body:function(t){return t=t||e.doc,t.body||t.getElementsByTagName("body")[0]},setContext:function(t,n){e.global=r.global=t,e.doc=r.doc=n},withGlobal:function(t,n,i,s){var o=e.global;try{return e.global=r.global=t,r.withDoc.call(null,t.document,n,i,s)}finally{e.global=r.global=o}},withDoc:function(t,i,s,o){var u=r.doc,f=n("quirks"),l=n("ie"),h,p,v;try{return e.doc=r.doc=t,e.isQuirks=n.add("quirks","BackCompat"==e.doc.compatMode,!0,!0),n("ie")&&(v=t.parentWindow)&&v.navigator&&(h=parseFloat(v.navigator.appVersion.split("MSIE ")[1])||void 0,(p=t.documentMode)&&5!=p&&Math.floor(h)!=p&&(h=p),e.isIE=n.add("ie",h,!0,!0)),s&&"string"==typeof i&&(i=s[i]),i.apply(s,o||[])}finally{e.doc=r.doc=u,e.isQuirks=n.add("quirks",f,!0,!0),e.isIE=n.add("ie",l,!0,!0)}}};return t.mixin(e,r),r}),define("dojo/dom",["./sniff","./_base/window"],function(e,t){if(7>=e("ie"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(n){}var r={};e("ie")?r.byId=function(e,n){if("string"!=typeof e)return e;var r=n||t.doc,i=e&&r.getElementById(e);if(!(!i||i.attributes.id.value!=e&&i.id!=e))return i;r=r.all[e];if(!r||r.nodeName)r=[r];for(var s=0;i=r[s++];)if(i.attributes&&i.attributes.id&&i.attributes.id.value==e||i.id==e)return i}:r.byId=function(e,n){return("string"==typeof e?(n||t.doc).getElementById(e):e)||null},r.isDescendant=function(e,t){try{e=r.byId(e);for(t=r.byId(t);e;){if(e==t)return!0;e=e.parentNode}}catch(n){}return!1},e.add("css-user-select",function(e,t,n){if(!n)return!1;e=n.style,t=["Khtml","O","ms","Moz","Webkit"],n=t.length;var r="userSelect";do if("undefined"!=typeof e[r])return r;while(n--&&(r=t[n]+"UserSelect"));return!1});var i=e("css-user-select");return r.setSelectable=i?function(e,t){r.byId(e).style[i]=t?"":"none"}:function(e,t){e=r.byId(e);var n=e.getElementsByTagName("*"),i=n.length;if(t)for(e.removeAttribute("unselectable");i--;)n[i].removeAttribute("unselectable");else for(e.setAttribute("unselectable","on");i--;)n[i].setAttribute("unselectable","on")},r}),define("dojo/query","./_base/kernel ./has ./dom ./on ./_base/array ./_base/lang ./selector/_loader ./selector/_loader!default".split(" "),function(e,t,n,r,i,s,o,u){function a(e,t){var r=function(r,i){if("string"==typeof i&&(i=n.byId(i),!i))return new t([]);var s="string"==typeof r?e(r,i):r?r.end&&r.on?r:[r]:[];return s.end&&s.on?s:new t(s)};r.matches=e.match||function(e,t,n){return 0<r.filter([e],t,n).length},r.filter=e.filter||function(e,t,n){return r(t,n).filter(function(t){return-1<i.indexOf(e,t)})};if("function"!=typeof e){var s=e.search;e=function(e,t){return s(t||document,e)}}return r}t.add("array-extensible",function(){return 1==s.delegate([],{length:1}).length&&!t("bug-for-in-skips-shadowed")});var f=Array.prototype,l=f.slice,c=f.concat,h=i.forEach,p=function(t,n,r){return n=[0].concat(l.call(n,0)),r=r||e.global,function(e){return n[0]=e,t.apply(r,n)}},d=function(e){var n=this instanceof v&&t("array-extensible");"number"==typeof e&&(e=Array(e));var r=e&&"length"in e?e:arguments;if(n||!r.sort){for(var i=n?this:[],o=i.length=r.length,u=0;u<o;u++)i[u]=r[u];if(n)return i;r=i}return s._mixin(r,m),r._NodeListCtor=function(e){return v(e)},r},v=d,m=v.prototype=t("array-extensible")?[]:{};v._wrap=m._wrap=function(e,t,n){return e=new(n||this._NodeListCtor||v)(e),t?e._stash(t):e},v._adaptAsMap=function(e,t){return function(){return this.map(p(e,arguments,t))}},v._adaptAsForEach=function(e,t){return function(){return this.forEach(p(e,arguments,t)),this}},v._adaptAsFilter=function(e,t){return function(){return this.filter(p(e,arguments,t))}},v._adaptWithCondition=function(t,n,r){return function(){var i=arguments,s=p(t,i,r);return n.call(r||e.global,i)?this.map(s):(this.forEach(s),this)}},h(["slice","splice"],function(e){var t=f[e];m[e]=function(){return this._wrap(t.apply(this,arguments),"slice"==e?this:null)}}),h(["indexOf","lastIndexOf","every","some"],function(t){var n=i[t];m[t]=function(){return n.apply(e,[this].concat(l.call(arguments,0)))}}),s.extend(d,{constructor:v,_NodeListCtor:v,toString:function(){return this.join(",")},_stash:function(e){return this._parent=e,this},on:function(e,t){var n=this.map(function(n){return r(n,e,t)});return n.remove=function(){for(var e=0;e<n.length;e++)n[e].remove()},n},end:function(){return this._parent?this._parent:new this._NodeListCtor(0)},concat:function(e){var t=l.call(this,0),n=i.map(arguments,function(e){return l.call(e,0)});return this._wrap(c.apply(t,n),this)},map:function(e,t){return this._wrap(i.map(this,e,t),this)},forEach:function(e,t){return h(this,e,t),this},filter:function(e){var t=arguments,n=this,r=0;if("string"==typeof e){n=g._filterResult(this,t[0]);if(1==t.length)return n._stash(this);r=1}return this._wrap(i.filter(n,t[r],t[r+1]),this)},instantiate:function(e,t){var n=s.isFunction(e)?e:s.getObject(e);return t=t||{},this.forEach(function(e){new n(t,e)})},at:function(){var e=new this._NodeListCtor(0);return h(arguments,function(t){0>t&&(t=this.length+t),this[t]&&e.push(this[t])},this),e._stash(this)}});var g=a(u,d);return e.query=a(u,function(e){return d(e)}),g.load=function(e,t,n){o.load(e,t,function(e){n(a(e,d))})},e._filterQueryResult=g._filterResult=function(e,t,n){return new d(g.filter(e,t,n))},e.NodeList=g.NodeList=d,g}),define("dojo/_base/array",["./kernel","../has","./lang"],function(e,t,n){function r(e){return o[e]=new Function("item","index","array",e)}function i(e){var t=!e;return function(n,i,s){var u=0,a=n&&n.length||0,f;a&&"string"==typeof n&&(n=n.split("")),"string"==typeof i&&(i=o[i]||r(i));if(s){for(;u<a;++u)if(f=!i.call(s,n[u],u,n),e^f)return!f}else for(;u<a;++u)if(f=!i(n[u],u,n),e^f)return!f;return t}}function s(e){var t=1,n=0,r=0;return e||(t=n=r=-1),function(i,s,o,l){if(l&&0<t)return a.lastIndexOf(i,s,o);l=i&&i.length||0;var c=e?l+r:n;o===u?o=e?n:l+r:0>o?(o=l+o,0>o&&(o=n)):o=o>=l?l+r:o;for(l&&"string"==typeof i&&(i=i.split(""));o!=c;o+=t)if(i[o]==s)return o;return-1}}var o={},u,a={every:i(!1),some:i(!0),indexOf:s(!0),lastIndexOf:s(!1),forEach:function(e,t,n){var i=0,s=e&&e.length||0;s&&"string"==typeof e&&(e=e.split("")),"string"==typeof t&&(t=o[t]||r(t));if(n)for(;i<s;++i)t.call(n,e[i],i,e);else for(;i<s;++i)t(e[i],i,e)},map:function(e,t,n,i){var s=0,u=e&&e.length||0;i=new(i||Array)(u),u&&"string"==typeof e&&(e=e.split("")),"string"==typeof t&&(t=o[t]||r(t));if(n)for(;s<u;++s)i[s]=t.call(n,e[s],s,e);else for(;s<u;++s)i[s]=t(e[s],s,e);return i},filter:function(e,t,n){var i=0,s=e&&e.length||0,u=[],a;s&&"string"==typeof e&&(e=e.split("")),"string"==typeof t&&(t=o[t]||r(t));if(n)for(;i<s;++i)a=e[i],t.call(n,a,i,e)&&u.push(a);else for(;i<s;++i)a=e[i],t(a,i,e)&&u.push(a);return u},clearCache:function(){o={}}};return n.mixin(e,a),a}),define("dojo/dom-class",["./_base/lang","./_base/array","./dom"],function(e,t,n){function r(e){return"string"==typeof e||e instanceof String?e&&!s.test(e)?(o[0]=e,o):(e=e.split(s),e.length&&!e[0]&&e.shift(),e.length&&!e[e.length-1]&&e.pop(),e):e?t.filter(e,function(e){return e}):[]}var i,s=/\s+/,o=[""],u={};return i={contains:function(e,t){return 0<=(" "+n.byId(e).className+" ").indexOf(" "+t+" ")},add:function(e,t){e=n.byId(e),t=r(t);var i=e.className,s,i=i?" "+i+" ":" ";s=i.length;for(var o=0,u=t.length,a;o<u;++o)(a=t[o])&&0>i.indexOf(" "+a+" ")&&(i+=a+" ");s<i.length&&(e.className=i.substr(1,i.length-2))},remove:function(t,i){t=n.byId(t);var s;if(void 0!==i){i=r(i),s=" "+t.className+" ";for(var o=0,u=i.length;o<u;++o)s=s.replace(" "+i[o]+" "," ");s=e.trim(s)}else s="";t.className!=s&&(t.className=s)},replace:function(e,t,r){e=n.byId(e),u.className=e.className,i.remove(u,r),i.add(u,t),e.className!==u.className&&(e.className=u.className)},toggle:function(e,t,s){e=n.byId(e);if(void 0===s){t=r(t);for(var o=0,u=t.length,a;o<u;++o)a=t[o],i[i.contains(e,a)?"remove":"add"](e,a)}else i[s?"add":"remove"](e,t);return s}}}),define("dojo/domReady",["./has"],function(e){function t(e){a.push(e),u&&n()}function n(){if(!f){for(f=!0;a.length;)try{a.shift()(i)}catch(e){console.log("Error on domReady callback: "+e)}f=!1,t._onQEmpty()}}var r=this,i=document,s={loaded:1,complete:1},o="string"!=typeof i.readyState,u=!!s[i.readyState],a=[],f;t.load=function(e,n,r){t(r)},t._Q=a,t._onQEmpty=function(){},o&&(i.readyState="loading");if(!u){var l=[],c=function(e){e=e||r.event,u||"readystatechange"==e.type&&!s[i.readyState]||(o&&(i.readyState="complete"),u=1,n())},h=function(e,t){e.addEventListener(t,c,!1),a.push(function(){e.removeEventListener(t,c,!1)})};if(!e("dom-addeventlistener")){var h=function(e,t){t="on"+t,e.attachEvent(t,c),a.push(function(){e.detachEvent(t,c)})},p=i.createElement("div");try{p.doScroll&&null===r.frameElement&&l.push(function(){try{return p.doScroll("left"),1}catch(e){}})}catch(d){}}h(i,"DOMContentLoaded"),h(r,"load"),"onreadystatechange"in i?h(i,"readystatechange"):o||l.push(function(){return s[i.readyState]});if(l.length){var v=function(){if(!u){for(var e=l.length;e--;)if(l[e]()){c("poller");return}setTimeout(v,30)}};v()}}return t}),define("dojo/ready",["./_base/kernel","./has","require","./domReady","./_base/lang"],function(e,t,n,r,i){var s=0,o=[],u=0;t=function(){s=1,e._postLoad=e.config.afterOnLoad=!0,a()};var a=function(){if(!u){for(u=1;s&&(!r||0==r._Q.length)&&(n.idle?n.idle():1)&&o.length;){var e=o.shift();try{e()}catch(t){if(t.info=t.message,!n.signal)throw t;n.signal("error",t)}}u=0}};n.on&&n.on("idle",a),r&&(r._onQEmpty=a);var f=e.ready=e.addOnLoad=function(t,n,r){var s=i._toArray(arguments);"number"!=typeof t?(r=n,n=t,t=1e3):s.shift(),r=r?i.hitch.apply(e,s):function(){n()},r.priority=t;for(s=0;s<o.length&&t>=o[s].priority;s++);o.splice(s,0,r),a()},l=e.config.addOnLoad;return l&&f[i.isArray(l)?"apply":"call"](e,l),e.config.parseOnLoad&&!e.isAsync&&f(99,function(){e.parser||(e.deprecated("Add explicit require(['dojo/parser']);","","2.0"),n(["dojo/parser"]))}),r?r(t):t(),f}),define("dojo/aspect",[],function(){function e(e,t,r,i){var s=e[t],o="around"==t,u;if(o){var a=r(function(){return s.advice(this,arguments)});u={remove:function(){a&&(a=e=r=null)},advice:function(e,t){return a?a.apply(e,t):s.advice(e,t)}}}else u={remove:function(){if(u.advice){var n=u.previous,i=u.next;!i&&!n?delete e[t]:(n?n.next=i:e[t]=i,i&&(i.previous=n)),e=r=u.advice=null}},id:n++,advice:r,receiveArguments:i};if(s&&!o)if("after"==t){for(;s.next&&(s=s.next););s.next=u,u.previous=s}else"before"==t&&(e[t]=u,u.next=s,s.previous=u);else e[t]=u;return u}function t(t){return function(r,i,s,o){var u=r[i],a;if(!u||u.target!=r)r[i]=a=function(){for(var e=n,t=arguments,r=a.before;r;)t=r.advice.apply(this,t)||t,r=r.next;if(a.around)var i=a.around.advice(this,t);for(r=a.after;r&&r.id<e;){if(r.receiveArguments)var s=r.advice.apply(this,t),i=void 0===s?i:s;else i=r.advice.call(this,i,t);r=r.next}return i},u&&(a.around={advice:function(e,t){return u.apply(e,t)}}),a.target=r;return r=e(a||u,t,s,o),s=null,r}}var n=0,r=t("after"),i=t("before"),s=t("around");return{before:i,around:s,after:r}}),define("dojo/_base/Color",["./kernel","./lang","./array","./config"],function(e,t,n,r){var i=e.Color=function(e){e&&this.setColor(e)};return i.named={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],transparent:r.transparentColor||[0,0,0,0]},t.extend(i,{r:255,g:255,b:255,a:1,_set:function(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r},setColor:function(e){return t.isString(e)?i.fromString(e,this):t.isArray(e)?i.fromArray(e,this):(this._set(e.r,e.g,e.b,e.a),e instanceof i||this.sanitize()),this},sanitize:function(){return this},toRgb:function(){return[this.r,this.g,this.b]},toRgba:function(){return[this.r,this.g,this.b,this.a]},toHex:function(){return"#"+n.map(["r","g","b"],function(e){return e=this[e].toString(16),2>e.length?"0"+e:e},this).join("")},toCss:function(e){var t=this.r+", "+this.g+", "+this.b;return(e?"rgba("+t+", "+this.a:"rgb("+t)+")"},toString:function(){return this.toCss(!0)}}),i.blendColors=e.blendColors=function(e,t,r,s){var o=s||new i;return n.forEach(["r","g","b","a"],function(n){o[n]=e[n]+(t[n]-e[n])*r,"a"!=n&&(o[n]=Math.round(o[n]))}),o.sanitize()},i.fromRgb=e.colorFromRgb=function(e,t){var n=e.toLowerCase().match(/^rgba?\(([\s\.,0-9]+)\)/);return n&&i.fromArray(n[1].split(/\s*,\s*/),t)},i.fromHex=e.colorFromHex=function(e,t){var r=t||new i,s=4==e.length?4:8,o=(1<<s)-1;return e=Number("0x"+e.substr(1)),isNaN(e)?null:(n.forEach(["b","g","r"],function(t){var n=e&o;e>>=s,r[t]=4==s?17*n:n}),r.a=1,r)},i.fromArray=e.colorFromArray=function(e,t){var n=t||new i;return n._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(n.a)&&(n.a=1),n.sanitize()},i.fromString=e.colorFromString=function(e,t){var n=i.named[e];return n&&i.fromArray(n,t)||i.fromRgb(e,t)||i.fromHex(e,t)},i}),define("esri/map","require dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/event dojo/on dojo/aspect dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/registry esri/kernel esri/config esri/sniff esri/lang esri/_coremap esri/MapNavigationManager".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w){var E={up:"panUp",right:"panRight",down:"panDown",left:"panLeft"},S={upperRight:"panUpperRight",lowerRight:"panLowerRight",lowerLeft:"panLowerLeft",upperLeft:"panUpperLeft"},x=r.connect,T=r.disconnect,N=c.create,C=p.set,k=i.hitch,L=h.getMarginBox,A=t.deprecated,O=i.mixin,M=0;return t=n(b,{declaredClass:"esri.Map",constructor:function(t,n){O(this,{_slider:null,_navDiv:null,_mapParams:O({attributionWidth:.45,slider:!0,nav:!1,logo:!0,sliderStyle:"small",sliderPosition:"top-left",sliderOrientation:"vertical",autoResize:!0},n||{})}),O(this,{isDoubleClickZoom:!1,isShiftDoubleClickZoom:!1,isClickRecenter:!1,isScrollWheelZoom:!1,isPan:!1,isRubberBandZoom:!1,isKeyboardNavigation:!1,isPanArrows:!1,isZoomSlider:!1}),i.isFunction(v._css)&&(v._css=v._css(this._mapParams.force3DTransforms),this.force3DTransforms=this._mapParams.force3DTransforms);var r=g("esri-transforms")&&g("esri-transitions");this.navigationMode=this._mapParams.navigationMode||r&&"css-transforms"||"classic","css-transforms"===this.navigationMode&&!r&&(this.navigationMode="classic"),this.fadeOnZoom=y.isDefined(this._mapParams.fadeOnZoom)?this._mapParams.fadeOnZoom:"css-transforms"===this.navigationMode,"css-transforms"!==this.navigationMode&&(this.fadeOnZoom=!1),this.setMapCursor("default"),this.smartNavigation=n&&n.smartNavigation;if(!y.isDefined(this.smartNavigation)&&g("mac")&&!g("esri-touch")&&!g("esri-pointer")&&!(3.5>=g("ff"))){var o=navigator.userAgent.match(/Mac\s+OS\s+X\s+([\d]+)(\.|\_)([\d]+)\D/i);o&&y.isDefined(o[1])&&y.isDefined(o[3])&&(r=parseInt(o[1],10),o=parseInt(o[3],10),this.smartNavigation=10<r||10===r&&6<=o)}this.showAttribution=y.isDefined(this._mapParams.showAttribution)?this._mapParams.showAttribution:!0,this._onLoadHandler_connect=x(this,"onLoad",this,"_onLoadInitNavsHandler");var f=N("div",{"class":"esriControlsBR"+(this._mapParams.nav?" withPanArrows":"")},this.root);if(this.showAttribution)if(r=i.getObject("esri.dijit.Attribution",!1))this._initAttribution(r,f);else{var c=M++,h=this;this._rids&&this._rids.push(c),e(["esri/dijit/Attribution"],function(e){var t=h._rids?s.indexOf(h._rids,c):-1;-1!==t&&(h._rids.splice(t,1),h._initAttribution(e,f))})}this._mapParams.logo&&(r={},6===g("ie")&&(r.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled='true', sizingMethod='crop', src='"+e.toUrl("esri")+"/images/map/logo-med.png')"),r=this._ogol=N("div",{style:r},f),25e4>this.root.clientWidth*this.root.clientHeight?l.add(r,"logo-sm"):l.add(r,"logo-med"),!g("esri-touch")&&!g("esri-pointer")&&(this._ogol_connect=x(r,"onclick",this,"_openLogoLink"))),this.navigationManager=new w(this),n&&n.basemap&&(this._onLoadFix=!0,this.setBasemap(n.basemap),this._onLoadFix=!1);if(this.autoResize=this._mapParams.autoResize)r=(r=d.getEnclosingWidget(this.container))&&r.resize?r:window,o=k(this,this.resize),this._rszSignal=u.pausable(r,"resize",o),this._oriSignal=u.pausable(window,"orientationchange",o),a.after(r,"resize",o,!0)},_initAttribution:function(e,t){var n=N("span",{"class":"esriAttribution"},t,"first");C(n,"maxWidth",Math.floor(this.width*this._mapParams.attributionWidth)+"px"),this._connects.push(x(n,"onclick",function(){l.contains(this,"esriAttributionOpen")?l.remove(this,"esriAttributionOpen"):this.scrollWidth>this.clientWidth&&l.add(this,"esriAttributionOpen")})),this.attribution=new e({map:this},n)},_cleanUp:function(){this.disableMapNavigation(),this.navigationManager.destroy();var e=this._slider;e&&e.destroy&&!e._destroyed&&e.destroy();var e=this._navDiv,t=this.attribution;e&&c.destroy(e),t&&t.destroy(),this._connects.push(this._slider_connect,this._ogol_connect,this._rszSignal,this._oriSignal),s.forEach(this._connects,T),this.attribution=this.navigationManager=this._rids=this._connects=this._slider_connect=this._ogol_connect=this._rszSignal=this._oriSignal=null,this.inherited("_cleanUp",arguments)},_isPanningOrZooming:function(){return this.__panning||this.__zooming},_canZoom:function(e){var t=this.getLevel();return!this.__tileInfo||!(t===this.getMinZoom()&&0>e||t===this.getMaxZoom()&&0<e)},_onLoadInitNavsHandler:function(){this.enableMapNavigation(),this._createNav();if("small"===this._mapParams.sliderStyle||!this._createSlider)this._createSimpleSlider();else if(this._mapParams.slider){var t=-1!==this._getSliderClass(!0).indexOf("Horizontal"),t=[t?"dijit.form.HorizontalSlider":"dijit.form.VerticalSlider",t?"dijit.form.HorizontalRule":"dijit.form.VerticalRule",t?"dijit.form.HorizontalRuleLabels":"dijit.form.VerticalRuleLabels"];if(s.some(t,function(e){return!i.getObject(e,!1)})){var t=s.map(t,function(e){return e.replace(/\./g,"/")}),n=M++,r=this;this._rids&&this._rids.push(n),e(t,function(){var e=r._rids?s.indexOf(r._rids,n):-1;-1!==e&&(r._rids.splice(e,1),r._createSlider.apply(r,arguments))})}else t=s.map(t,function(e){return i.getObject(e,!1)}),this._createSlider.apply(this,t)}T(this._onLoadHandler_connect)},_createNav:function(){if(this._mapParams.nav){var e,t,n,r=l.add,i=this.id;this._navDiv=N("div",{id:i+"_navdiv"},this.root),r(this._navDiv,"navDiv");var s=this.width/2,o=this.height/2,u;for(n in E)t=E[n],e=N("div",{id:i+"_pan_"+n},this._navDiv),r(e,"fixedPan "+t),"up"===n||"down"===n?(u=parseInt(L(e).w,10)/2,C(e,{left:s-u+"px",zIndex:30})):(u=parseInt(L(e).h,10)/2,C(e,{top:o-u+"px",zIndex:30})),this._connects.push(x(e,"onclick",k(this,this[t])));this._onMapResizeNavHandler_connect=x(this,"onResize",this,"_onMapResizeNavHandler");for(n in S)t=S[n],e=N("div",{id:i+"_pan_"+n,style:{zIndex:30}},this._navDiv),r(e,"fixedPan "+t),this._connects.push(x(e,"onclick",k(this,this[t])));this.isPanArrows=!0}},_onMapResizeNavHandler:function(e,t,n){e=this.id,t/=2,n/=2;var r=f.byId,i,s,o;for(i in E)s=r(e+"_pan_"+i),"up"===i||"down"===i?(o=parseInt(L(s).w,10)/2,C(s,"left",t-o+"px")):(o=parseInt(L(s).h,10)/2,C(s,"top",n-o+"px"))},_createSimpleSlider:function(){if(this._mapParams.slider){var e=this._slider=N("div",{id:this.id+"_zoom_slider","class":this._getSliderClass(),style:{zIndex:30}}),t=g("esri-touch")&&!g("ff")?"touchstart":g("esri-pointer")?navigator.msPointerEnabled?"MSPointerDown":"pointerdown":"onclick",n=N("div",{"class":"esriSimpleSliderIncrementButton"},e),r=N("div",{"class":"esriSimpleSliderDecrementButton"},e);this._incButton=n,this._decButton=r,n.innerHTML="+",r.innerHTML="&ndash;",8>g("ie")&&l.add(r,"dj_ie67Fix"),this._connects.push(x(n,t,this,this._simpleSliderChangeHandler)),this._connects.push(x(r,t,this,this._simpleSliderChangeHandler)),"touchstart"==t&&(this._connects.push(x(n,"onclick",this,this._simpleSliderChangeHandler)),this._connects.push(x(r,"onclick",this,this._simpleSliderChangeHandler))),(-1<this.getMaxZoom()||-1<this.getMinZoom())&&this._connects.push(x(this,"onZoomEnd",this,this._simpleSliderZoomHandler)),10>g("ie")&&f.setSelectable(e,!1),this.root.appendChild(e),this.isZoomSlider=!0}},_simpleSliderChangeHandler:function(e){o.stop(e),e=-1!==e.currentTarget.className.indexOf("IncrementButton")?!0:!1,this._extentUtil({numLevels:e?1:-1})},_simpleSliderZoomHandler:function(e,t,n,r){var i;e=this._incButton,t=this._decButton,r===this.getMaxZoom()?i=e:r===this.getMinZoom()&&(i=t),i?(l.add(i,"esriSimpleSliderDisabledButton"),l.remove(i===e?t:e,"esriSimpleSliderDisabledButton")):(l.remove(e,"esriSimpleSliderDisabledButton"),l.remove(t,"esriSimpleSliderDisabledButton"))},_getSliderClass:function(e){e=e?"Large":"Simple";var t=this._mapParams.sliderOrientation,n=this._mapParams.sliderPosition||"",t=t&&"horizontal"===t.toLowerCase()?"esri"+e+"SliderHorizontal":"esri"+e+"SliderVertical";if(n)switch(n.toLowerCase()){case"top-left":n="esri"+e+"SliderTL";break;case"top-right":n="esri"+e+"SliderTR";break;case"bottom-left":n="esri"+e+"SliderBL";break;case"bottom-right":n="esri"+e+"SliderBR"}return"esri"+e+"Slider "+t+" "+n},_createSlider:function(e,t,n){if(this._mapParams.slider){var r=N("div",{id:this.id+"_zoom_slider"},this.root),i=m.defaults.map,o=this._getSliderClass(!0),u=-1!==o.indexOf("Horizontal");-1!==o.indexOf("SliderTL")||o.indexOf("SliderBL"),-1!==o.indexOf("SliderTL")||o.indexOf("SliderTR");var a=this.getNumLevels();if(0<a){var f,l,c=this._mapParams.sliderLabels,h=!!c;if(i=!1!==c){var p=u?"bottomDecoration":"rightDecoration";if(!c){c=[];for(u=0;u<a;u++)c[u]=""}s.forEach([{"class":"esriLargeSliderTicks",container:p,count:a,dijitClass:t},{"class":h&&"esriLargeSliderLabels",container:p,count:a,labels:c,dijitClass:n}],function(e){var n=N("div"),i=e.dijitClass;delete e.dijitClass,r.appendChild(n),i===t?f=new i(e,n):l=new i(e,n)})}e=this._slider=new e({id:r.id,"class":o,minimum:this.getMinZoom(),maximum:this.getMaxZoom(),discreteValues:a,value:this.getLevel(),clickSelect:!0,intermediateChanges:!0,style:"z-index:30;"},r),e.startup(),i&&(f.startup(),l.startup()),this._slider_connect=x(e,"onChange",this,"_onSliderChangeHandler"),this._connects.push(x(this,"onExtentChange",this,"_onExtentChangeSliderHandler")),this._connects.push(x(e._movable,"onFirstMove",this,"_onSliderMoveStartHandler"))}else{e=this._slider=new e({id:r.id,"class":o,minimum:0,maximum:2,discreteValues:3,value:1,clickSelect:!0,intermediateChanges:i.sliderChangeImmediate,style:"height:50px; z-index:30;"},r),n=e.domNode.firstChild.childNodes;for(u=1;3>=u;u++)C(n[u],"visibility","hidden");e.startup(),this._slider_connect=x(e,"onChange",this,"_onDynSliderChangeHandler"),this._connects.push(x(this,"onExtentChange",this,"_onExtentChangeDynSliderHandler"))}n=e.decrementButton,e.incrementButton.style.outline="none",n.style.outline="none",e.sliderHandle.style.outline="none",e._onKeyPress=function(){};if(e=e._movable){var d=e.onMouseDown;e.onMouseDown=function(e){9>g("ie")&&1!==e.button||d.apply(this,arguments)}}this.isZoomSlider=!0}},_onSliderMoveStartHandler:function(){T(this._slider_connect),T(this._slidermovestop_connect),this._slider_connect=x(this._slider,"onChange",this,"_onSliderChangeDragHandler"),this._slidermovestop_connect=x(this._slider._movable,"onMoveStop",this,"_onSliderMoveEndHandler")},_onSliderChangeDragHandler:function(e){this._extentUtil({targetLevel:e})},_onSliderMoveEndHandler:function(){T(this._slider_connect),T(this._slidermovestop_connect)},_onSliderChangeHandler:function(e){this.setLevel(e)},_updateSliderValue:function(e,t){T(this._slider_connect);var n=this._slider,r=n._onChangeActive;n._onChangeActive=!1,n.set("value",e),n._onChangeActive=r,this._slider_connect=x(n,"onChange",this,t)},_onExtentChangeSliderHandler:function(e,t,n,r){T(this._slidermovestop_connect),this._updateSliderValue(r.level,"_onSliderChangeHandler")},_onDynSliderChangeHandler:function(e){this._extentUtil({numLevels:0<e?1:-1})},_onExtentChangeDynSliderHandler:function(){this._updateSliderValue(1,"_onDynSliderChangeHandler")},_openLogoLink:function(e){window.open(m.defaults.map.logoLink,"_blank"),o.stop(e)},enableMapNavigation:function(){this.navigationManager.enableNavigation()},disableMapNavigation:function(){this.navigationManager.disableNavigation()},enableDoubleClickZoom:function(){this.isDoubleClickZoom||(this.navigationManager.enableDoubleClickZoom(),this.isDoubleClickZoom=!0)},disableDoubleClickZoom:function(){this.isDoubleClickZoom&&(this.navigationManager.disableDoubleClickZoom(),this.isDoubleClickZoom=!1)},enableShiftDoubleClickZoom:function(){this.isShiftDoubleClickZoom||(A(this.declaredClass+": Map.(enable/disable)ShiftDoubleClickZoom deprecated. Shift-Double-Click zoom behavior will not be supported.",null,"v2.0"),this.navigationManager.enableShiftDoubleClickZoom(),this.isShiftDoubleClickZoom=!0)},disableShiftDoubleClickZoom:function(){this.isShiftDoubleClickZoom&&(A(this.declaredClass+": Map.(enable/disable)ShiftDoubleClickZoom deprecated. Shift-Double-Click zoom behavior will not be supported.",null,"v2.0"),this.navigationManager.disableShiftDoubleClickZoom(),this.isShiftDoubleClickZoom=!1)},enableClickRecenter:function(){this.isClickRecenter||(this.navigationManager.enableClickRecenter(),this.isClickRecenter=!0)},disableClickRecenter:function(){this.isClickRecenter&&(this.navigationManager.disableClickRecenter(),this.isClickRecenter=!1)},enablePan:function(){this.isPan||(this.navigationManager.enablePan(),this.isPan=!0)},disablePan:function(){this.isPan&&(this.navigationManager.disablePan(),this.isPan=!1)},enableRubberBandZoom:function(){this.isRubberBandZoom||(this.navigationManager.enableRubberBandZoom(),this.isRubberBandZoom=!0)},disableRubberBandZoom:function(){this.isRubberBandZoom&&(this.navigationManager.disableRubberBandZoom(),this.isRubberBandZoom=!1)},enableKeyboardNavigation:function(){this.isKeyboardNavigation||(this.navigationManager.enableKeyboardNavigation(),this.isKeyboardNavigation=!0)},disableKeyboardNavigation:function(){this.isKeyboardNavigation&&(this.navigationManager.disableKeyboardNavigation(),this.isKeyboardNavigation=!1)},enableScrollWheelZoom:function(){this.isScrollWheelZoom||(this.navigationManager.enableScrollWheelZoom(),this.isScrollWheelZoom=!0)},disableScrollWheelZoom:function(){this.isScrollWheelZoom&&(this.navigationManager.disableScrollWheelZoom(),this.isScrollWheelZoom=!1)},showPanArrows:function(){this._navDiv&&(this._navDiv.style.display="block",this.isPanArrows=!0)},hidePanArrows:function(){this._navDiv&&(this._navDiv.style.display="none",this.isPanArrows=!1)},showZoomSlider:function(){this._slider&&(C(this._slider.domNode||this._slider,"visibility","visible"),this.isZoomSlider=!0)},hideZoomSlider:function(){this._slider&&(C(this._slider.domNode||this._slider,"visibility","hidden"),this.isZoomSlider=!1)}}),g("extend-esri")&&(v.Map=t),t}),define("esri/SpatialReference","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has esri/kernel esri/lang".split(" "),function(e,t,n,r,i,s){var o=[-20037508.342788905,20037508.342788905],u=[-20037508.342787,20037508.342787];return e=e(null,{declaredClass:"esri.SpatialReference",constructor:function(e){e&&(n.isObject(e)?n.mixin(this,e):n.isString(e)?this.wkt=e:this.wkid=e)},wkid:null,wkt:null,_info:{102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:o,origin:u,dx:1e-5},102100:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:o,origin:u,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:o,origin:u,dx:1e-5},3857:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:o,origin:u,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",${Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,180],dx:1e-5}},_isWebMercator:function(){return-1!==t.indexOf([102113,102100,3857,3785],this.wkid)},_isWrappable:function(){return-1!==t.indexOf([102113,102100,3857,3785,4326],this.wkid)},_getInfo:function(){return this.wkid?this._info[this.wkid]:null},_canProject:function(e){var t=!1;return e&&(t=this.isWebMercator()&&4326===e.wkid||e.isWebMercator()&&4326===this.wkid),t},isWebMercator:function(){return this._isWebMercator()},equals:function(e){var t=!1;return e&&(this===e&&(t=!0),this.wkid||e.wkid?t=this.wkid===e.wkid||this.isWebMercator()&&e.isWebMercator()||this.wkid===e.latestWkid||e.wkid===this.latestWkid:this.wkt&&e.wkt&&(t=this.wkt.toUpperCase()===e.wkt.toUpperCase())),t},toJson:function(){var e=null,t=s.isDefined;return t(this.wkid)?e={wkid:this.wkid}:t(this.wkt)&&(e={wkt:this.wkt}),e&&t(this.latestWkid)&&(e.latestWkid=this.latestWkid),e}}),r("extend-esri")&&(i.SpatialReference=e),e}),define("esri/geometry/Extent","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has esri/kernel esri/lang esri/SpatialReference esri/geometry/Geometry esri/geometry/Point esri/geometry/webMercatorUtils esri/geometry/mathUtils".split(" "),function(e,t,n,r,i,s,o,u,a,f,l){var c={type:"extent",xmin:0,ymin:0,xmax:0,ymax:0},h=e(u,{declaredClass:"esri.geometry.Extent",constructor:function(e,t,r,i,s){n.mixin(this,c),n.isObject(e)?(n.mixin(this,e),this.spatialReference&&(this.spatialReference=new o(this.spatialReference))):this.update(e,t,r,i,s),this.verifySR()},getWidth:function(){return Math.abs(this.xmax-this.xmin)},getHeight:function(){return Math.abs(this.ymax-this.ymin)},getCenter:function(){return new a((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2,this.spatialReference)},centerAt:function(e){var t=this.getCenter(),n=e.x-t.x;return e=e.y-t.y,new h(this.xmin+n,this.ymin+e,this.xmax+n,this.ymax+e,this.spatialReference)},update:function(e,t,n,r,i){return this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=r,this.spatialReference=i,this},offset:function(e,t){return new h(this.xmin+e,this.ymin+t,this.xmax+e,this.ymax+t,this.spatialReference)},expand:function(e){var t=(1-e)/2;return e=this.getWidth()*t,t*=this.getHeight(),new h(this.xmin+e,this.ymin+t,this.xmax-e,this.ymax-t,this.spatialReference)},intersects:function(e){var t=e.type,n=this.spatialReference,r=e.spatialReference;n&&r&&!n.equals(r)&&n._canProject(r)&&(e=n.isWebMercator()?f.geographicToWebMercator(e):f.webMercatorToGeographic(e,!0));switch(t){case"point":return this.contains(e);case"multipoint":return this._intersectsMultipoint(e);case"extent":return this._intersectsExtent(e);case"polygon":return this._intersectsPolygon(e);case"polyline":return this._intersectsPolyline(e)}},_intersectsMultipoint:function(e){var t=e.points.length,n;for(n=0;n<t;n++)if(this.contains(e.getPoint(n)))return!0;return!1},_intersectsExtent:function(e){var t,n,r,i,s=!1;return this.xmin<=e.xmin?(t=e.xmin,this.xmax<t?s=!0:r=Math.min(this.xmax,e.xmax)-t):(t=this.xmin,e.xmax<t?s=!0:r=Math.min(this.xmax,e.xmax)-t),this.ymin<=e.ymin?(n=e.ymin,this.ymax<n?s=!0:i=Math.min(this.ymax,e.ymax)-n):(n=this.ymin,e.ymax<n?s=!0:i=Math.min(this.ymax,e.ymax)-n),s?null:new h(t,n,t+r,n+i,this.spatialReference)},_intersectsPolygon:function(e){var t=[this.xmin,this.ymax],n=[this.xmax,this.ymax],r=[this.xmin,this.ymin],i=[this.xmax,this.ymin],s=[t,n,r,i],t=[[r,t],[t,n],[n,i],[i,r]],r=e.rings,i=r.length,o,u=new a(0,0,this.spatialReference);o=s.length;for(n=0;n<o;n++)if(u.update(s[n][0],s[n][1]),e.contains(u))return!0;u.setSpatialReference(e.spatialReference);for(var f,l,n=0;n<i;n++)if(s=r[n],o=s.length){f=s[0],u.update(f[0],f[1]);if(this.contains(u))return!0;for(e=1;e<o;e++){l=s[e],u.update(l[0],l[1]);if(this.contains(u)||this._intersectsLine([f,l],t))return!0;f=l}}return!1},_intersectsPolyline:function(e){var t=[[[this.xmin,this.ymin],[this.xmin,this.ymax]],[[this.xmin,this.ymax],[this.xmax,this.ymax]],[[this.xmax,this.ymax],[this.xmax,this.ymin]],[[this.xmax,this.ymin],[this.xmin,this.ymin]]],n,r=e.paths,i=r.length,s,o,u,f,l=new a(0,0,e.spatialReference);for(e=0;e<i;e++)if(s=r[e],o=s.length){u=s[0],l.update(u[0],u[1]);if(this.contains(l))return!0;for(n=1;n<o;n++){f=s[n],l.update(f[0],f[1]);if(this.contains(l)||this._intersectsLine([u,f],t))return!0;u=f}}return!1},_intersectsLine:function(e,t){var n=l._getLineIntersection2,r,i=t.length;for(r=0;r<i;r++)if(n(e,t[r]))return!0;return!1},contains:function(e){if(!e)return!1;var t=e.type;if("point"===t){var n=this.spatialReference,r=e.spatialReference,t=e.x;return e=e.y,n&&r&&!n.equals(r)&&n._canProject(r)&&(e=n.isWebMercator()?a.lngLatToXY(t,e):a.xyToLngLat(t,e,!0),t=e[0],e=e[1]),t>=this.xmin&&t<=this.xmax&&e>=this.ymin&&e<=this.ymax}return"extent"===t?this._containsExtent(e):!1},_containsExtent:function(e){var t=e.xmin,n=e.ymin,r=e.xmax,i=e.ymax,s=e.spatialReference;return e=new a(t,n,s),t=new a(t,i,s),i=new a(r,i,s),n=new a(r,n,s),this.contains(e)&&this.contains(t)&&this.contains(i)&&this.contains(n)?!0:!1},union:function(e){return new h(Math.min(this.xmin,e.xmin),Math.min(this.ymin,e.ymin),Math.max(this.xmax,e.xmax),Math.max(this.ymax,e.ymax),this.spatialReference)},getExtent:function(){var e=this.spatialReference;return new h(this.xmin,this.ymin,this.xmax,this.ymax,e&&new o(e.toJson()))},_shiftCM:function(e){if(!this._shifted){var t=new h(this.toJson()),n=t.spatialReference;if(e=e||n._getInfo()){var r=this._getCM(e);if(r){var i=n._isWebMercator()?f.webMercatorToGeographic(r):r;t.xmin-=r.x,t.xmax-=r.x,n._isWebMercator()||(i.x=this._normalizeX(i.x,e).x),t.spatialReference.wkt=s.substitute({Central_Meridian:i.x},4326===n.wkid?e.altTemplate:e.wkTemplate),t.spatialReference.wkid=null,delete t.spatialReference.wkid}}this._shifted=t}return this._shifted},_getCM:function(e){var t,n=e.valid[0];e=e.valid[1];var r=this.xmin,i=this.xmax;if(!(r>=n&&r<=e)||!(i>=n&&i<=e))t=this.getCenter();return t},_normalize:function(e,n,r){var i=new h(this.toJson()),s=i.spatialReference;if(s&&(r=r||s._getInfo())){var o=t.map(this._getParts(r),function(e){return e.extent});return 2<o.length?e?this._shiftCM(r):i.update(r.valid[0],i.ymin,r.valid[1],i.ymax,s):2===o.length?e?this._shiftCM(r):n?o:{rings:t.map(o,function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}),spatialReference:s}:o[0]||i}return i},_getParts:function(e){if(!this._parts){var t=this.xmin,n=this.xmax,r=this.ymin,i=this.ymax,s=this.spatialReference,o=this.getWidth(),u=t,a=n,f=0,l=0,c=[],p,d;e=e||s._getInfo(),p=e.valid[0],d=e.valid[1],l=this._normalizeX(t,e),t=l.x,f=l.frameId,l=this._normalizeX(n,e),n=l.x,l=l.frameId,e=t===n&&0<o;if(o>2*d){o=new h(u<a?t:n,r,d,i,s),t=new h(p,r,u<a?n:t,i,s),d=new h(0,r,d,i,s),r=new h(p,r,0,i,s),s=[],p=[],o.contains(d)&&s.push(f),o.contains(r)&&p.push(f),t.contains(d)&&s.push(l),t.contains(r)&&p.push(l);for(i=f+1;i<l;i++)s.push(i),p.push(i);c.push({extent:o,frameIds:[f]},{extent:t,frameIds:[l]},{extent:d,frameIds:s},{extent:r,frameIds:p})}else t>n||e?c.push({extent:new h(t,r,d,i,s),frameIds:[f]},{extent:new h(p,r,n,i,s),frameIds:[l]}):c.push({extent:new h(t,r,n,i,s),frameIds:[f]});this._parts=c}return this._parts},_normalizeX:function(e,t){var n=0,r=t.valid[0],i=t.valid[1],s=2*i;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s,n=-n),{x:e,frameId:n}},toJson:function(){var e={xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax},t=this.spatialReference;return t&&(e.spatialReference=t.toJson()),e}});return h.defaultProps=c,r("extend-esri")&&(n.setObject("geometry.Extent",h,i),i.geometry.defaultExtent=c),h}),define("esri/layers/FeatureLayer","dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n esri/kernel esri/lang esri/request esri/deferredUtils esri/SpatialReference esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/jsonUtils esri/renderers/SimpleRenderer esri/renderers/UniqueValueRenderer esri/renderers/jsonUtils esri/tasks/QueryTask esri/tasks/query esri/tasks/FeatureSet esri/geometry/Extent esri/geometry/jsonUtils esri/geometry/normalizeUtils esri/layers/GraphicsLayer esri/layers/Field esri/layers/TimeInfo esri/layers/FeatureType esri/layers/FeatureTemplate esri/layers/FeatureEditResult esri/layers/LabelClass esri/layers/SnapshotMode esri/layers/OnDemandMode esri/layers/SelectionMode esri/layers/TrackManager dojo/i18n!esri/nls/jsapi dojo/has!extend-esri?esri/layers/agscommon".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I){return e=e(A,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(e,t){this.i18n=l.getLocalization("esri","jsapi"),t=t||{},this._outFields=t.outFields,this._loadCallback=t.loadCallback;var r=t._usePatch;this._usePatch=null===r||void 0===r?!0:r,this._trackIdField=t.trackIdField,this.objectIdField=t.objectIdField,this._maxOffset=t.maxAllowableOffset,this._optEditable=t.editable,this._optAutoGen=t.autoGeneralize,this.editSummaryCallback=t.editSummaryCallback,this.userId=t.userId,this.userIsAdmin=t.userIsAdmin,this.useMapTime=t.hasOwnProperty("useMapTime")?!!t.useMapTime:!0,this.source=t.source,this.gdbVersion=t.gdbVersion,this.orderByFields=t.orderByFields,this._selectedFeatures={},this._selectedFeaturesArr=[],this._newFeatures=[],this._deletedFeatures={},this._ulid=this._getUniqueId(),r=this.constructor;switch(this.mode=h.isDefined(t.mode)?t.mode:r.MODE_ONDEMAND){case r.MODE_SNAPSHOT:this._mode=new B(this),this._isSnapshot=!0;break;case r.MODE_ONDEMAND:this._tileWidth=t.tileWidth||512,this._tileHeight=t.tileHeight||512,this._mode=new j(this),this.latticeTiling=t.latticeTiling;break;case r.MODE_SELECTION:this._mode=new F(this),this._isSelOnly=!0}this._initLayer=n.hitch(this,this._initLayer),this._selectHandler=n.hitch(this,this._selectHandler),this._editable=!1;if(n.isObject(e)&&e.layerDefinition)return this._collection=!0,this.mode=r.MODE_SNAPSHOT,this._initLayer(e),this;this._task=new x(this.url,{source:this.source,gdbVersion:this.gdbVersion}),r=this._url.path,this._fserver=!1,-1!==r.search(/\/FeatureServer\//i)&&(this._fserver=!0);var s=t.resourceInfo;s?this._initLayer(s):(this.source&&(s={source:this.source.toJson()},this._url.query=n.mixin(this._url.query,{layer:i.toJson(s)})),this.gdbVersion&&(this._url.query=n.mixin(this._url.query,{gdbVersion:this.gdbVersion})),p({url:r,content:n.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler})),this.registerConnectEvents()},_initLayer:function(e,t){if(e||t){this._json=e,this._findCredential();if(this.credential&&this.credential.ssl||e&&e._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._mode=new B(this),this._isSnapshot=!0,this._featureSet=e.featureSet,this._nextId=e.nextObjectId,e=e.layerDefinition);if(e.hasOwnProperty("capabilities")){var s=this.capabilities=e.capabilities;s&&-1!==s.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);h.isDefined(this._optEditable)&&(this._editable=this._optEditable,delete this._optEditable),this._json=i.toJson(this._json),this.isEditable()?delete this._maxOffset:this.mode!==this.constructor.MODE_SNAPSHOT&&("esriGeometryPolyline"===e.geometryType||"esriGeometryPolygon"===e.geometryType)&&(this._autoGeneralize=h.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===this.constructor.MODE_ONDEMAND,delete this._optAutoGen);var s=e.effectiveMinScale||e.minScale,o=e.effectiveMaxScale||e.maxScale;!this._hasMin&&s&&this.setMinScale(s),!this._hasMax&&o&&this.setMaxScale(o),this.layerId=e.id,this.name=e.name,this.description=e.description,this.copyright=e.copyrightText,this.type=e.type,this.geometryType=e.geometryType,this.displayField=e.displayField,this.defaultDefinitionExpression=e.definitionExpression,this.fullExtent=new C(e.extent),this.initialExtent=new C(this.fullExtent.toJson()),this.fullExtent.spatialReference&&(this.spatialReference=new v(this.fullExtent.spatialReference.toJson())),this.defaultVisibility=e.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.indexedFields=e.indexedFields,this.maxRecordCount=e.maxRecordCount,this.canModifyLayer=e.canModifyLayer,this.supportsStatistics=e.supportsStatistics,this.supportsAdvancedQueries=this._collection?!1:e.supportsAdvancedQueries,this.hasLabels=e.hasLabels,this.canScaleSymbols=e.canScaleSymbols,this.supportsRollbackOnFailure=e.supportsRollbackOnFailure,this.syncCanReturnChanges=e.syncCanReturnChanges,this.isDataVersioned=e.isDataVersioned,this.editFieldsInfo=e.editFieldsInfo,this.ownershipBasedAccessControlForFeatures=e.ownershipBasedAccessControlForFeatures,this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField),this.relationships=e.relationships,this.allowGeometryUpdates=h.isDefined(e.allowGeometryUpdates)?e.allowGeometryUpdates:!0,this._isTable="Table"===this.type;for(var a=this.fields=[],o=e.fields,s=0;s<o.length;s++)a.push(new O(o[s]));if(!this.objectIdField){this.objectIdField=e.objectIdField;if(!this.objectIdField){o=e.fields;for(s=0;s<o.length;s++)if(a=o[s],"esriFieldTypeOID"===a.type){this.objectIdField=a.name;break}}this.objectIdField||console.debug("esri.layers.FeatureLayer: "+h.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!h.isDefined(this._nextId)){o=this.objectIdField,a=-1;if(this._collection&&o)for(var f=(s=this._featureSet)&&s.features,l=f?f.length:0,c,s=0;s<l;s++)c=(c=f[s].attributes)&&c[o],c>a&&(a=c);this._nextId=a+1}this.globalIdField=e.globalIdField;if(s=this.typeIdField=e.typeIdField)if(s=!this._getField(s)&&this._getField(s,!0))this.typeIdField=s.name;this.visibilityField=e.visibilityField;if(o=e.defaultSymbol)this.defaultSymbol=b.fromJson(o);var p=this.types=[],d=e.types,x,T,a=(s=this.editFieldsInfo)&&s.creatorField,f=s&&s.editorField;c=a||f,l=[];if(d)for(s=0;s<d.length;s++)x=new _(d[s]),T=x.templates,c&&T&&T.length&&(l=l.concat(T)),p.push(x);d=e.templates,x=this.templates=[];if(d)for(s=0;s<d.length;s++)p=new D(d[s]),c&&l.push(p),x.push(p);for(s=0;s<l.length;s++)if(c=n.getObject("prototype.attributes",!1,l[s]))a&&delete c[a],f&&delete c[f];if(s=e.timeInfo)this.timeInfo=new M(s),this._startTimeField=s.startTimeField,this._endTimeField=s.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?s.trackIdField=this._trackIdField:this._trackIdField=s.trackIdField;this.hasAttachments=!this._collection&&e.hasAttachments?!0:!1,this.htmlPopupType=e.htmlPopupType;var s=e.drawingInfo,k;if(a=s&&s.labelingInfo)this.labelingInfo=r.map(a,function(e){return new H(e)});if(!this.renderer)if(s&&s.renderer){if(k=s.renderer,this.setRenderer(S.fromJson(k)),"classBreaks"===k.type&&this.renderer.setMaxInclusive(!0),!this._collection){var L=k.type,o=[];k=this.renderer;switch(L){case"simple":o.push(k.symbol);break;case"uniqueValue":case"classBreaks":o.push(k.defaultSymbol),o=o.concat(r.map(k.infos,function(e){return e.symbol}))}var o=r.filter(o,h.isDefined),A=this._url.path+"/images/",P=this._getToken();r.forEach(o,function(e){var t=e.url;t&&(-1===t.search(/https?\:/)&&-1===t.indexOf("data:")&&(e.url=A+t),P&&-1!==e.url.search(/https?\:/)&&(e.url+="?token="+P))})}}else if(o)d=this.types,0<d.length?(k=new E(this.defaultSymbol,this.typeIdField),r.forEach(d,function(e){k.addValue(e.id,e.symbol)})):k=new w(this.defaultSymbol),this.setRenderer(k);else if(!this._isTable){switch(this.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":L=new m;break;case"esriGeometryPolyline":L=new g;break;case"esriGeometryPolygon":L=new y}this.setRenderer(L?new w(L):null)}L=s&&s.transparency||0,!h.isDefined(this.opacity)&&0<L&&(this.opacity=1-L/100),this.version=e.currentVersion,this.version||(this.version="capabilities"in e||"drawingInfo"in e||"hasAttachments"in e||"htmlPopupType"in e||"relationships"in e||"timeInfo"in e||"typeIdField"in e||"types"in e?10:9.3),(u("ie")||u("safari"))&&this.isEditable()&&10.02>this.version&&(this._ts=!0),this.loaded=!0,this._fixRendererFields(),this._checkFields(),this._updateCaps(),L=function(){this.onLoad(this);var e=this._loadCallback;e&&(delete this._loadCallback,e(this))},this._collection?(this._fireUpdateStart(),s=this._featureSet,delete this._featureSet,this._mode._drawFeatures(new N(s)),this._fcAdded=!0,L.call(this)):this._forceIdentity(L)}},onRendererChange:function(){this.inherited(arguments);var e=this._getRenderer();this._ager=!(!e||!e.observationAger||!e.observationRenderer);if(e){var t=[],e=r.filter([e,e.observationRenderer,e.latestObservationRenderer,e.trackRenderer],h.isDefined);r.forEach(e,function(e){n.isFunction(e.attributeField)||t.push(e.attributeField),t.push(e.attributeField2),t.push(e.attributeField3)},this),this._rendererFields=r.filter(t,h.isDefined)}else this._rendererFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments),this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var e=this._getRenderer();this._ager=!(!e||!e.observationAger||!e.observationRenderer),this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(e&&e.trackRenderer)},_setMap:function(e){var t=this.inherited(arguments),n=this._mode,r=this;return n&&n.initialize(e),this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase()),this._addHandle=this.on("graphic-node-add",function(e){e=e.graphic.attributes,(e=r._selectedFeatures[e&&e[r.objectIdField]])&&e.attr("data-selected","")}),t},_unsetMap:function(e){var n=this._mode;n&&n.suspend(),this._trackManager&&(this._trackManager.destroy(),this._trackManager=null),t.disconnect(this._zoomConnect),t.disconnect(this._addHandle),this._zoomConnect=this._addHandle=null,this._toggleTime(!1),this.inherited("_unsetMap",arguments)},refresh:function(){var e=this._mode;e&&e.refresh()},getOutFields:function(){return r.filter(this._getOutFields(),function(e){return"*"===e||!!this._getField(e)},this)},setEditable:function(e){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=e,this;var t=this._editable;return this._editable=e,this._updateCaps(),t!==e&&this.onCapabilitiesChange(),this},getEditCapabilities:function(e){var t={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return t;var i=e&&e.feature;e=e&&e.userId;var s=r.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],n.trim),o=-1<r.indexOf(s,"editing"),u=o&&-1<r.indexOf(s,"create"),t=o&&-1<r.indexOf(s,"update"),s=o&&-1<r.indexOf(s,"delete"),a=this.ownershipBasedAccessControlForFeatures,f=this.editFieldsInfo,l=f&&f.creatorField,f=f&&f.realm,i=(i=i&&i.attributes)&&l?i[l]:void 0,c=!!this.userIsAdmin,l=!a||c||!!a.allowOthersToUpdate||!!a.allowUpdateToOthers,a=!a||c||!!a.allowOthersToDelete||!!a.allowDeleteToOthers;if(c||o&&!u&&!t&&!s)u=t=s=!0;return o={canCreate:u,canUpdate:t,canDelete:s},null===i?(o.canUpdate=t&&l,o.canDelete=s&&a):""!==i&&i&&((e=e||this.getUserId())&&f&&(e=e+"@"+f),e.toLowerCase()!==i.toLowerCase()&&(o.canUpdate=t&&l,o.canDelete=s&&a)),o},getUserId:function(){var e;return this.loaded&&(e=this.credential&&this.credential.userId||this.userId||""),e},setUserIsAdmin:function(e){this.userIsAdmin=e},setEditSummaryCallback:function(e){this.editSummaryCallback=e},getEditSummary:function(e,t,r){r=h.isDefined(r)?r:(new Date).getTime();var i="";r=this.getEditInfo(e,t,r),(t=t&&t.callback||this.editSummaryCallback)&&(r=t(e,r)||"");if(n.isString(r))i=r;else{if(r){e=r.action,t=r.userId;var s=r.timeValue,o=0;e&&o++,t&&o++,h.isDefined(s)&&o++,1<o&&(i=("edit"===e?"edit":"create")+(t?"User":"")+(h.isDefined(s)?r.displayPattern:""))}i=i&&h.substitute(r,this.i18n.layers.FeatureLayer[i])}return i},getEditInfo:function(e,t,n){if(this.loaded){n=h.isDefined(n)?n:(new Date).getTime(),t=t&&t.action||"last";var r=this.editFieldsInfo,i=r&&r.creatorField,s=r&&r.creationDateField,o=r&&r.editorField,r=r&&r.editDateField,o=(e=e&&e.attributes)&&o?e[o]:void 0,r=e&&r?e[r]:null,i=this._getEditData(e&&i?e[i]:void 0,e&&s?e[s]:null,n);n=this._getEditData(o,r,n);var u;switch(t){case"creation":u=i;break;case"edit":u=n;break;case"last":u=n||i}return u&&(u.action=u===n?"edit":"creation"),u}},_getEditData:function(e,t,n){var r,i,s;h.isDefined(t)&&(i=n-t,s=0>i?"Full":6e4>i?"Seconds":12e4>i?"Minute":36e5>i?"Minutes":72e5>i?"Hour":864e5>i?"Hours":6048e5>i?"WeekDay":"Full");if(void 0!==e||s)r=r||{},r.userId=e,s&&(e=o.format,n=new Date(t),r.minutes=Math.floor(i/6e4),r.hours=Math.floor(i/36e5),r.weekDay=e(n,{datePattern:"EEEE",selector:"date"}),r.formattedDate=e(n,{selector:"date"}),r.formattedTime=e(n,{selector:"time"}),r.displayPattern=s,r.timeValue=t);return r},isEditable:function(){return!!this._editable||!!this.userIsAdmin},setMaxAllowableOffset:function(e){return this.isEditable()||(this._maxOffset=e),this},getMaxAllowableOffset:function(){return this._maxOffset},setAutoGeneralize:function(e){return this.loaded?!this.isEditable()&&this.mode!==this.constructor.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType)&&((this._autoGeneralize=e)?(e=this._map)&&e.loaded&&(this._maxOffset=Math.floor(e.extent.getWidth()/e.width)):delete this._maxOffset):this._optAutoGen=e,this},setGDBVersion:function(e){return!this._collection&&e!==this.gdbVersion&&(e||this.gdbVersion)&&(this.gdbVersion=e,this._task.gdbVersion=e,this._url.query=n.mixin(this._url.query,{gdbVersion:e}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange()),this},setDefinitionExpression:function(e){return this._defnExpr=e,(e=this._mode)&&e.propertyChangeHandler(1),this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(e){return this._isSnapshot?(this._timeDefn=e,(e=this._mode)&&e.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id = "+this.id+", Layer URL = "+this.url),this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(e,t){this._timeOffset=e,this._timeOffsetUnits=t;var n=this._mode;return n&&n.propertyChangeHandler(0),this},setUseMapTime:function(e){this.useMapTime=e,this._toggleTime(!this.suspended),(e=this._mode)&&e.propertyChangeHandler(0)},selectFeatures:function(e,t,n,r){t=t||this.constructor.SELECTION_NEW,e=this._getShallowClone(e);var i=this._map,o=d._fixDfd(new s(d._dfdCanceller));e.outFields=this.getOutFields(),e.returnGeometry=!0,i&&(e.outSpatialReference=new v(i.spatialReference.toJson()));if(!this._applyQueryFilters(e,!0))return e={features:[]},this._selectHandler(e,t,n,r,o),o;if(i=this._canDoClientSideQuery(e))e={features:this._doQuery(e,i)},this._selectHandler(e,t,n,r,o);else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,r,o,!0),o;var u=this;this._ts&&(e._ts=(new Date).getTime()),(o._pendingDfd=this._task.execute(e)).addCallbacks(function(e){u._selectHandler(e,t,n,r,o)},function(e){u._resolve([e],null,r,o,!0)})}return o},getSelectedFeatures:function(){var e=this._selectedFeatures,t=[],n;for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},clearSelection:function(e){var t=this._selectedFeatures,n=this._mode,r;for(r in t)t.hasOwnProperty(r)&&(this._unSelectFeatureIIf(r,n),n._removeFeatureIIf(r));return this._selectedFeatures={},this._isSelOnly&&n._applyTimeFilter(!0),e||this.onSelectionClear(),this},setSelectionSymbol:function(e){if(this._selectionSymbol=e){var t=this._selectedFeatures,n;for(n in t)t.hasOwnProperty(n)&&t[n].setSymbol(e)}return this},getSelectionSymbol:function(){return this._selectionSymbol},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(e,t,i,s,o,u){var a=u.assembly,f=u.dfd;this._applyNormalized(e,a&&a[0]),this._applyNormalized(t,a&&a[1]),this.onBeforeApplyEdits(e,t,i);var l={},c=this.objectIdField,a={f:"json"},h=!1;if(this._collection)u={},u.addResults=e?r.map(e,function(){return h=!0,{objectId:this._nextId++,success:!0}},this):null,u.updateResults=t?r.map(t,function(e){h=!0;var t=e.attributes[c];return l[t]=e,{objectId:t,success:!0}},this):null,u.deleteResults=i?r.map(i,function(e){return h=!0,{objectId:e.attributes[c],success:!0}},this):null,h&&this._editHandler(u,e,l,s,o,f);else{e&&0<e.length&&(a.adds=this._convertFeaturesToJson(e,0,1),h=!0);if(t&&0<t.length){for(u=0;u<t.length;u++){var d=t[u];l[d.attributes[c]]=d}a.updates=this._convertFeaturesToJson(t,0,0,1),h=!0}if(i&&0<i.length){t=[];for(u=0;u<i.length;u++)t.push(i[u].attributes[c]);a.deletes=t.join(","),h=!0}if(h){var v=this;return p({url:this._url.path+"/applyEdits",content:n.mixin(a,this._url.query),callbackParamName:"callback",load:function(t){v._editHandler(t,e,l,s,o,f)},error:function(e){v._resolve([e],null,o,f,!0)}},{usePost:!0})}}},queryFeatures:function(e,t,n){return this._query("execute","onQueryFeaturesComplete",e,t,n)},queryRelatedFeatures:function(e,t,n){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",e,t,n)},queryIds:function(e,t,n){return this._query("executeForIds","onQueryIdsComplete",e,t,n)},queryCount:function(e,t,n){return this._query("executeForCount","onQueryCountComplete",e,t,n)},queryAttachmentInfos:function(e,t,i){var o=this._url.path+"/"+e+"/attachments",u=new s(d._dfdCanceller),f=this;return u._pendingDfd=p({url:o,content:n.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(n){n=n.attachmentInfos;var i;r.forEach(n,function(t){i=a.objectToQuery({gdbVersion:f._url.query&&f._url.query.gdbVersion,layer:f._url.query&&f._url.query.layer,token:f._getToken()}),t.url=o+"/"+t.id+(i?"?"+i:""),t.objectId=e}),f._resolve([n],"onQueryAttachmentInfosComplete",t,u)},error:function(e){f._resolve([e],null,i,u,!0)}}),u},addAttachment:function(e,t,n,r){return this._sendAttachment("add",e,t,n,r)},updateAttachment:function(e,t,n,r,i){return n.appendChild(f.create("input",{type:"hidden",name:"attachmentId",value:t})),this._sendAttachment("update",e,n,r,i)},deleteAttachments:function(e,t,i,o){var u=this._url.path+"/"+e+"/deleteAttachments",a=new s(d._dfdCanceller),f=this;return t={f:"json",attachmentIds:t.join(",")},a._pendingDfd=p({url:u,content:n.mixin(t,this._url.query),callbackParamName:"callback",load:n.hitch(this,function(t){t=t.deleteAttachmentResults,t=r.map(t,function(t){return t=new P(t),t.attachmentId=t.objectId,t.objectId=e,t}),f._resolve([t],"onDeleteAttachmentsComplete",i,a)}),error:function(e){f._resolve([e],null,o,a,!0)}},{usePost:!0}),a},addType:function(e){var t=this.types;if(t){if(r.some(t,function(t){return t.id==e.id?!0:!1}))return!1;t.push(e)}else this.types=[e];return this._typesDirty=!0},deleteType:function(e){if(this._collection){var t=this.types;if(t){var n=-1;r.some(t,function(t,r){return t.id==e?(n=r,!0):!1});if(-1<n)return this._typesDirty=!0,t.splice(n,1)[0]}}},toJson:function(){var e=this._json;if(e=n.isString(e)?i.fromJson(e):n.clone(e)){var e=e.layerDefinition?e:{layerDefinition:e},t=e.layerDefinition,s=this._collection;if(s&&this._typesDirty){t.types=r.map(this.types||[],function(e){return e.toJson()});var o=this.renderer,u=t.drawingInfo;o&&!u&&(u=t.drawingInfo={}),u&&o&&-1===o.declaredClass.indexOf("TemporalRenderer")&&(u.renderer=o.toJson())}o=null;if(!s||this._fcAdded)o={geometryType:t.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};return e.featureSet=n.mixin({},e.featureSet||{},o),s&&(e.nextObjectId=this._nextId,t.capabilities=this.capabilities),e}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(e){var t=this,n=this._url&&this._url.path;(this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&n&&c.id&&c.id._hasPortalSession()&&c.id._doPortalSignIn(n)?c.id.getCredential(n).then(function(){t._findCredential(),e.call(t)},function(){e.call(t)}):e.call(this)},_updateCaps:function(){var e=this._editable,t=n.trim(this.capabilities||""),i=r.map(t?t.split(","):[],n.trim),s=r.map(t?t.toLowerCase().split(","):[],n.trim),t=r.indexOf(s,"editing"),o,s={Create:r.indexOf(s,"create"),Update:r.indexOf(s,"update"),Delete:r.indexOf(s,"delete")};if(e&&-1===t)i.push("Editing");else if(!e&&-1<t){e=[t];for(o in s)-1<s[o]&&e.push(s[o]);e.sort();for(o=e.length-1;0<=o;o--)i.splice(e[o],1)}this.capabilities=i.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments),this._toggleTime(!1);var e=this._mode;e&&e.suspend()},onResume:function(e){this.inherited(arguments),this._toggleTime(!0),this._updateMaxOffset();var n=this._mode,r=this._map,i=this._getRenderer();e.firstOccurrence&&(this._fixRendererFields(),this._checkFields(),this.clearSelection(),this.timeInfo&&(this._trackIdField||i&&(i.latestObservationRenderer||i.trackRenderer))&&(this._trackManager=new I(this),this._trackManager.initialize(r)),this._zoomConnect=t.connect(r,"onZoomEnd",this,this._updateMaxOffset)),n&&(e.firstOccurrence?n.startup():n.resume())},_updateMaxOffset:function(){var e=this._map;e&&e.loaded&&this._autoGeneralize&&(this._maxOffset=Math.floor(e.extent.getWidth()/e.width))},_toggleTime:function(e){var n=this._map;e&&this.timeInfo&&this.useMapTime&&n?(this._mapTimeExtent=n.timeExtent,this._timeConnect||(this._timeConnect=t.connect(n,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,t.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(e){this._mapTimeExtent=e,(e=this._mode)&&e.propertyChangeHandler(0)},_getOffsettedTE:function(e){var t=this._timeOffset,n=this._timeOffsetUnits;return e&&t&&n?e.offset(-1*t,n):e},_getTimeOverlap:function(e,t){return e&&t?e.intersection(t):e||t},_getTimeFilter:function(e){var t=this.getTimeDefinition(),n;if(t&&(n=this._getTimeOverlap(t,null),!n))return[!1];if(e){if(e=n?this._getTimeOverlap(e,n):e,!e)return[!1]}else e=n;return[!0,e]},_getAttributeFilter:function(e){var t=this.getDefinitionExpression();return e?t?"("+t+") AND ("+e+")":e:t},_applyQueryFilters:function(e,t){e.where=this._getAttributeFilter(e.where),e.maxAllowableOffset=this._maxOffset,t&&this.supportsAdvancedQueries&&(e.orderByFields=e.orderByFields||this.getOrderByFields());if(this.timeInfo){var n=this._getTimeFilter(e.timeExtent);if(!n[0])return!1;e.timeExtent=n[1]}return!0},_add:function(e){var t=this._selectionSymbol,n=e.attributes,r=this.visibilityField;return t&&this._isSelOnly&&e.setSymbol(t),r&&n&&n.hasOwnProperty(r)&&e[n[r]?"show":"hide"](),this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(e){var t=[],n=this._map;if(!this._isTable&&n&&!e.text&&!(e.where&&e.where!==this.getDefinitionExpression()||e.orderByFields&&e.orderByFields.length)){var i=this._isSnapshot,s=this._isSelOnly,o=e.geometry;if(o){if(!!s||e.spatialRelationship!==T.SPATIAL_REL_INTERSECTS||"extent"!==o.type||!i&&!n.extent.contains(o))return;t.push(1)}if(n=e.objectIds)if(i)t.push(2);else{var o=n.length,u=this._mode,a=0,f;for(f=0;f<o;f++)u._getFeature(n[f])&&a++;if(a!==o)return;t.push(2)}if(this.timeInfo)if(e=e.timeExtent,n=this._mapTimeExtent,i)e&&t.push(3);else if(s){if(e)return}else if(n){if(-1===r.indexOf(t,2))return;e&&t.push(3)}else if(0<t.length)e&&t.push(3);else if(e)return;return 0<t.length?t:null}},_doQuery:function(e,t,n){var i=[],s=this._mode,o=this.objectIdField,u,a;if(-1!==r.indexOf(t,2)){var i=[],f=e.objectIds;a=f.length;for(u=0;u<a;u++){var l=s._getFeature(f[u]);l&&i.push(l)}if(0===i.length)return[]}if(-1!==r.indexOf(t,1)){s=0<i.length?i:this.graphics,a=s.length,f=e.geometry._normalize(null,!0),i=[];for(u=0;u<a;u++){var l=s[u],c=l.geometry;c&&(this.normalization&&f.length?(f[0].intersects(c)||f[1].intersects(c))&&i.push(l):f.intersects(c)&&i.push(l))}if(0===i.length)return[]}return-1!==r.indexOf(t,3)&&this.timeInfo&&(s=0<i.length?i:this.graphics,e=e.timeExtent,i=this._filterByTime(s,e.startTime,e.endTime).match),n?r.map(i,function(e){return e.attributes[o]},this):i},_filterByTime:function(e,t,n){var r=this._startTimeField,i=this._endTimeField,s;this._twoTimeFields||(s=r||i);var o=h.isDefined,u=[],a=[],f,l=e.length,c,p;t=t?t.getTime():-Infinity,n=n?n.getTime():Infinity;if(s)for(f=0;f<l;f++)c=e[f],p=c.attributes,r=p[s],r>=t&&r<=n?u.push(c):a.push(c);else for(f=0;f<l;f++)c=e[f],p=c.attributes,s=p[r],p=p[i],s=o(s)?s:-Infinity,p=o(p)?p:Infinity,s>=t&&s<=n||p>=t&&p<=n||t>=s&&n<=p?u.push(c):a.push(c);return{match:u,noMatch:a}},_resolve:function(e,t,n,r,i){t&&this[t].apply(this,e),n&&n.apply(null,e),r&&d._resDfd(r,e,i)},_getShallowClone:function(e){var t=new T,n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},_query:function(e,t,n,r,i){var o=this,u=this._map,a=new s(d._dfdCanceller),f=n,l=function(n,i){if(!i&&"execute"===e&&!o._isTable){var s=n.features,u=o._mode,f=o.objectIdField,l;for(l=s.length-1;0<=l;l--){var c=u._getFeature(s[l].attributes[f]);c&&s.splice(l,1,c)}}o._resolve([n],t,r,a)};if("executeRelationshipQuery"!==e){f=this._getShallowClone(n),f.outFields=this.getOutFields(),f.returnGeometry=n.hasOwnProperty("returnGeometry")?n.returnGeometry:!0;var c;u&&(f.outSpatialReference=new v(u.spatialReference.toJson()));if(!this._applyQueryFilters(f,"execute"===e)){switch(e){case"execute":c=new N({features:[]});break;case"executeForIds":c=[];break;case"executeForCount":c=0}return l(c,!0),a}if(n=this._canDoClientSideQuery(f)){f=this._doQuery(f,n,"executeForIds"===e||"executeForCount"===e);switch(e){case"execute":c=new N,c.features=f;break;case"executeForIds":c=f;break;case"executeForCount":c=f.length}return l(c,!0),a}}return this._collection?(this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,i,a,!0),a):(this._ts&&(f._ts=(new Date).getTime()),(a._pendingDfd=this._task[e](f)).addCallbacks(l,function(e){o._resolve([e],null,i,a,!0)}),a)},_convertFeaturesToJson:function(e,t,s,o){var u=[],a=this._selectionSymbol,f=this.visibilityField,l,c=this.objectIdField;this.loaded&&(s||o)&&(l=r.filter(this.fields,function(e){return!1===e.editable&&(!o||e.name!==c)}));for(s=0;s<e.length;s++){var h=e[s],p={},d=h.geometry,v=h.attributes,m=h.symbol;d&&(!o||!this.loaded||this.allowGeometryUpdates)&&(p.geometry=d.toJson()),f?(p.attributes=v=n.mixin({},v),v[f]=h.visible?1:0):v&&(p.attributes=n.mixin({},v)),p.attributes&&l&&l.length&&r.forEach(l,function(e){delete p.attributes[e.name]}),m&&m!==a&&(p.symbol=m.toJson()),u.push(p)}return t?u:i.toJson(u)},_selectHandler:function(e,t,n,r,i){var s;r=this.constructor;switch(t){case r.SELECTION_NEW:this.clearSelection(!0),s=!0;break;case r.SELECTION_ADD:s=!0;break;case r.SELECTION_SUBTRACT:s=!1}r=e.features;var o=this._mode,u=[],a=this.objectIdField,f,l;if(s)for(s=0;s<r.length;s++)f=r[s],l=f.attributes[a],f=o._addFeatureIIf(l,f),u.push(f),this._selectFeatureIIf(l,f,o);else for(s=0;s<r.length;s++)f=r[s],l=f.attributes[a],this._unSelectFeatureIIf(l,o),l=o._removeFeatureIIf(l),u.push(l||f);this._isSelOnly&&o._applyTimeFilter(!0),this._resolve([u,t,e.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",n,i),e.exceededTransferLimit&&this.onQueryLimitExceeded()},_selectFeatureIIf:function(e,t,n){var r=this._selectedFeatures,i=r[e];return i||(n._incRefCount(e),r[e]=t,this._isTable||(this._setSelectSymbol(t),t.attr("data-selected",""))),i||t},_unSelectFeatureIIf:function(e,t){var n=this._selectedFeatures[e];return n&&(t._decRefCount(e),delete this._selectedFeatures[e],this._isTable||(this._setUnSelectSymbol(n),n.attr("data-selected"))),n},_isSelected:function(e){},_setSelectSymbol:function(e){var t=this._selectionSymbol;t&&!this._isSelOnly&&e.setSymbol(t)},_setUnSelectSymbol:function(e){var t=this._selectionSymbol;t&&!this._isSelOnly&&t===e.symbol&&e.setSymbol(null,!0)},_getOutFields:function(){var e=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),e=r.filter(e,function(e,t,n){return!!e&&r.indexOf(n,e)===t}),t=n.clone(this._outFields);return t?-1!==r.indexOf(t,"*")?t:(r.forEach(e,function(e){-1===r.indexOf(t,e)&&t.push(e)}),t):e},_checkFields:function(e){var t=e||this._getOutFields();r.forEach(t,function(e){"*"!==e&&(this._getField(e)||console.debug("esri.layers.FeatureLayer: "+h.substitute({url:this.url,field:e},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this),!e&&!this._isTable&&!this._fserver&&!this._collection&&(r.some(this.fields,function(e){return e&&"esriFieldTypeGeometry"===e.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+h.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},_fixRendererFields:function(){var e=this.renderer;this._orderBy=null;if(e&&0<this.fields.length){var t=[],i,s,e=r.filter([e,e.observationRenderer,e.latestObservationRenderer,e.trackRenderer],h.isDefined),o=[].concat(e);r.forEach(e,function(e){r.forEach(e.rendererInfos,function(e){e.renderer&&o.push(e.renderer)})}),r.forEach(o,function(e){(s=e.attributeField)&&!n.isFunction(s)&&(i=!this._getField(s)&&this._getField(s,!0))&&(e.attributeField=i.name);if(s=e.attributeField2)if(i=!this._getField(s)&&this._getField(s,!0))e.attributeField2=i.name;if(s=e.attributeField3)if(i=!this._getField(s)&&this._getField(s,!0))e.attributeField3=i.name;n.isFunction(e.attributeField)||t.push(e.attributeField),t.push(e.attributeField2),t.push(e.attributeField3);if((s=e.rotationInfo&&e.rotationInfo.field)&&!n.isFunction(s)){if(i=!this._getField(s)&&this._getField(s,!0))s=e.rotationInfo.field=i.name;t.push(s)}if(e.proportionalSymbolInfo){if((s=e.proportionalSymbolInfo.field)&&!n.isFunction(s)){if(i=!this._getField(s)&&this._getField(s,!0))s=e.proportionalSymbolInfo.field=i.name;t.push(s),this._orderBy||(this._orderBy=[s+" DESC"])}if((s=e.proportionalSymbolInfo.normalizationField)&&!n.isFunction(s)){if(i=!this._getField(s)&&this._getField(s,!0))s=e.proportionalSymbolInfo.normalizationField=i.name;t.push(s)}}if(e.colorInfo){if((s=e.colorInfo.field)&&!n.isFunction(s)){if(i=!this._getField(s)&&this._getField(s,!0))s=e.colorInfo.field=i.name;t.push(s)}if((s=e.colorInfo.normalizationField)&&!n.isFunction(s)){if(i=!this._getField(s)&&this._getField(s,!0))s=e.colorInfo.normalizationField=i.name;t.push(s)}}!this._orderBy&&e.addBreak&&!n.isFunction(e.attributeField)&&(e.backgroundFillSymbol||this._hasSizeDiff(e))&&(this._orderBy=[e.attributeField+" DESC"])},this),this._rendererFields=r.filter(t,h.isDefined)}},_hasSizeDiff:function(e){var t=Number.MAX_VALUE,n=-Number.MAX_VALUE,i,s;return r.forEach(e.infos,function(e){if(s=e.symbol){i=0;switch(s.type){case"simplemarkersymbol":i=s.size;break;case"picturemarkersymbol":i=(s.width+s.height)/2;break;case"simplelinesymbol":case"cartographiclinesymbol":i=s.width;break;case"simplefillsymbol":case"picturefillsymbol":i=s.outline&&s.outline.width}i&&(t=Math.min(t,i),n=Math.max(n,i))}}),t!==Number.MAX_VALUE&&n!==-Number.MAX_VALUE&&1<Math.abs(n-t)},getOrderByFields:function(){var e=this.orderByFields||this._orderBy;return e&&e.length?e:null},_getField:function(e,t){var n=this.fields;if(!n||0===n.length)return null;var i;return t&&(e=e.toLowerCase()),r.some(n,function(n){var r=!1;return(r=t?n&&n.name.toLowerCase()===e?!0:!1:n&&n.name===e?!0:!1)&&(i=n),r}),i},_getDateOpts:function(){return this._dtOpts||(this._dtOpts={properties:r.map(r.filter(this.fields,function(e){return!!e&&"esriFieldTypeDate"===e.type}),function(e){return e.name})}),this._dtOpts},_applyNormalized:function(e,t){e&&t&&r.forEach(e,function(e,n){e&&t[n]&&e.setGeometry(t[n])})},_editHandler:function(e,t,n,i,s,o){s=e.addResults;var u=e.updateResults;e=e.deleteResults;var a,f,l,c,h=this.objectIdField,p=this._mode,d=this._isTable;a=this.editFieldsInfo;var v=this.getOutFields()||[],m=a&&a.creatorField,g=a&&a.creationDateField,y=a&&a.editorField,b=a&&a.editDateField;a=a&&a.realm,-1===r.indexOf(v,"*")&&(m&&-1===r.indexOf(v,m)&&(m=null),g&&-1===r.indexOf(v,g)&&(g=null),y&&-1===r.indexOf(v,y)&&(y=null),b&&-1===r.indexOf(v,b)&&(b=null));var v=g||b?(new Date).getTime():null,w=m||y?this.getUserId():void 0;w&&a&&(w=w+"@"+a);if(s)for(a=0;a<s.length;a++)s[a]=new P(s[a]),d||(f=s[a],f.success&&(f=f.objectId,l=t[a],(c=l._graphicsLayer)&&c!==this&&c.remove(l),c=l.attributes||{},c[h]=f,m&&(c[m]=w),y&&(c[y]=w),g&&(c[g]=v),b&&(c[b]=v),l.setAttributes(c),p._init&&p.drawFeature(l)));if(u)for(a=0;a<u.length;a++)if(u[a]=new P(u[a]),!d&&(f=u[a],f.success)){f=f.objectId,l=n[f];if(t=p._getFeature(f))t.geometry!==l.geometry&&t.setGeometry(k.fromJson(l.geometry.toJson())),this._repaint(t,f);l=t||l,c=l.attributes||{},y&&(c[y]=w),b&&(c[b]=v),l.setAttributes(c)}if(e){n=[];for(a=0;a<e.length;a++)if(e[a]=new P(e[a]),!d&&(f=e[a],f.success&&(f=f.objectId,l=p._getFeature(f))))this._unSelectFeatureIIf(f,p)&&n.push(l),l._count=0,p._removeFeatureIIf(f);0<n.length&&this.onSelectionComplete(n,this.constructor.SELECTION_SUBTRACT)}this._resolve([s,u,e],"onEditsComplete",i,o)},_sendAttachment:function(e,t,r,i,s){var o=this;return p({url:this._url.path+"/"+t+"/"+("add"===e?"addAttachment":"updateAttachment"),form:r,content:n.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(n){var r="add"===e?"onAddAttachmentComplete":"onUpdateAttachmentComplete";return n=new P(n["add"===e?"addAttachmentResult":"updateAttachmentResult"]),n.attachmentId=n.objectId,n.objectId=t,o._resolve([n],r,i),n}).addErrback(function(e){o._resolve([e],null,s,null,!0)})},_repaint:function(e,t,n){t=h.isDefined(t)?t:e.attributes[this.objectIdField],(!(t in this._selectedFeatures)||!this._selectionSymbol)&&e.setSymbol(e.symbol,n)},_getKind:function(e){var t=this._trackManager;return t?t.isLatestObservation(e)?1:0:0}}),n.mixin(e,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"}),L._createWrappers(e),u("extend-esri")&&n.setObject("layers.FeatureLayer",e,c),e}),define("esri/layers/ArcGISDynamicMapServiceLayer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/sniff dojo/io-query esri/kernel esri/config esri/request esri/urlUtils esri/layerUtils esri/geometry/scaleUtils esri/layers/DynamicMapServiceLayer esri/layers/ArcGISMapServiceLayer esri/layers/TimeInfo esri/layers/LayerTimeOptions esri/layers/ImageParameters esri/layers/DynamicLayerInfo esri/layers/LayerMapSource".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return e=e([h,p],{declaredClass:"esri.layers.ArcGISDynamicMapServiceLayer",_eventMap:{"gdb-version-change":!0},constructor:function(e,n,r){e=n&&n.imageParameters;var i=t.hitch;if(e){var s=e.layerDefinitions;s&&this.setLayerDefinitions(s),e.layerOption===m.LAYER_OPTION_SHOW&&(this.visibleLayers=[].concat(e.layerIds))}this._setIsPNG32=i(this,this._setIsPNG32),this.dpi=e&&e.dpi||96,this.imageFormat=e&&e.format||"png8",this.imageTransparency=e&&!1===e.transparent?!1:!0,this._setIsPNG32(),this.gdbVersion=n&&n.gdbVersion,this._params.gdbVersion=this.gdbVersion,t.mixin(this._params,this._url.query,{dpi:this.dpi,transparent:this.imageTransparency,format:this.imageFormat},e?e.toJson():{}),this.getImageUrl=i(this,this.getImageUrl),this._initLayer=i(this,this._initLayer),this._load=i(this,this._load),this.useMapImage=n?n.useMapImage:!1,this._loadCallback=n&&n.loadCallback,(n=n&&n.resourceInfo)?this._initLayer(n):(void 0===r||!1===r)&&this._load(),this.registerConnectEvents()},disableClientCaching:!1,layerDefinitions:null,_initLayer:function(e,t){this.inherited(arguments),e.timeInfo&&(this.timeInfo=new d(e.timeInfo)),this.loaded=!0,this.onLoad(this);var n=this._loadCallback;n&&(delete this._loadCallback,n(this))},getImageUrl:function(e,n,i,o){var l=this._url.path+"/export?",c=this._params,h=e.spatialReference.wkid||r.toJson(e.spatialReference.toJson()),p=this._errorHandler;delete c._ts,t.mixin(c,{bbox:e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:h,imageSR:h,size:n+","+i},this.disableClientCaching?{_ts:(new Date).getTime()}:{}),c.layerDefs&&(e=c.layerDefs,delete c.layerDefs,t.mixin(c,{layerDefs:e}));var d=c.token=this._getToken();e=f.addProxy(l+s.objectToQuery(t.mixin({},c,{f:"image"}))),e.length>u.defaults.io.postLength||this.useMapImage?this._jsonRequest=a({url:l,content:t.mixin(c,{f:"json"}),callbackParamName:"callback",load:function(e,t){var n=e.href;d&&(n+=-1===n.indexOf("?")?"?token="+d:"&token="+d),o(f.addProxy(n))},error:p}):o(e)},_setIsPNG32:function(){var e=this.imageFormat.toLowerCase(),t=i("ie");this.isPNG32=t&&6===t&&("png32"===e||"png24"===e)&&this.imageTransparency},_setTime:function(e){var t=this.timeInfo;e=this._params.time=e?e.toJson().join(","):null;if(10.02>this.version&&t)if(e)this._params.layerTimeOptions=l._serializeTimeOptions(this.layerTimeOptions);else{var r=this.layerInfos;if(r){var i=this.layerTimeOptions,s=i?i.slice(0):[],o=[];n.forEach(r,function(e){e.subLayerIds||o.push(e.id)}),o.length&&(n.forEach(o,function(e){if(!s[e]){var t=new v;t.useTime=!1,s[e]=t}}),this._params.layerTimeOptions=l._serializeTimeOptions(s,o))}}10.02<=this.version&&t&&!e&&!t.hasLiveData&&(this._params.time="null,null")},setDPI:function(e,t){this.dpi=this._params.dpi=e,t||this.refresh(!0)},setImageFormat:function(e,t){this.imageFormat=this._params.format=e,this._setIsPNG32(),t||this.refresh(!0)},setImageTransparency:function(e,t){this.imageTransparency=this._params.transparent=e,this._setIsPNG32(),t||this.refresh(!0)},setVisibleLayers:function(e,t){this.visibleLayers=e,this._params.layers=m.LAYER_OPTION_SHOW+":"+e.join(","),this._updateDynamicLayers(),t||this.refresh(!0)},setDefaultVisibleLayers:function(e){this.visibleLayers=this._defaultVisibleLayers,this._params.layers=null,this._updateDynamicLayers(),e||this.refresh(!0)},setLayerDefinitions:function(e,t){this.layerDefinitions=e,this._params.layerDefs=l._serializeLayerDefinitions(e),this._updateDynamicLayers(),t||this.refresh(!0)},setDefaultLayerDefinitions:function(e){this.layerDefinitions=this._params.layerDefs=null,this._updateDynamicLayers(),e||this.refresh(!0)},setDisableClientCaching:function(e){this.disableClientCaching=e},setLayerTimeOptions:function(e,t){this.layerTimeOptions=e,this._params.layerTimeOptions=l._serializeTimeOptions(e),this._updateDynamicLayers(),t||this.refresh(!0)},refresh:function(e){if(e)this.inherited(arguments);else{var t=this.disableClientCaching;this.disableClientCaching=!0,this.inherited(arguments),this.disableClientCaching=t}},setLayerDrawingOptions:function(e,t){this.layerDrawingOptions=e,this._updateDynamicLayers(),t||this.refresh(!0)},setDynamicLayerInfos:function(e,t){e&&0<e.length?(this.dynamicLayerInfos=e,this.visibleLayers=l._getDefaultVisibleLayers(e)):this.dynamicLayerInfos=this.layerDrawingOptions=null,this._updateDynamicLayers(),t||this.refresh(!0)},createDynamicLayerInfosFromLayerInfos:function(){var e=[],t;return n.forEach(this.layerInfos,function(n,r){t=new g(n.toJson()),t.source=new y({mapLayerId:n.id}),e.push(t)}),e},_onDynamicLayersChange:function(){},_updateDynamicLayers:function(){if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length||this.layerDrawingOptions&&0<this.layerDrawingOptions.length){if(!this.dynamicLayerInfos||0===this.dynamicLayerInfos.length)this.dynamicLayerInfos=this.createDynamicLayerInfosFromLayerInfos();var e;e=this.dynamicLayerInfos;var t=[],i=this._map&&c.getScale(this._map),s=this.visibleLayers,o=i?l._getLayersForScale(i,e):s;n.forEach(e,function(e){if(!e.subLayerIds){var r,i=e.id;if(-1!==n.indexOf(s,i)&&-1!==n.indexOf(o,i)){r={id:i},r.source=e.source&&e.source.toJson();var u;this.layerDefinitions&&this.layerDefinitions[i]&&(u=this.layerDefinitions[i]),u&&(r.definitionExpression=u);var a;this.layerDrawingOptions&&this.layerDrawingOptions[i]&&(a=this.layerDrawingOptions[i]),a&&(r.drawingInfo=a.toJson());var f;this.layerTimeOptions&&this.layerTimeOptions[i]&&(f=this.layerTimeOptions[i]),f&&(r.layerTimeOptions=f.toJson()),r.minScale=e.minScale||0,r.maxScale=e.maxScale||0,t.push(r)}}},this),e=r.toJson(t);if(!this._params.dynamicLayers||this._params.dynamicLayers.length!==e.length||this._params.dynamicLayers!==e)this._params.dynamicLayers=e,this._onDynamicLayersChange(this._params.dynamicLayers)}else this._params.dynamicLayers?(this._params.dynamicLayers=null,this._onDynamicLayersChange(null)):this._params.dynamicLayers=null},_onExtentChangeHandler:function(e,t,n){n&&this._updateDynamicLayers(),this.inherited(arguments)},_setMap:function(e,t,n){return this._map=e,this._updateDynamicLayers(),this.inherited(arguments)},onGDBVersionChange:function(){},setGDBVersion:function(e,t){this.gdbVersion=e,this._params.gdbVersion=e,this.onGDBVersionChange(),t||this.refresh(!0)},exportMapImage:function(e,n){var r=u.defaults.map,r=t.mixin({size:r.width+","+r.height},this._params,e?e.toJson(this.normalization):{},{f:"json"});delete r._ts;if(r.layerDefs){var i=r.layerDefs;delete r.layerDefs,t.mixin(r,{layerDefs:i})}this._exportMapImage(this._url.path+"/export",r,n)}}),i("extend-esri")&&t.setObject("layers.ArcGISDynamicMapServiceLayer",e,o),e}),define("esri/layers/ArcGISTiledMapServiceLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/io-query esri/kernel esri/urlUtils esri/SpatialReference esri/layers/TiledMapServiceLayer esri/layers/ArcGISMapServiceLayer esri/layers/TileInfo esri/layers/TimeInfo".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return t=t([l,c],{declaredClass:"esri.layers.ArcGISTiledMapServiceLayer",_agolAttrs:["ocean_basemap","world_imagery","world_street_map","world_topo_map"],constructor:function(t,i){i&&(i.roundrobin&&(e.deprecated(this.declaredClass+" : Constructor option 'roundrobin' deprecated. Use option 'tileServers'."),i.tileServers=i.roundrobin),this._setTileServers(i.tileServers),this._loadCallback=i.loadCallback),this._params=n.mixin({},this._url.query);var s=["servicesdev.arcgisonline.com/arcgis/rest/services","services.arcgisonline.com/arcgis/rest/services","servicesqa.arcgisonline.com/arcgis/rest/services"];this.resampling=this.resampling||r.some(s,function(e){return-1<t.toLowerCase().indexOf(e.toLowerCase())}),this._initLayer=n.hitch(this,this._initLayer),(s=i&&i.resourceInfo)?this._initLayer(s):(this._load=n.hitch(this,this._load),this._load())},_TILE_FORMATS:{PNG:"png",PNG8:"png",PNG24:"png",PNG32:"png",JPG:"jpg",JPEG:"jpg",GIF:"gif"},_setTileServers:function(e){if(e&&0<e.length){this.tileServers=e;var t,n=e.length;for(t=0;t<n;t++)e[t]=a.urlToObject(e[t]).path}},_initLayer:function(e,t){this.inherited(arguments),this.resourceInfo=i.toJson(e),this.tileInfo=new h(e.tileInfo),!this.spatialReference&&this.tileInfo.spatialReference&&(this.spatialReference=new f(this.tileInfo.spatialReference.toJson())),this.isPNG32="PNG24"===this.tileInfo.format||"PNG32"===this.tileInfo.format,e.timeInfo&&(this.timeInfo=new p(e.timeInfo));var n=this._url.path,s=this._loadCallback,o="file:"===window.location.protocol?"http:":window.location.protocol,u=n.match(/^https?\:\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+)\/mapserver/i),u=u&&u[2];if(!this.tileServers)if(e.tileServers)this._setTileServers(e.tileServers);else{var a=-1!==n.search(/^https?\:\/\/server\.arcgisonline\.com/i),l=-1!==n.search(/^https?\:\/\/services\.arcgisonline\.com/i);(a||l)&&this._setTileServers([n,n.replace(a?/server\.arcgisonline/i:/services\.arcgisonline/i,a?"services.arcgisonline":"server.arcgisonline")])}u&&-1!==r.indexOf(this._agolAttrs,u.toLowerCase())&&(this.hasAttributionData=!0,this.attributionDataUrl=this.attributionDataUrl||o+"//static.arcgis.com/attribution/"+u),this.loaded=!0,this.onLoad(this),s&&(delete this._loadCallback,s(this))},getTileUrl:function(e,t,n){var r=this.tileServers,i=this._getToken(),s=this._url.query;return e=(r?r[t%r.length]:this._url.path)+"/tile/"+e+"/"+t+"/"+n,this.resampling&&(e+="?blankTile=false"),s&&(e=this.resampling?e+("&"+o.objectToQuery(s)):e+("?"+o.objectToQuery(s))),i&&(!s||!s.token)&&(e+=(-1===e.indexOf("?")?"?":"&")+"token="+i),e=this.addTimestampToURL(e),a.addProxy(e)}}),s("extend-esri")&&n.setObject("layers.ArcGISTiledMapServiceLayer",t,u),t}),require({cache:{"url:esri/dijit/templates/TimeSlider.html":'   <div class="esriTimeSlider">\n   <table width="100%" cellspacing="0" cellpadding="0" border="0">\n   <tr>\n   <td align="right" valign="middle"><button dojoType="dijit.form.Button" showLabel="false" iconClass="tsButton tsPlayButton" dojoAttachEvent="onClick:_onPlay" dojoAttachPoint="playPauseBtn" type="button">${NLS_play}</button></td>\n   <td align="center" valign="middle" width="80%" class="tsTmp"></td>\n   <td align="left" valign="middle" width="30"><button dojoType="dijit.form.Button" showLabel="false" iconClass="tsButton tsPrevButton" dojoAttachEvent="onClick:_onPrev" dojoAttachPoint="previousBtn" type="button">${NLS_previous}</button></td>\n   <td align="left" valign="middle"><button dojoType="dijit.form.Button" showLabel="false" iconClass="tsButton tsNextButton" dojoAttachEvent="onClick:_onNext" dojoAttachPoint="nextBtn" type="button">${NLS_next}</button></td>\n   </tr>    \n   </table>\n   </div>',"url:dojox/form/resources/HorizontalRangeSlider.html":'<table class="dijit dijitReset dijitSlider dijitSliderH dojoxRangeSlider" cellspacing="0" cellpadding="0" border="0" rules="none" dojoAttachEvent="onkeypress:_onKeyPress,onkeyup:_onKeyUp" role="presentation"\n	><tr class="dijitReset"\n		><td class="dijitReset" colspan="2"></td\n		><td dojoAttachPoint="topDecoration" class="dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"></td\n		><td class="dijitReset" colspan="2"></td\n	></tr\n	><tr class="dijitReset"\n		><td class="dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\n			><div class="dijitSliderDecrementIconH" tabIndex="-1" style="display:none" dojoAttachPoint="decrementButton"><span class="dijitSliderButtonInner">-</span></div\n		></td\n		><td class="dijitReset"\n			><div class="dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" dojoAttachEvent="onmousedown:_onClkDecBumper"></div\n		></td\n		><td class="dijitReset"\n			><input dojoAttachPoint="valueNode" type="hidden" ${!nameAttrSetting}\n			/><div role="presentation" class="dojoxRangeSliderBarContainer" dojoAttachPoint="sliderBarContainer"\n				><div dojoAttachPoint="sliderHandle" tabIndex="${tabIndex}" class="dijitSliderMoveable dijitSliderMoveableH" dojoAttachEvent="onmousedown:_onHandleClick" role="slider"\n					><div class="dijitSliderImageHandle dijitSliderImageHandleH"></div\n				></div\n				><div role="presentation" dojoAttachPoint="progressBar,focusNode" class="dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" dojoAttachEvent="onmousedown:_onBarClick"></div\n				><div dojoAttachPoint="sliderHandleMax" tabIndex="${tabIndex}" class="dijitSliderMoveable dijitSliderMoveableH" dojoAttachEvent="onmousedown:_onHandleClickMax" role="slider"\n					><div class="dijitSliderImageHandle dijitSliderImageHandleH"></div\n				></div\n				><div role="presentation" dojoAttachPoint="remainingBar" class="dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" dojoAttachEvent="onmousedown:_onRemainingBarClick"></div\n			></div\n		></td\n		><td class="dijitReset"\n			><div class="dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" dojoAttachEvent="onmousedown:_onClkIncBumper"></div\n		></td\n		><td class="dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\n			><div class="dijitSliderIncrementIconH" tabIndex="-1" style="display:none" dojoAttachPoint="incrementButton"><span class="dijitSliderButtonInner">+</span></div\n		></td\n	></tr\n	><tr class="dijitReset"\n		><td class="dijitReset" colspan="2"></td\n		><td dojoAttachPoint="containerNode,bottomDecoration" class="dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"></td\n		><td class="dijitReset" colspan="2"></td\n	></tr\n></table>\n'}}),define("esri/dijit/TimeSlider","require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html esri/kernel esri/lang esri/TimeExtent esri/dijit/_EventedWidget dojo/text!esri/dijit/templates/TimeSlider.html dojo/i18n!esri/nls/jsapi".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){return e=t([E,l,c],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:S,basePath:e.toUrl("esri/dijit")+"/",_slideDuration:1e3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(e,t){n.mixin(this,x.widgets.timeSlider),this._iconClass="tsButton tsPlayButton",this.loop=this.playing=!1,this.thumbCount=1,this.thumbMovingRate=1e3,this._createTimeInstants=!1,this._options=n.mixin({excludeDataAtTrailingThumb:!1,excludeDataAtLeadingThumb:!1},e.options||{})},startup:function(){this.inherited(arguments),this._timer=new v.Timer,this._timer.setInterval(this.thumbMovingRate),this._timer.onTick=n.hitch(this,"_bumpSlider",1),this._createSlider()},destroy:function(){this._timer.stop(),this.timeStops=this._timer=null,this._slider.destroy(),this._slider=null,this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null),this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null),this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var e=this._sliderToTimeExtent();this.onTimeExtentChange(e)},_onPlay:function(){this.playing=!this.playing,this._updateUI(),this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var e=this._getSliderValue();this._offset=n.isArray(e)?e[1]-e[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(e,t){if(!e||!e.startTime||!e.endTime)console.log(this.NLS_invalidTimeExtent);else{t=t||this._defaultCount;var n=Math.ceil((e.endTime-e.startTime)/(t-1));this.createTimeStopsByTimeInterval(e,n,"esriTimeUnitsMilliseconds")}},createTimeStopsByTimeInterval:function(e,t,n,r){if(!e||!e.startTime||!e.endTime)console.log(this.NLS_invalidTimeExtent);else{this.fullTimeExtent=new w(e.startTime,e.endTime),r&&!0===r.resetStartTime&&this._resetStartTime(this.fullTimeExtent,n),this._timeIntervalUnits=n,r=this.fullTimeExtent.startTime;for(var i=[];r<=e.endTime;)i.push(r),r=e._getOffsettedDate(r,t,n);0<i.length&&i[i.length-1]<e.endTime&&i.push(r),this.setTimeStops(i)}},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(e){this.timeStops=e||[],this._numTicks=this._numStops=this.timeStops.length,!1===b.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=new w(e[0],e[e.length-1]))},setLoop:function(e){this.loop=e},setThumbCount:function(e){this.thumbCount=e,this.singleThumbAsTimeInstant(this._createTimeInstants),this._slider&&this._createSlider()},setThumbIndexes:function(e){this.thumbIndexes=n.clone(e)||[0,1],this._initializeThumbs()},setThumbMovingRate:function(e){this.thumbMovingRate=e,this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(e){this.labels=e,this._slider&&this._createSlider()},setTickCount:function(e){this._numTicks=e,this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(e){this._createTimeInstants=e&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1,this._updateUI(),this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_updateUI:function(){u.remove(this.playPauseBtn.iconNode,this._iconClass),this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton",u.add(this.playPauseBtn.iconNode,this._iconClass),this.previousBtn.set("disabled",this.playing),this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var e=this.domNode;e.parentNode&&!e.dir;)e=e.parentNode;e={onChange:n.hitch(this,"_onHorizontalChange"),showButtons:!1,discreteValues:this._numStops,slideDuration:this._slideDuration,"class":"ts",dir:e.dir},this._ts=a.create("div",{},i.query(".tsTmp",this.domNode)[0],"first"),this._timeSliderTicks=a.create("div",{},this._ts,"first"),this._timeSliderLabels=a.create("div",{},this._ts),2===this.thumbCount?this._createRangeSlider(e):this._createSingleSlider(e),this.thumbIndexes=this.thumbIndexes||[0,1],this._createHorizRule(),this._createLabels(),!0===this._createTimeInstants&&i.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper").forEach(function(e){f.set(e,{background:"none"})}),this._initializeThumbs(),r.disconnect(this._onChangeConnect),this._onChangeConnect=r.connect(this._slider,"onChange",n.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(e){this._isRangeSlider=!0,this._slider=new(t([h,m],{templateString:g}))(e,this._ts)},_createSingleSlider:function(e){this._isRangeSlider=!1,this._slider=new h(e,this._ts)},_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null),2>this._numTicks||(this._hTicks=new p({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null),this.labels&&0<this.labels.length&&(this._hLabels=new d({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var e=this._toSliderValue(this.thumbIndexes[0]),e=e>this._slider.maximum||e<this._slider.minimum?this._slider.minimum:e;if(!0===this._isRangeSlider){var t=this._toSliderValue(this.thumbIndexes[1]),t=t>this._slider.maximum||t<this._slider.minimum?this._slider.maximum:t;this._setSliderValue([e,t<e?e:t])}else this._setSliderValue(e);this._onHorizontalChange()}},_bumpSlider:function(e){var t=this._getSliderValue(),r=t,i=r,s=e;n.isArray(t)&&(i=t[0],r=t[1],s=[{change:e,useMaxValue:!0},{change:e,useMaxValue:!1}]),1e-10>Math.abs(i-this._slider.minimum)&&0>e||1e-10>Math.abs(r-this._slider.maximum)&&0<e?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),e=this._sliderToTimeExtent(),this.onTimeExtentChange(e),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(s)},_updateThumbIndexes:function(){var e=this._getSliderValue();n.isArray(e)?(this.thumbIndexes[0]=this._toSliderIndex(e[0]),this.thumbIndexes[1]=this._toSliderIndex(e[1])):this.thumbIndexes[0]=this._toSliderIndex(e)},_sliderToTimeExtent:function(){if(this.timeStops&&0!==this.timeStops.length){var e=new w,t=this._getSliderValue();return n.isArray(t)?(e.startTime=new Date(this.timeStops[this._toSliderIndex(t[0])]),e.endTime=new Date(this.timeStops[this._toSliderIndex(t[1])]),this._adjustTimeExtent(e)):(e.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(t)]):new Date(this.fullTimeExtent.startTime),e.endTime=!0===this._createTimeInstants?e.startTime:new Date(this.timeStops[this._toSliderIndex(t)])),e}},_adjustTimeExtent:function(e){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&e.startTime.getTime()!==e.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var t=e.startTime;t.setUTCSeconds(t.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(e=e.endTime,e.setUTCSeconds(e.getUTCSeconds()-1))}},_resetStartTime:function(e,t){switch(t){case"esriTimeUnitsSeconds":e.startTime.setUTCMilliseconds(0);break;case"esriTimeUnitsMinutes":e.startTime.setUTCSeconds(0,0,0);break;case"esriTimeUnitsHours":e.startTime.setUTCMinutes(0,0,0);break;case"esriTimeUnitsDays":e.startTime.setUTCHours(0,0,0,0);break;case"esriTimeUnitsWeeks":e.startTime.setUTCDate(e.startTime.getUTCDate()-e.startTime.getUTCDay());break;case"esriTimeUnitsMonths":e.startTime.setUTCDate(1),e.startTime.setUTCHours(0,0,0,0);break;case"esriTimeUnitsDecades":e.startTime.setUTCFullYear(e.startTime.getUTCFullYear()-e.startTime.getUTCFullYear()%10);break;case"esriTimeUnitsCenturies":e.startTime.setUTCFullYear(e.startTime.getUTCFullYear()-e.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(e){return e=Math.floor((e-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum)),0>e&&(e=0),e>=this._numStops&&(e=this._numStops-1),e},_toSliderValue:function(e){return e*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},_setSliderValue:function(e){this._slider._setValueAttr(e,!1,!1)}}),s("extend-esri")&&n.setObject("dijit.TimeSlider",e,y),e}),define("esri/kernel",["dojo/_base/kernel","dojo/_base/config","dojo/has"],function(e,t,n){var r=window.location,i=r.pathname,i={version:3.8,_appBaseUrl:r.protocol+"//"+r.host+i.substring(0,i.lastIndexOf(i.split("/")[i.split("/").length-1]))};return t.noGlobals||(window.esri=i),e.isAsync||n.add("extend-esri",1),(i.dijit=i.dijit||{})._arcgisUrl=r.protocol+"//www.arcgis.com/sharing/rest",i}),define("esri/TimeExtent",["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(e,t,n,r){var i=e(null,{declaredClass:"esri.TimeExtent",constructor:function(e){if(1<arguments.length)this._create(arguments[0],arguments[1]);else if(e)if(t.isArray(e)){var n=e[0],r=e[1];this.startTime=null===n||"null"===n?null:new Date(n),this.endTime=null===r||"null"===r?null:new Date(r)}else e instanceof Date&&this._create(e,null)},offset:function(e,t){var n=new i,r=this.startTime,s=this.endTime;return r&&(n.startTime=this._getOffsettedDate(r,e,t)),s&&(n.endTime=this._getOffsettedDate(s,e,t)),n},intersection:function(e){return this._intersection(this,e)},toJson:function(){var e=[],t=this.startTime;return e.push(t?t.getTime():"null"),t=this.endTime,e.push(t?t.getTime():"null"),e},_create:function(e,t){this.startTime=e?new Date(e.getTime()):null,this.endTime=t?new Date(t.getTime()):null},_refData:{esriTimeUnitsMilliseconds:{getter:"getUTCMilliseconds",setter:"setUTCMilliseconds",multiplier:1},esriTimeUnitsSeconds:{getter:"getUTCSeconds",setter:"setUTCSeconds",multiplier:1},esriTimeUnitsMinutes:{getter:"getUTCMinutes",setter:"setUTCMinutes",multiplier:1},esriTimeUnitsHours:{getter:"getUTCHours",setter:"setUTCHours",multiplier:1},esriTimeUnitsDays:{getter:"getUTCDate",setter:"setUTCDate",multiplier:1},esriTimeUnitsWeeks:{getter:"getUTCDate",setter:"setUTCDate",multiplier:7},esriTimeUnitsMonths:{getter:"getUTCMonth",setter:"setUTCMonth",multiplier:1},esriTimeUnitsYears:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:1},esriTimeUnitsDecades:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:10},esriTimeUnitsCenturies:{getter:"getUTCFullYear",setter:"setUTCFullYear",multiplier:100}},_intersection:function(e,t){if(e&&t){var n=e.startTime,r=e.endTime,s=t.startTime,o=t.endTime,n=n?n.getTime():-Infinity,s=s?s.getTime():-Infinity,r=r?r.getTime():Infinity,o=o?o.getTime():Infinity,u,a;s>=n&&s<=r?u=s:n>=s&&n<=o&&(u=n),r>=s&&r<=o?a=r:o>=n&&o<=r&&(a=o);if(!isNaN(u)&&!isNaN(a))return n=new i,n.startTime=-Infinity===u?null:new Date(u),n.endTime=Infinity===a?null:new Date(a),n}return null},_getOffsettedDate:function(e,t,n){var r=this._refData;return e=new Date(e.getTime()),t&&n&&(r=r[n],e[r.setter](e[r.getter]()+t*r.multiplier)),e}});return n("extend-esri")&&(r.TimeExtent=i),i}),define("esri/dijit/Scalebar","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/query esri/kernel esri/lang esri/domUtils esri/units esri/SpatialReference esri/WKIDUnitConversion esri/geometry/Point esri/geometry/ScreenPoint esri/geometry/Polyline esri/geometry/geodesicUtils esri/geometry/webMercatorUtils esri/geometry/screenUtils esri/geometry/normalizeUtils".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){return e=e(null,{declaredClass:"esri.dijit.Scalebar",map:null,mapUnit:null,scalebarUnit:null,unitsDictionary:[],domNode:null,screenPt1:null,screenPt2:null,constructor:function(e,o){this.metricScalebar=s.create("div",{innerHTML:"<div class='esriScaleLabelDiv'><div class='esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'></div></div><div class='esriScalebarLine esriScalebarMetricLine'></div>"}),this.englishScalebar=s.create("div",{innerHTML:"<div class='esriScalebarLine esriScalebarEnglishLine'></div><div class='esriScaleLabelDiv'><div class='esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'></div></div>"}),this.domNode=s.create("div"),e=e||{};if(e.map){if(e.scalebarUnit){if("english"!==e.scalebarUnit&&"metric"!==e.scalebarUnit&&"dual"!==e.scalebarUnit){console.error("scalebar unit only accepts english or metric or dual");return}this.scalebarUnit=e.scalebarUnit}else this.scalebarUnit="english";if(e.scalebarStyle){if("ruler"!==e.scalebarStyle&&"line"!==e.scalebarStyle){console.error("scalebar style must be ruler or line");return}this.scalebarStyle=e.scalebarStyle}else this.scalebarStyle="ruler";this.background=e.background;switch(this.scalebarUnit){case"english":"ruler"===this.scalebarStyle&&(this.englishScalebar.innerHTML="<div class='esriScalebarRuler'><div class='esriScalebarRulerBlock upper_firstpiece'></div><div class='esriScalebarRulerBlock upper_secondpiece'></div><div class='esriScalebarRulerBlock lower_firstpiece'></div><div class='esriScalebarRulerBlock lower_secondpiece'></div></div><div class='scaleLabelDiv'><div class='esriScalebarLabel' style='left: -3%'>0</div><div class='esriScalebarLabel esriScalebarFirstNumber'></div><div class='esriScalebarLabel esriScalebarSecondNumber'></div></div>"),this.domNode.appendChild(this.englishScalebar);break;case"metric":"ruler"===this.scalebarStyle&&(this.metricScalebar.innerHTML="<div class='esriScalebarRuler'><div class='esriScalebarRulerBlock upper_firstpiece'></div><div class='esriScalebarRulerBlock upper_secondpiece'></div><div class='esriScalebarRulerBlock lower_firstpiece'></div><div class='esriScalebarRulerBlock lower_secondpiece'></div></div><div class='scaleLabelDiv'><div class='esriScalebarLabel' style='left: -3%'>0</div><div class='esriScalebarLabel esriScalebarFirstNumber'></div><div class='esriScalebarLabel esriScalebarSecondNumber'></div></div>"),this.domNode.appendChild(this.metricScalebar);break;case"dual":this.domNode.appendChild(this.metricScalebar),this.domNode.appendChild(this.englishScalebar)}this.map=e.map,o?o.appendChild(this.domNode):(this.map.container.appendChild(this.domNode),e.attachTo?i.add(this.domNode,"scalebar_"+e.attachTo):i.add(this.domNode,"scalebar_bottom-left")),i.add(this.domNode,"esriScalebar");if(this.map.loaded)this._getDistance(this.map.extent),this._checkBingMaps();else var u=r.connect(this.map,"onLoad",this,function(){r.disconnect(u),u=null,this._getDistance(this.map.extent),this._checkBingMaps()});this._mapOnPan=r.connect(this.map,"onPan",this,this._getDistance),this._mapOnExtentChange=r.connect(this.map,"onExtentChange",this,this._getDistance),n.forEach(this.map.layerIds,function(e,n){"esri.virtualearth.VETiledLayer"===this.map.getLayer(e).declaredClass&&r.connect(this.map.getLayer(e),"onVisibilityChange",t.hitch(this,function(e){this._checkBingMaps()}))},this),this._mapOnLayerAdd=r.connect(this.map,"onLayerAdd",t.hitch(this,function(e){"esri.virtualearth.VETiledLayer"===e.declaredClass&&r.connect(e,"onVisibilityChange",t.hitch(this,function(e){this._checkBingMaps()})),this._checkBingMaps()})),this._mapOnLayerRemove=r.connect(this.map,"onLayerRemove",t.hitch(this,this._checkBingMaps))}else console.error("scalebar: unable to find the 'map' property in parameters")},hide:function(){this._hidden=!0,h.hide(this.domNode)},show:function(){this._hidden=!1,h.show(this.domNode)},destroy:function(){r.disconnect(this._mapOnPan),r.disconnect(this._mapOnExtentChange),r.disconnect(this._mapOnLayerAdd),r.disconnect(this._mapOnLayerRemove),this.hide(),this.map=null,s.destroy(this.domNode)},_checkBingMaps:function(){i.contains(this.domNode,"scalebar_bottom-left")&&(u.set(this.domNode,"left","25px"),n.forEach(this.map.layerIds,function(e,t){if("esri.virtualearth.VETiledLayer"===this.map.getLayer(e).declaredClass&&this.map.getLayer(e).visible){var n="95px";this.map._mapParams.nav&&(n="115px"),u.set(this.domNode,"left",n)}},this))},_getDistance:function(e){var t=o.position(this.domNode,!0).y-this.map.position.y,t=t>this.map.height?this.map.height:t,t=0>t?0:t,n=new g(0,t),t=new g(this.map.width,t),r,i;this.mapUnit="esriDecimalDegrees";var s=E.toMapPoint(e,this.map.width,this.map.height,n),u=E.toMapPoint(e,this.map.width,this.map.height,t),n=new m(e.xmin,(e.ymin+e.ymax)/2,this.map.spatialReference),t=new m(e.xmax,(e.ymin+e.ymax)/2,this.map.spatialReference);if(3857===this.map.spatialReference.wkid||102100===this.map.spatialReference.wkid||102113===this.map.spatialReference.wkid||this.map.spatialReference.wkt&&-1!=this.map.spatialReference.wkt.indexOf("WGS_1984_Web_Mercator"))s=w.webMercatorToGeographic(s,!0),u=w.webMercatorToGeographic(u,!0),n=w.webMercatorToGeographic(n,!0),t=w.webMercatorToGeographic(t,!0);else if(c.isDefined(v[this.map.spatialReference.wkid])||this.map.spatialReference.wkt&&0===this.map.spatialReference.wkt.indexOf("PROJCS")){this.mapUnit="linearUnit",e=Math.abs(e.xmax-e.xmin);if(c.isDefined(v[this.map.spatialReference.wkid]))i=v.values[v[this.map.spatialReference.wkid]];else{i=this.map.spatialReference.wkt,r=i.lastIndexOf(",")+1;var a=i.lastIndexOf("]]");i=parseFloat(i.substring(r,a))}e*=i,i=e/1609,r=e/1e3}"esriDecimalDegrees"===this.mapUnit&&(e=new y(new d({wkid:4326})),e.addPath([s,u]),s=S._straightLineDensify(e,10),e=b.geodesicLengths([s],p.KILOMETERS)[0],s=new y(new d({wkid:4326})),s.addPath([n,t]),n=S._straightLineDensify(s,10),b.geodesicLengths([n],p.KILOMETERS),i=e/1.609,r=e),"english"===this.scalebarUnit?this._getScaleBarLength(i,"mi"):"metric"===this.scalebarUnit?this._getScaleBarLength(r,"km"):"dual"===this.scalebarUnit&&(this._getScaleBarLength(i,"mi"),this._getScaleBarLength(r,"km"))},_getScaleBarLength:function(e,t){var n=50*e/this.map.width,r=0,i=t;.1>n&&("mi"===t?(n*=5280,i="ft"):"km"===t&&(n*=1e3,i="m"));for(;1<=n;)n/=10,r++;var s,o;.5<n?(s=1,o=.5):.3<n?(s=.5,o=.3):.2<n?(s=.3,o=.2):.15<n?(s=.2,o=.15):.1<n&&(s=.15,o=.1),s=s/n>=n/o?o:s,n=50*(s/n),r=Math.pow(10,r)*s,this._drawScaleBar(n,r,i)},_drawScaleBar:function(e,t,r){var i=2*Math.round(e),s,o;"mi"===r||"ft"===r?(this.englishScalebar.style.width=i+"px",e=f(".esriScalebarFirstNumber",this.englishScalebar),s=f(".esriScalebarSecondNumber",this.englishScalebar),o=f(".esriScalebarMetricLineBackground",this.englishScalebar)):(this.metricScalebar.style.width=i+"px",e=f(".esriScalebarFirstNumber",this.metricScalebar),s=f(".esriScalebarSecondNumber",this.metricScalebar),o=f(".esriScalebarMetricLineBackground",this.metricScalebar)),n.forEach(o,function(e,t){e.style.width=i-2+"px"},this),n.forEach(e,function(e,n){e.innerHTML=t},this),n.forEach(s,function(e,n){e.innerHTML="esriUnknown"!==this.mapUnit?2*t+r:2*t+"Unknown Unit"},this)}}),a("extend-esri")&&t.setObject("dijit.Scalebar",e,l),e}),define("esri/renderers/SimpleRenderer","dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/symbols/jsonUtils esri/renderers/Renderer".split(" "),function(e,t,n,r,i,s,o){return e=e(o,{declaredClass:"esri.renderer.SimpleRenderer",constructor:function(e){if(e&&!e.declaredClass){var t=e;this.symbol=(e=t.symbol)&&(e.declaredClass?e:s.fromJson(e)),this.label=t.label,this.description=t.description}else this.symbol=e},getSymbol:function(e){return this.symbol},toJson:function(){var e=t.mixin(this.inherited(arguments),{type:"simple",label:this.label,description:this.description,symbol:this.symbol&&this.symbol.toJson()});return i.fixJson(e)}}),n("extend-esri")&&t.setObject("renderer.SimpleRenderer",e,r),e}),define("esri/symbols/SimpleLineSymbol","dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base esri/kernel esri/lang esri/symbols/LineSymbol".split(" "),function(e,t,n,r,i,s,o,u){var a={STYLE_SOLID:"solid",STYLE_DASH:"dash",STYLE_DOT:"dot",STYLE_DASHDOT:"dashdot",STYLE_DASHDOTDOT:"longdashdotdot",STYLE_NULL:"none",STYLE_SHORTDASH:"shortdash",STYLE_SHORTDOT:"shortdot",STYLE_SHORTDASHDOT:"shortdashdot",STYLE_SHORTDASHDOTDOT:"shortdashdotdot",STYLE_LONGDASH:"longdash",STYLE_LONGDASHDOT:"longdashdot"},f={color:[0,0,0,1],style:a.STYLE_SOLID,width:1};return e=e(u,{declaredClass:"esri.symbol.SimpleLineSymbol",type:"simplelinesymbol",_styles:{solid:"esriSLSSolid",dash:"esriSLSDash",dot:"esriSLSDot",dashdot:"esriSLSDashDot",longdashdotdot:"esriSLSDashDotDot",none:"esriSLSNull",insideframe:"esriSLSInsideFrame",shortdash:"esriSLSShortDash",shortdot:"esriSLSShortDot",shortdashdot:"esriSLSShortDashDot",shortdashdotdot:"esriSLSShortDashDotDot",longdash:"esriSLSLongDash",longdashdot:"esriSLSLongDashDot"},constructor:function(e,r,s){e?t.isString(e)?(this.style=e,r&&(this.color=r),s&&(this.width=s)):this.style=o.valueOf(this._styles,e.style)||a.STYLE_SOLID:(t.mixin(this,f),this.color=new n(this.color),this.width=i.pt2px(this.width))},setStyle:function(e){return this.style=e,this},getStroke:function(){return this.style===a.STYLE_NULL||0===this.width?null:{color:this.color,style:this.style,width:this.width}},getFill:function(){return null},getShapeDescriptors:function(){return{defaultShape:{type:"path",path:"M -15,0 L 15,0 E"},fill:null,stroke:this.getStroke()}},toJson:function(){return o.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriSLS",style:this._styles[this.style]}))}}),t.mixin(e,a),e.defaultProps=f,r("extend-esri")&&(t.setObject("symbol.SimpleLineSymbol",e,s),s.symbol.defaultSimpleLineSymbol=f),e}),define("esri/symbols/SimpleFillSymbol","dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base esri/kernel esri/lang esri/symbols/FillSymbol esri/symbols/SimpleLineSymbol require".split(" "),function(e,t,n,r,i,s,o,u,a,f){var l={STYLE_SOLID:"solid",STYLE_NULL:"none",STYLE_HORIZONTAL:"horizontal",STYLE_VERTICAL:"vertical",STYLE_FORWARD_DIAGONAL:"forwarddiagonal",STYLE_BACKWARD_DIAGONAL:"backwarddiagonal",STYLE_CROSS:"cross",STYLE_DIAGONAL_CROSS:"diagonalcross",STYLE_FORWARDDIAGONAL:"forwarddiagonal",STYLE_BACKWARDDIAGONAL:"backwarddiagonal",STYLE_DIAGONALCROSS:"diagonalcross"},c={style:l.STYLE_SOLID,color:[0,0,0,.25]};return e=e(u,{declaredClass:"esri.symbol.SimpleFillSymbol",type:"simplefillsymbol",patternUrlPrefix:f.toUrl("esri")+"/images/symbol/sfs/",_styles:{solid:"esriSFSSolid",none:"esriSFSNull",horizontal:"esriSFSHorizontal",vertical:"esriSFSVertical",forwarddiagonal:"esriSFSForwardDiagonal",backwarddiagonal:"esriSFSBackwardDiagonal",cross:"esriSFSCross",diagonalcross:"esriSFSDiagonalCross"},constructor:function(e,r,i){e?t.isString(e)?(this.style=e,void 0!==r&&(this.outline=r),void 0!==i&&(this.color=i)):this.style=o.valueOf(this._styles,e.style):(t.mixin(this,c),this.outline=new a(this.outline),this.color=new n(this.color))},setStyle:function(e){return this.style=e,this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){var e=this.style;return e===l.STYLE_NULL?null:e===l.STYLE_SOLID?this.color:t.mixin({},i.defaultPattern,{src:this.patternUrlPrefix+e+".png",width:10,height:10})},getShapeDescriptors:function(){return{defaultShape:{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 E"},fill:this.getFill(),stroke:this.getStroke()}},toJson:function(){return o.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriSFS",style:this._styles[this.style]}))}}),t.mixin(e,l),e.defaultProps=c,r("extend-esri")&&(t.setObject("symbol.SimpleFillSymbol",e,s),s.symbol.defaultSimpleFillSymbol=c),e}),define("esri/symbols/SimpleMarkerSymbol","dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base esri/kernel esri/lang esri/symbols/MarkerSymbol esri/symbols/SimpleLineSymbol".split(" "),function(e,t,n,r,i,s,o,u,a){var f={STYLE_CIRCLE:"circle",STYLE_SQUARE:"square",STYLE_CROSS:"cross",STYLE_X:"x",STYLE_DIAMOND:"diamond",STYLE_PATH:"path",STYLE_TARGET:"target"},l={style:f.STYLE_CIRCLE,color:[255,255,255,.25],size:12,angle:0,xoffset:0,yoffset:0};return e=e(u,{declaredClass:"esri.symbol.SimpleMarkerSymbol",type:"simplemarkersymbol",_styles:{circle:"esriSMSCircle",square:"esriSMSSquare",cross:"esriSMSCross",x:"esriSMSX",diamond:"esriSMSDiamond",path:"esriSMSPath"},constructor:function(e,r,s,u){e?t.isString(e)?(this.style=e,r&&(this.size=r),s&&(this.outline=s),u&&(this.color=u)):(this.style=o.valueOf(this._styles,this.style),e.outline&&(this.outline=new a(e.outline))):(t.mixin(this,l),this.size=i.pt2px(this.size),this.outline=new a(this.outline),this.color=new n(this.color)),this.style||(this.style=f.STYLE_CIRCLE)},setStyle:function(e){return this.style=e,this},setPath:function(e){return this.path=e,this.setStyle(f.STYLE_PATH),this},setOutline:function(e){return this.outline=e,this},getStroke:function(){return this.outline&&this.outline.getStroke()},getFill:function(){return this.color},_setDim:function(e,t,n){this._targetWidth=e,this._targetHeight=t,this._spikeSize=n},getShapeDescriptors:function(){var e,t,n,r=this.style,s=(this.size||i.pt2px(l.size))/2,o=0-s,u=0+s,a=0-s,c=0+s;switch(r){case f.STYLE_CIRCLE:e={type:"circle",cx:0,cy:0,r:s},t=this.getFill();if(n=this.getStroke())n.style=n.style||"Solid";break;case f.STYLE_CROSS:e={type:"path",path:"M "+o+",0 L "+u+",0 M 0,"+a+" L 0,"+c+" E"},t=null,n=this.getStroke();break;case f.STYLE_DIAMOND:e={type:"path",path:"M "+o+",0 L 0,"+a+" L "+u+",0 L 0,"+c+" L "+o+",0 E"},t=this.getFill(),n=this.getStroke();break;case f.STYLE_SQUARE:e={type:"path",path:"M "+o+","+c+" L "+o+","+a+" L "+u+","+a+" L "+u+","+c+" L "+o+","+c+" E"},t=this.getFill(),n=this.getStroke();break;case f.STYLE_X:e={type:"path",path:"M "+o+","+c+" L "+u+","+a+" M "+o+","+a+" L "+u+","+c+" E"},t=null,n=this.getStroke();break;case f.STYLE_PATH:e={type:"path",path:this.path||""},t=this.getFill(),n=this.getStroke()}return{defaultShape:e,fill:t,stroke:n}},toJson:function(){var e=t.mixin(this.inherited("toJson",arguments),{type:"esriSMS",style:this._styles[this.style]}),n=this.outline;return n&&(e.outline=n.toJson()),e.path=this.path,o.fixJson(e)}}),t.mixin(e,f),e.defaultProps=l,r("extend-esri")&&(t.setObject("symbol.SimpleMarkerSymbol",e,s),s.symbol.defaultSimpleMarkerSymbol=l),e}),define("esri/geometry/Point","dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/lang esri/SpatialReference esri/geometry/Geometry".split(" "),function(e,t,n,r,i,s,o){function u(e,t){89.99999<t?t=89.99999:-89.99999>t&&(t=-89.99999);var n=t*h;return[e*h*f,f/2*Math.log((1+Math.sin(n))/(1-Math.sin(n)))]}function a(e,t,n){return e=e/f*c,n?(t=l/2-2*Math.atan(Math.exp(-1*t/f)),[e,t*c]):(n=e-360*Math.floor((e+180)/360),t=l/2-2*Math.atan(Math.exp(-1*t/f)),[n,t*c])}var f=6378137,l=3.141592653589793,c=57.29577951308232,h=.017453292519943,p={type:"point",x:0,y:0};return e=e(o,{declaredClass:"esri.geometry.Point",constructor:function(e,n,r){t.mixin(this,p),t.isArray(e)?(this.x=e[0],this.y=e[1],this.spatialReference=n):t.isObject(e)?(t.mixin(this,e),i.isDefined(this.latitude)&&(this.y=this.latitude),i.isDefined(this.longitude)&&(this.x=this.longitude),this.spatialReference&&(this.spatialReference=new s(this.spatialReference))):(this.x=e,this.y=n,this.spatialReference=r),this.verifySR()},offset:function(e,t){return new this.constructor(this.x+e,this.y+t,this.spatialReference)},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setLongitude:function(e){var t=this.spatialReference;return t&&(t._isWebMercator()?this.x=u(e,this.y)[0]:4326===t.wkid&&(this.x=e)),this},setLatitude:function(e){var t=this.spatialReference;return t&&(t._isWebMercator()?this.y=u(this.x,e)[1]:4326===t.wkid&&(this.y=e)),this},getLongitude:function(){var e=this.spatialReference,t;return e&&(e._isWebMercator()?t=a(this.x,this.y)[0]:4326===e.wkid&&(t=this.x)),t},getLatitude:function(){var e=this.spatialReference,t;return e&&(e._isWebMercator()?t=a(this.x,this.y)[1]:4326===e.wkid&&(t=this.y)),t},update:function(e,t){return this.x=e,this.y=t,this},normalize:function(){var e=this.x,t=this.spatialReference;if(t){var n=t._getInfo();if(n){var r=n.valid[0],i=n.valid[1],n=2*i;e>i?(r=Math.ceil(Math.abs(e-i)/n),e-=r*n):e<r&&(r=Math.ceil(Math.abs(e-r)/n),e+=r*n)}}return new this.constructor(e,this.y,t)},toJson:function(){var e={x:this.x,y:this.y},t=this.spatialReference;return t&&(e.spatialReference=t.toJson()),e}}),e.lngLatToXY=u,e.xyToLngLat=a,e.defaultProps=p,n("extend-esri")&&(t.setObject("geometry.Point",e,r),r.geometry.defaultPoint=p),e}),define("modules/featureevents.js",[],function(){return{enable:function(e){for(var t=0,n=e.length;t<n;t++)e[t].enableMouseEvents()},disable:function(e){for(var t=0,n=e.length;t<n;t++)e[t].disableMouseEvents()}}}),define("modules/tools.js",["dojo/dom-class","dojo/query","modules/featureevents.js"],function(e,t,n){var r;return{toggle:function(n,i){var s=t(".activeTool")[0],o=n.target;o===s?(e.remove(o,"activeTool"),i.stop(),r=null):(s&&(e.replace(s,"idle","activeTool"),r.tool.idle()),e.contains(o,"idle")?(e.replace(o,"activeTool","idle"),i.revive()):(e.add(o,"activeTool"),i.start()),r={node:o,tool:i})},wipe:function(r,i,s){r.stop(),e.contains(i,"idle")?(e.remove(i,"idle"),t(".activeTool")[0]&&n.disable(s)):e.contains(i,"activeTool")&&e.remove(i,"activeTool")}}}),define("modules/popup.js",["dojo/dom-class","dojo/on","dojo/query"],function(e,t,n){return function(){var r,i=window,s=document,o=s.body.style,u=[],a,f,l,c,h,p,d,v,m,g,y,b=400,w=600,E={left:60,right:660,top:100,bottom:500},S="px",x=i.innerWidth,T=i.innerHeight,N={width:null,height:null},C=s.all&&s.addEventListener&&!window.atob?!0:!1,k,L=120,A,O,M=1,_=function(){var e=s.getElementsByTagName("script")[0],t=s.createElement("link");t.rel="stylesheet",t.href="modules/popup.css",e.parentNode.insertBefore(t,e),e=null,a=s.createElement("div"),a.id="popUp",a.innerHTML='<div id = "popHeader"class = "panehead"> <span id = "popTitle">Profile Tool</span> <div id = "popClose"class = "closebox"></div> </div> <div id = "popContainer"></div> <div id = "popSplitterV"> <div id = "popLineV"></div> </div> <div id = "popSplitterH"> <div id = "popLineH"></div> </div>',s.body.appendChild(a)},D=function(){_(),f=a.style,l=s.getElementById("popHeader"),c=l.style,h=s.getElementById("popContainer"),p=h.style,d=s.getElementById("popSplitterV"),v=d.style,m=s.getElementById("popSplitterH"),g=m.style,y=s.getElementById("popClose"),p.width="593px",r=this},P=function(){a||D(),C?(f.left=E.left+S,f.top=E.top+S):(f.transform="translate3d("+E.left+"px,"+E.top+"px, 0)",f["-webkit-transform"]="translate3d("+E.left+"px,"+E.top+"px, 0)"),B()},H=function(){C?(f.left="10000px",f.top="10000px"):(f.transform="translate3d(10000px, 10000px, 0)",f["-webkit-transform"]="translate3d(10000px, 10000px, 0)"),j()},B=function(){u[0]||(u=[t(l,"mousedown",U),t(d,"mousedown",function(e){r.resize(e,"width","pageX",x,E.left,"right")}),t(m,"mousedown",function(e){r.resize(e,"height","pageY",T,E.top,"bottom")})])},j=function(){for(var e=0,t=u.length;e<t;e++)u[e].remove();u.length=0},F=function(t){if(t.length)for(var n=0;n<t.length;n++)e.replace(t[n],"unselectable","selectable")},I=function(t){if(t.length)for(var n=0;n<t.length;n++)e.replace(t[n],"selectable","unselectable")},q=function(e){M&&(i.requestAnimationFrame(function(){R(e)}),M=0)},R=function(e){var t=e.pageX-A,n=t+w,r=e.pageY-O,i=r+b,s,o;t<0?(t=0,A=e.pageX,N.width||(N.width=w)):n>x&&(n=x,N.width||(N.width=w)),N.width&&(n<x-t?(s=n,t=0,A=e.pageX):(n=x,s=n-t),s>=N.width&&(s=N.width,N.width=null)),r<0?(r=0,N.height||(N.height=b)):i>T&&(i=T,N.height||(N.height=b)),N.height&&(i<T-r?(r=0,o=i):(i=T,o=i-r),o>=N.height&&(o=N.height,N.height=null)),w!==s&&s>=L&&(f.width=s+S,p.width=s-7+S,w=s),b!==o&&o>=L&&(f.height=o+S,p.height=o-34+S,b=o),r>T-L&&(r=T-L),t>x-L&&(t=x-L),C?(f.left=t+S,f.top=r+S):(f.transform="translate3d("+t+"px,"+r+"px, 0)",f["-webkit-transform"]="translate3d("+t+"px,"+r+"px, 0)"),E.left=t,E.right=n,E.top=r,E.bottom=i,M=1},U=function(e){var r=e.target;A=e.offsetX||e.layerX,O=e.offsetY||e.layerY,o["-webkit-user-select"]="none",o["-moz-user-select"]="none",p.display="none",f.boxShadow="0 0 0",f.opacity="0.7",g.display="none",v.display="none",c.boxShadow="0 0 0",r.id!=="popHeader"&&(A+=r.offsetLeft,O+=r.offsetTop),k=n(".selectable"),F(k);var s=t(i,"mousemove",q);t.once(i,"mouseup",function(e){s.remove(),o["-webkit-user-select"]="text",o["-moz-user-select"]="text",f.opacity="1",f.boxShadow="0 1px 2px 1px #a5b6e0, 0px 0px 2px 0 #a5b6e0",c.boxShadow="0px 2px 2px -1px #a5b6e0",p.display="block",v.display="block",g.display="block",I(k)})},z=function(e,n,r,s,u,a){function v(e){var t=e[r],i;t<=s&&(i=t-u,i>=120&&(f[n]=i+S,p[n]=i-l+S,n==="width"?w=i:b=i,E[a]=t)),c=1}function m(e){c&&(i.requestAnimationFrame(function(){v(e)}),c=0)}o["-webkit-user-select"]="none",o["-moz-user-select"]="none";var l=n==="width"?7:34,c=1,h=120,d=t(i,"mousemove",m);t.once(i,"mouseup",function(e){d.remove(),N[n]&&(N[n]=n==="width"?w:b),o["-webkit-user-select"]="text",o["-moz-user-select"]="text"})},W=function(){return h},X=function(){return y};return{init:D,show:P,hide:H,move:U,resize:z,getContainer:W,getClose:X}}}),define("esri/graphic","dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/domUtils esri/lang esri/InfoTemplate esri/geometry/jsonUtils esri/symbols/jsonUtils".split(" "),function(e,t,n,r,i,s,o,u,a){return e=e(null,{declaredClass:"esri.Graphic",constructor:function(e,t,n,r){e&&!e.declaredClass?(this.geometry=e.geometry?u.fromJson(e.geometry):null,this.symbol=e.symbol?a.fromJson(e.symbol):null,this.attributes=e.attributes||null,this.infoTemplate=e.infoTemplate?new o(e.infoTemplate):null):(this.geometry=e,this.symbol=t,this.attributes=n,this.infoTemplate=r)},_shape:null,_graphicsLayer:null,_visible:!0,visible:!0,getDojoShape:function(){return this._shape},getShapes:function(){var e=[];return this._shape&&e.push(this._shape),this._bgShape&&e.push(this._bgShape),e},getNode:function(){var e=this._shape&&this._shape.getNode();return e&&e.nodeType?e:null},getNodes:function(){var e=this.getShapes(),t,n,r=e.length,i=[];for(n=0;n<r;n++)(t=e[n]&&e[n].getNode())&&t.nodeType&&i.push(t);return i},getLayer:function(){return this._graphicsLayer},draw:function(){var e=this._graphicsLayer;return e&&e._draw(this,!0),this},setGeometry:function(e){this.geometry=e;if(e=this._graphicsLayer)e._updateExtent(this),e._draw(this,!0);return this},setSymbol:function(e,t){var n=this._graphicsLayer,r=this._shape;if(this.symbol=e)this.symbol._stroke=this.symbol._fill=null;return n&&(t&&r&&n._removeShape(this),n._draw(this,!0)),this},setAttributes:function(e){return this.attributes=e,this},setInfoTemplate:function(e){return this.infoTemplate=e,this},getInfoTemplate:function(){return this._getEffInfoTemplate()},_getEffInfoTemplate:function(){var e=this.getLayer();return this.infoTemplate||e&&e.infoTemplate},getTitle:function(){var e=this.getInfoTemplate(),n=e&&e.title;if(t.isFunction(n))n=n.call(e,this);else if(t.isString(n))var r=(e=this._graphicsLayer)&&e._getDateOpts,n=s.substitute(this.attributes,n,{first:!0,dateFormat:r&&r.call(e)});return n},getContent:function(){var e=this.getInfoTemplate(),n=e&&e.content;if(t.isFunction(n))n=n.call(e,this);else if(t.isString(n))var r=(e=this._graphicsLayer)&&e._getDateOpts,n=s.substitute(this.attributes,n,{dateFormat:r&&r.call(e)});return n},attr:function(e,t){var n=this.getNodes(),r,i=n.length;for(r=0;r<i;r++)null==t?n[r].removeAttribute(e):n[r].setAttribute(e,t);return this},show:function(){this.visible=this._visible=!0;var e,t,n;if(this.getShapes().length){e=this.getNodes(),n=e.length,this.attr("data-hidden");for(t=0;t<n;t++)i.show(e[t])}else this._graphicsLayer&&this._graphicsLayer._draw(this,!0);return this},hide:function(){this.visible=this._visible=!1;var e=this._graphicsLayer,t,n;if(e)if("canvas-2d"===e.surfaceType)e._removeShape(this);else if(e=this.getNodes(),n=e.length){this.attr("data-hidden","");for(t=0;t<n;t++)i.hide(e[t])}return this},toJson:function(){var e={};return this.geometry&&(e.geometry=this.geometry.toJson()),this.attributes&&(e.attributes=t.mixin({},this.attributes)),this.symbol&&(e.symbol=this.symbol.toJson()),this.infoTemplate&&(e.infoTemplate=this.infoTemplate.toJson()),e}}),e.prototype.getShape=e.prototype.getDojoShape,n("extend-esri")&&(r.Graphic=e),e}),define("modules/addsymbol.js",["esri/graphic"],function(e){return function(t,n,r,i){var s=new e(n,r);return t.graphics.add(s),i.push(s),s}}),define("esri/symbols/TextSymbol","dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/has dojox/gfx/_base esri/kernel esri/lang esri/symbols/Symbol esri/symbols/Font".split(" "),function(e,t,n,r,i,s,o,u,a){var f={type:"textsymbol",x:0,y:0,text:"",rotated:!1,kerning:!0,color:[0,0,0,1],font:i.defaultFont,angle:0,xoffset:0,yoffset:0,horizontalAlignment:"center"},l={start:"left",middle:"center",end:"right"},c={left:"start",center:"middle",right:"end",justify:"start"},h={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"};return e=e(u,{declaredClass:"esri.symbol.TextSymbol",angle:0,xoffset:0,yoffset:0,constructor:function(e,r,s){t.mixin(this,f),this.font=new a(this.font),this.color=new n(this.color),e&&(t.isObject(e)?(t.mixin(this,e),this.color&&o.isDefined(this.color[0])&&(this.color=u.toDojoColor(this.color)),this.type="textsymbol",this.font=new a(this.font),this.xoffset=i.pt2px(this.xoffset),this.yoffset=i.pt2px(this.yoffset),this.angle&&(this.angle*=-1)):(this.text=e,r&&(this.font=r),s&&(this.color=s))),this.setAlign(this.align||this.getSVGAlign())},setFont:function(e){return this.font=e,this},setAngle:function(e){return this.angle=e,this},setOffset:function(e,t){return this.xoffset=e,this.yoffset=t,this},setAlign:function(e){return this.align=e,this.setHorizontalAlignment(e&&l[e.toLowerCase()]||"center"),this},setHorizontalAlignment:function(e){return this.horizontalAlignment=e,this},getSVGAlign:function(){var e=this.horizontalAlignment;return e=e&&c[e.toLowerCase()]||"middle"},setVerticalAlignment:function(e){return this.verticalAlignment=e,this},getSVGBaseline:function(){var e=this.verticalAlignment;return e&&h[e.toLowerCase()]||"alphabetic"},getSVGBaselineShift:function(){return"bottom"===this.verticalAlignment?"super":null},setDecoration:function(e){return this.decoration=e,this.font||this.setFont(new a),this.font.setDecoration(e),this},setRotated:function(e){return this.rotated=e,this},setKerning:function(e){return this.kerning=e,this},setText:function(e){return this.text=e,this},getStroke:function(){return null},getFill:function(){return this.color},getWidth:function(){var e=this.getHeight(),t=0,n,r;for(n=0;n<this.text.length;n++)r=this.text.charAt(n),t=r==r.toUpperCase()?t+.7*e:t+.5*e;return t},getHeight:function(){return i.normalizedLength(this.font.size)},toJson:function(){var e=i.px2pt(this.xoffset),n=i.px2pt(this.yoffset),e=isNaN(e)?void 0:e,n=isNaN(n)?void 0:n;return o.fixJson(t.mixin(this.inherited("toJson",arguments),{type:"esriTS",backgroundColor:this.backgroundColor,borderLineColor:this.borderLineColor,borderLineSize:this.borderLineSize,haloSize:this.haloSize,haloColor:this.haloColor,verticalAlignment:this.verticalAlignment,horizontalAlignment:this.horizontalAlignment,rightToLeft:this.rightToLeft,width:this.width,angle:this.angle&&-1*this.angle,xoffset:e,yoffset:n,text:this.text,rotated:this.rotated,kerning:this.kerning,font:this.font.toJson()}))}}),t.mixin(e,{ALIGN_START:"start",ALIGN_MIDDLE:"middle",ALIGN_END:"end",DECORATION_NONE:"none",DECORATION_UNDERLINE:"underline",DECORATION_OVERLINE:"overline",DECORATION_LINETHROUGH:"line-through"}),e.defaultProps=f,r("extend-esri")&&(t.setObject("symbol.TextSymbol",e,s),s.symbol.defaultTextSymbol=f),e}),define("esri/symbols/Font","dojo/_base/declare dojo/_base/lang dojo/sniff dojox/gfx/_base esri/kernel esri/lang".split(" "),function(e,t,n,r,i,s){return e=e(null,{declaredClass:"esri.symbol.Font",constructor:function(e,i,s,o,u){e?t.isObject(e)?t.mixin(this,e):(this.size=e,parseFloat(this.size)==this.size&&(this.size+="px"),void 0!==i&&(this.style=i),void 0!==s&&(this.variant=s),void 0!==o&&(this.weight=o),void 0!==u&&(this.family=u)):t.mixin(this,r.defaultFont),parseFloat(this.size)==this.size&&(this.size+="pt"),9>n("ie")&&this.size&&t.isString(this.size)&&-1<this.size.indexOf("em")&&(this.size=r.pt2px(12*parseFloat(this.size))+"px"),this.size=this._convert2PxSize(this.size)},setSize:function(e){return this.size=this._convert2PxSize(e),this},_convert2PxSize:function(e){var n;return parseFloat(e)==e?n=e:t.isString(e)&&(-1<e.indexOf("pt")?n=r.pt2px(parseFloat(e)):-1<e.indexOf("px")?n=parseFloat(e):-1<e.indexOf("em")?n=r.pt2px(12*parseFloat(e)):-1<e.indexOf("%")&&(n=r.pt2px(.12*parseFloat(e)))),n},setStyle:function(e){return this.style=e,this},setVariant:function(e){return this.variant=e,this},setWeight:function(e){return this.weight=e,this},setFamily:function(e){return this.family=e,this},setDecoration:function(e){return this.decoration=e,this},toJson:function(){return s.fixJson({size:r.px2pt(this.size),style:this.style,variant:this.variant,decoration:this.decoration,weight:this.weight,family:this.family})}}),t.mixin(e,{STYLE_NORMAL:"normal",STYLE_ITALIC:"italic",STYLE_OBLIQUE:"oblique",VARIANT_NORMAL:"normal",VARIANT_SMALLCAPS:"small-caps",WEIGHT_NORMAL:"normal",WEIGHT_BOLD:"bold",WEIGHT_BOLDER:"bolder",WEIGHT_LIGHTER:"lighter"}),n("extend-esri")&&t.setObject("symbol.Font",e,i),e}),define("modules/addtextsymbol.js",["esri/symbols/TextSymbol","esri/symbols/Font"],function(e,t){function n(t,r,i,s,o,u,a){var f=new e(r),l,c=Math.pow(t.extent.getWidth(),.1)+8,h=Math.sin(.87+s),p=Math.cos(.87+s);return o&&f.setColor(o),f.setOffset(h*c,p*c),f.setFont=n.font,l=new esri.Graphic(i,f),t.graphics.add(l),u.push(l),a.push(t.on("zoom-end",function(e){var n=Math.pow(t.extent.getWidth(),.1)+8;f.setOffset(h*n,p*n)})),f}return n.font=new t("14px","STYLE_NORMAL","VARIANT_NORMAL","WEIGHT_BOLDER"),n}),define("esri/tasks/IdentifyTask","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has esri/kernel esri/request esri/geometry/normalizeUtils esri/tasks/Task esri/tasks/IdentifyResult".split(" "),function(e,t,n,r,i,s,o,u,a){return e=e(u,{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(e,n){this._url.path+="/identify",this._handler=t.hitch(this,this._handler),this.gdbVersion=n&&n.gdbVersion,this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(e,t,r,i,s){try{var o=[];n.forEach(e.results,function(e,t){o[t]=new a(e)}),this._successHandler([o],"onComplete",r,s)}catch(u){this._errorHandler(u,i,s)}},execute:function(e,n,r,i){var o=i.assembly;e=this._encode(t.mixin({},this._url.query,{f:"json"},e.toJson(o&&o[0])));var u=this._handler,a=this._errorHandler;return this.gdbVersion&&(e.gdbVersion=this.gdbVersion),s({url:this._url.path,content:e,callbackParamName:"callback",load:function(e,t){u(e,t,n,r,i.dfd)},error:function(e){a(e,r,i.dfd)}})},onComplete:function(){}}),o._createWrappers(e),r("extend-esri")&&t.setObject("tasks.IdentifyTask",e,i),e}),define("esri/tasks/IdentifyParameters","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has esri/kernel esri/layerUtils esri/geometry/jsonUtils esri/geometry/scaleUtils".split(" "),function(e,t,n,r,i,s,o,u,a){var f=e(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=f.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(e){var t=e&&e.geometry||this.geometry,i=this.mapExtent,s=this.spatialReference,f=this.layerIds;e={geometry:t,tolerance:this.tolerance,returnGeometry:this.returnGeometry,mapExtent:i,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset},t&&(e.geometryType=u.getJsonType(t)),null!==s?e.sr=s.wkid||r.toJson(s.toJson()):t?e.sr=t.spatialReference.wkid||r.toJson(t.spatialReference.toJson()):i&&(e.sr=i.spatialReference.wkid||r.toJson(i.spatialReference.toJson())),e.layers=this.layerOption,f&&(e.layers+=":"+f.join(",")),e.layerDefs=o._serializeLayerDefinitions(this.layerDefinitions),t=this.timeExtent,e.time=t?t.toJson().join(","):null,e.layerTimeOptions=o._serializeTimeOptions(this.layerTimeOptions);if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){var i=a.getScale({extent:i,width:this.width,spatialReference:i.spatialReference}),l=o._getLayersForScale(i,this.dynamicLayerInfos),c=[];n.forEach(this.dynamicLayerInfos,function(e){if(!e.subLayerIds){var t=e.id;if((!this.layerIds||this.layerIds&&-1!==n.indexOf(this.layerIds,t))&&-1!==n.indexOf(l,t)){var r={id:t};r.source=e.source&&e.source.toJson();var i;this.layerDefinitions&&this.layerDefinitions[t]&&(i=this.layerDefinitions[t]),i&&(r.definitionExpression=i);var s;this.layerTimeOptions&&this.layerTimeOptions[t]&&(s=this.layerTimeOptions[t]),s&&(r.layerTimeOptions=s.toJson()),c.push(r)}}},this),i=r.toJson(c),"[]"===i&&(i="[{}]"),e.dynamicLayers=i}return e}});return t.mixin(f,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"}),i("extend-esri")&&t.setObject("tasks.IdentifyParameters",f,s),f}),define("esri/tasks/IdentifyResult","dojo/_base/declare dojo/_base/lang dojo/has esri/kernel esri/graphic esri/geometry/jsonUtils".split(" "),function(e,t,n,r,i,s){return e=e(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(e){t.mixin(this,e),this.feature=new i(e.geometry?s.fromJson(e.geometry):null,null,e.attributes),delete this.geometry,delete this.attributes}}),n("extend-esri")&&t.setObject("tasks.IdentifyResult",e,r),e}),define("esri/tasks/identify",["esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/tasks/IdentifyResult"],function(){return{}}),define("modules/identify.js",["esri/tasks/identify","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters"],function(e,t,n){return function(e,r,i,s){function f(e){var t=l.output;t.length=0;if(e.length>0)for(var n=0,r=e.length;n<r;n++)(s[e[n].layerId+1]||a)&&t.push(e[n]);return t}function l(e,t){var n=e.execute(t);return n.then(f)}var o=new t(e),u=new n,a=s?0:1;return u.layerOption=n.LAYER_OPTION_VISIBLE,u.tolerance=1,u.layerIds=i,u.returnGeometry=!1,l.output=[],function(e){return u.geometry=e,u.mapExtent=r.extent,u.height=r.height,u.width=r.width,l(o,u)}}}),define("modules/clearnode.js",[],function(){return function(t){while(t.hasChildNodes())t.firstChild=null,t.removeChild(t.firstChild)}}),define("modules/cleargraphics.js",[],function(){return function(e,t){var n=e.graphics;for(var r=0,i=t.length;r<i;r++)n.remove(t[r])}}),define("modules/colorrampobject.js",[],function(){return{0:"No Data",9802:-61.9,9842:-55.9,10060:-61.6,10062:-61.2,10063:-61,10065:-60.7,10091:-57,10093:-56.6,10095:-56.4,10096:-56.1,10323:-60.5,10325:-60.2,10327:-59.9,10329:-59.5,10331:-59.3,10333:-59,10335:-58.8,10337:-58.5,10339:-58.2,10341:-57.8,10343:-57.6,10344:-57.3,10356:-55.6,10615:-55.2,11129:-54.9,11900:-54.8,12158:-54.4,12929:-54.2,13444:-53.9,14214:-53.6,14472:-53.2,15243:-52.9,16014:-52.7,16528:-52.5,17043:-52.2,17813:-51.8,18584:-51.5,19098:-51.3,19869:-51,20640:-50.8,21154:-50.5,21925:-50.2,22951:-49.8,23209:-49.5,23212:-49.3,23471:-49,23474:-48.8,23477:-48.4,23736:-48.1,23739:-47.9,23741:-47.6,23773:-44.4,23777:-44.2,23779:-43.8,23782:-43.7,24e3:-47.3,24004:-46.9,24006:-46.7,24009:-46.4,24012:-46.1,24015:-45.9,24018:-45.6,24021:-45.2,24024:-45,24026:-44.7,24295:-43.3,24808:-43,25321:-42.7,25834:-42.5,26348:-42.1,26861:-42,27374:-41.6,27887:-41.3,28400:-41,28914:-40.8,29427:-40.4,29940:-40.1,30453:-39.9,31223:-39.6,31736:-39.3,32249:-39.1,32762:-38.7,33275:-38.4,34045:-38.2,34558:-37.9,35071:-37.6,35583:-37.4,36351:-37,37119:-36.9,37887:-36.4,38399:-36.2,39167:-35.9,39935:-35.5,40703:-35.3,41471:-35,42239:-34.8,43007:-34.5,43519:-34.1,44287:-33.8,45055:-33.6,45567:-33.3,46335:-33.1,47103:-32.8,47871:-32.4,48639:-32.1,49407:-31.8,50175:-31.6,206407:-62.2,247039:-31.4,263172:-67.5,403011:-62.4,460551:-67.2,599359:-62.6,657931:-67,724238:-66.8,730172:-62.9,837119:-31.2,861241:-63.3,921618:-66.3,987926:-66.2,992053:-63.6,1053977:-65.8,1057073:-63.9,1120028:-65.5,1122350:-64.1,1186080:-65.3,1186596:-65.1,1187111:-64.6,1187627:-64.5,1361407:-30.7,1820415:-30.4,2344959:-30.1,2935039:-29.9,3141936:-15.9,3459583:-29.7,3469887:-16.3,3600169:-15.8,3797841:-16.4,3918591:-29.5,4189732:-15.4,4191330:-16.9,4443391:-29,4584819:-17.1,4648223:-15.2,4913025:-17.5,4967935:-28.9,5237786:-14.7,5306513:-17.6,5426943:-28.4,57e5:-18,5951743:-28.2,5958164:-14.6,6027948:-18.1,6421434:-18.6,6482192:-14.2,6541823:-27.8,6815176:-18.8,6935551:-27.7,7143122:-19,7268363:-13.9,7525631:-27.5,7602142:-19.5,7733218:-19.8,7864294:-20,7988997:-13.7,7995370:-20.2,8050431:-27,8191982:-20.5,8388594:-20.7,8519669:-21.2,8640767:-26.7,8650745:-21.4,8840704:-13.5,8847356:-21.7,8978431:-22,9034495:-26.6,9102851:-13,9108735:-22.2,9304319:-22.4,9500159:-22.7,9624831:-26.1,9627656:-12.9,9630719:-23.2,9761023:-23.4,9957119:-23.8,10087679:-23.9,10149631:-25.8,10152206:-12.5,10217983:-24.1,10414079:-24.4,10480146:-12.3,10608895:-25.6,10610175:-24.8,10740735:-25.1,10871551:-25.5,11004696:-12,11463709:-11.8,11791649:-11.3,12250919:-11,12644397:-10.8,13103410:-10.6,13431351:-10.3,13825085:-10.1,14218563:-9.6,14480968:-9.5,14874446:-9.1,15093760:4.9,15095040:4.7,15096320:4.3,15097856:4,15099136:3.7,15100416:3.5,15101952:3.2,15102976:3,15104512:2.6,15105792:2.3,15107328:2,15108352:1.8,15109888:1.4,15111424:1.1,15112448:.9,15113984:.6,15115264:.3,15116544:.1,15117824:-0.3,15119360:-0.6,15120896:-0.8,15121920:-1.1,15122947:-1.5,15202644:-8.9,15254792:-1.6,15321101:-2,15387666:-2.3,15454232:-2.6,15520540:-2.8,15530586:-8.6,15586849:-3,15718951:-3.3,15785261:-3.8,15792991:-8.3,15851569:-4,15917879:-4.2,16049725:-4.5,16116034:-4.9,16120933:-7.9,16182344:-5,16248654:-5.5,16314706:-5.7,16446552:-6.1,16448875:-7.6,16512863:-6.2,16578917:-6.5,16644970:-6.7,16645744:-7.4,16711280:-7.2}}),define("modules/elementcache.js",[],function(){return function(e,t){function s(){var t;return r===n.length?t=i.createElement(e):(t=n[r],n[r]=null,r++,r===n.length&&(n.length=0,r=0)),t}function o(e){n[n.length]=e}var n=[],r=0,i=document;return{get:s,reclaim:o}}}),define("modules/canvasidentify.js",["modules/colorrampobject.js","modules/elementcache.js","dojo/on"],function(e,t,n){return function(r,i){function b(){o=i.container.clientWidth,u=i.container.clientHeight,l=w(o,u)}function w(e,t){return a+e+"%2C"+t+"&f=image"}function E(t,n,r){var i=r.getImageData(t,n,1,1).data,s=(i[0]<<16)+(i[1]<<8)+i[2];return e[s]}function S(e,t){var n=new Array(e.length/2);for(var r=0,i=e.length;r<i;r+=2)n[r/2]=E(e[r],e[r+1],t);return n}function x(e,t,n){var r=new Array(e.length/2);for(var i=0,s=e.length;i<s;i+=2)r[i/2]={x:t*i/2,y:E(e[i],e[i+1],n)};return r}function T(){if(v!==d){for(var e in y){var t=y[e],n=t.can,r=t.ctx,i=t.img;r.clearRect(0,0,n.width,n.height),g.reclaim(i),m.reclaim(n),delete y[e]}v=d}}function N(e){this.executing&&!e.length&&this.cb(null),this.prepping=1,T();for(var t=0,n=e.length;t<n;t++){var r=e[t];this.prepared[r]=1;var i=k(r,M,this);i&&O(r,i,this)}}function C(e,t,n){this.points=t.points,this.ftGap=t.ftGap,this.cb=n,this.executing=1,T();var r=this.prepared,i=this;for(var s=0,o=e.length;s<o;s++){var u=e[s];if(r[u])continue;k(u,_,this)}for(var a in r)r[a]!==1&&(this.results[a]=x(this.points,this.ftGap,r[a]),A(this));this.prepping&&!Object.keys(r).length&&n(null)}function k(e,t,n){n.layerCount++;var r=y[e]?y[e].ctx:null;return r?r:(D(e,t,n),!1)}function L(e){return f+e+d+l}function A(e){e.layerCount--,e.layerCount===0&&(e.called=1,e.cb(e.results))}function O(e,t,n){n.executing?(n.results[e]=x(n.points,n.ftGap,t),A(n)):n.prepared[e]=t}function M(e,t,n){return function(){t.drawImage(n,0,0),O(e,t,this)}}function _(e,t,n){return function(){t.drawImage(n,0,0),this.results[e]=x(this.points,this.ftGap,t),A(this)}}function D(e,t,n){var r=m.get(),i=g.get(),s=r.getContext("2d"),a=t(e,s,i);y[e]={ctx:s,can:r,img:i},r.width=o,r.height=u,i.onload=a.bind(n),i.src=L(e)}function P(){thisCtx=null;for(var e=0,t=canvases.length;e<t;e++){var n=canvases[e],r=images[e];n.getContext("2d").clearRect(0,0,n.width,n.height),m.reclaim(canvases[e]),images[e].pnt=null,g.reclaim(images[e])}canvases.length=0,images.length=0}function H(){this.points=null,this.prepping=0,this.executing=0,this.layerCount=0,this.prepared={},this.called=0,this.results={}}var s=r.getImageUrl,o=i.width,u=i.height,a="&bboxSR=102100&imageSR=102100&size=",f=r.url+"/export?dpi=96&transparent=true&format=png8&layers=show%3A",l=w(o,u),c=i.extent,h,p=[],d="&bbox="+c.xmin+"%2C"+c.ymin+"%2C"+c.xmax+"%2C"+c.ymax,v="last",m=t("canvas"),g=t("img"),y={};return r.getImageUrl=function(){var e=Array.prototype.slice.call(arguments,0,3),t=arguments[3],n=function(){var e=arguments[0].split("&");p=e[3].slice(19).split("%2C"),d="&"+e[4],t.apply(this,arguments)};e.push(n),s.apply(this,e)},n(window,"resize",b),H.prototype.prepare=N,H.prototype.execute=C,{task:H}}}),define("dojo/errors/create",["../_base/lang"],function(e){return function(t,n,r,i){r=r||Error;var s=function(e){if(r===Error){Error.captureStackTrace&&Error.captureStackTrace(this,s);var t=Error.call(this,e),i;for(i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);this.message=e,this.stack=t.stack}else r.apply(this,arguments);n&&n.apply(this,arguments)};return s.prototype=e.delegate(r.prototype,i),s.prototype.name=t,s.prototype.constructor=s}}),define("dojo/errors/CancelError",["./create"],function(e){return e("CancelError",null,null,{dojoType:"cancel"})}),define("dojo/promise/Promise",["../_base/lang"],function(e){function t(){throw new TypeError("abstract")}return e.extend(function(){},{then:function(e,n,r){t()},cancel:function(e,n){t()},isResolved:function(){t()},isRejected:function(){t()},isFulfilled:function(){t()},isCanceled:function(){t()},always:function(e){return this.then(e,e)},otherwise:function(e){return this.then(null,e)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})}),define("dojo/Evented",["./aspect","./on"],function(e,t){function n(){}var r=e.after;return n.prototype={on:function(e,n){return t.parse(this,e,n,function(e,t){return r(e,"on"+t,n,!0)})},emit:function(e,n){var r=[this];return r.push.apply(r,arguments),t.emit.apply(t,r)}},n}),define("dojo/promise/tracer",["../_base/lang","./Promise","../Evented"],function(e,t,n){function r(e){setTimeout(function(){s.apply(i,e)},0)}var i=new n,s=i.emit;return i.emit=null,t.prototype.trace=function(){var t=e._toArray(arguments);return this.then(function(e){r(["resolved",e].concat(t))},function(e){r(["rejected",e].concat(t))},function(e){r(["progress",e].concat(t))}),this},t.prototype.traceRejected=function(){var t=e._toArray(arguments);return this.otherwise(function(e){r(["rejected",e].concat(t))}),this},i}),define("dojo/promise/instrumentation",["./tracer","../has","../_base/lang","../_base/array"],function(e,t,n,r){function i(e,t,n){var r="";e&&e.stack&&(r+=e.stack),t&&t.stack&&(r+="\n    ----------------------------------------\n    rejected"+t.stack.split("\n").slice(1).join("\n").replace(/^\s+/," ")),n&&n.stack&&(r+="\n    ----------------------------------------\n"+n.stack),console.error(e,r)}function s(e,t,n,r){t||i(e,n,r)}function o(e,t,n,i){t?r.some(a,function(t,n){if(t.error===e)return a.splice(n,1),!0}):r.some(a,function(t){return t.error===e})||a.push({error:e,rejection:n,deferred:i,timestamp:(new Date).getTime()}),f||(f=setTimeout(u,l))}function u(){var e=(new Date).getTime(),t=e-l;a=r.filter(a,function(e){return e.timestamp<t?(i(e.error,e.rejection,e.deferred),!1):!0}),f=a.length?setTimeout(u,a[0].timestamp+l-e):!1}var a=[],f=!1,l=1e3;return function(r){var i=t("config-useDeferredInstrumentation");if(i){e.on("resolved",n.hitch(console,"log","resolved")),e.on("rejected",n.hitch(console,"log","rejected")),e.on("progress",n.hitch(console,"log","progress"));var u=[];"string"==typeof i&&(u=i.split(","),i=u.shift());if("report-rejections"===i)r.instrumentRejected=s;else{if("report-unhandled-rejections"!==i&&!0!==i&&1!==i)throw Error("Unsupported instrumentation usage <"+i+">");r.instrumentRejected=o,l=parseInt(u[0],10)||l}}}}),define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","./promise/instrumentation"],function(e,t,n,r,i){var s=Object.freeze||function(){},o=function(e,t,n,r,i){2===t&&l.instrumentRejected&&0===e.length&&l.instrumentRejected(n,!1,r,i);for(i=0;i<e.length;i++)u(e[i],t,n,r)},u=function(e,t,n,r){var i=e[t],s=e.deferred;if(i)try{var o=i(n);if(0===t)"undefined"!=typeof o&&f(s,t,o);else{if(o&&"function"==typeof o.then){e.cancel=o.cancel,o.then(a(s,1),a(s,2),a(s,0));return}f(s,1,o)}}catch(u){f(s,2,u)}else f(s,t,n);2===t&&l.instrumentRejected&&l.instrumentRejected(n,!!i,r,s.promise)},a=function(e,t){return function(n){f(e,t,n)}},f=function(e,t,n){if(!e.isCanceled())switch(t){case 0:e.progress(n);break;case 1:e.resolve(n);break;case 2:e.reject(n)}},l=function(e){var t=this.promise=new r,i=this,a,f,c,p=!1,d=[];Error.captureStackTrace&&(Error.captureStackTrace(i,l),Error.captureStackTrace(t,l)),this.isResolved=t.isResolved=function(){return 1===a},this.isRejected=t.isRejected=function(){return 2===a},this.isFulfilled=t.isFulfilled=function(){return!!a},this.isCanceled=t.isCanceled=function(){return p},this.progress=function(e,n){if(a){if(!0===n)throw Error("This deferred has already been fulfilled.");return t}return o(d,0,e,null,i),t},this.resolve=function(e,n){if(a){if(!0===n)throw Error("This deferred has already been fulfilled.");return t}return o(d,a=1,f=e,null,i),d=null,t};var v=this.reject=function(e,n){if(a){if(!0===n)throw Error("This deferred has already been fulfilled.");return t}return Error.captureStackTrace&&Error.captureStackTrace(c={},v),o(d,a=2,f=e,c,i),d=null,t};this.then=t.then=function(e,n,r){var i=[r,e,n];return i.cancel=t.cancel,i.deferred=new l(function(e){return i.cancel&&i.cancel(e)}),a&&!d?u(i,a,f,c):d.push(i),i.deferred.promise},this.cancel=t.cancel=function(t,r){if(a){if(!0===r)throw Error("This deferred has already been fulfilled.")}else{if(e){var i=e(t);t="undefined"==typeof i?t:i}p=!0;if(!a)return"undefined"==typeof t&&(t=new n),v(t),t;if(2===a&&f===t)return t}},s(t)};return l.prototype.toString=function(){return"[object Deferred]"},i&&i(l),l}),define("dojox/charting/Chart","../main dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/dom-style dojo/dom dojo/dom-geometry dojo/dom-construct dojo/_base/Color dojo/sniff ./Element ./SimpleTheme ./Series ./axis2d/common dojox/gfx/shape dojox/gfx dojo/has!dojo-bidi?./bidi/Chart dojox/lang/functional dojox/lang/functional/fold dojox/lang/functional/reversed".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function y(e,t){return e&&t&&(e.min=Math.min(e.min,t.min),e.max=Math.max(e.max,t.max)),e||t}function b(e,t){var r={},i={};n.forEach(e,function(e){var t=r[e.name]=e.getSeriesStats();e.hAxis&&(i[e.hAxis]=y(i[e.hAxis],{min:t.hmin,max:t.hmax})),e.vAxis&&(i[e.vAxis]=y(i[e.vAxis],{min:t.vmin,max:t.vmax}))}),n.forEach(e,function(e){var n=r[e.name];if(e.hAxis){var s=i[e.hAxis];n.hmin=s.min,n.hmax=s.max}e.vAxis&&(s=i[e.vAxis],n.vmin=s.min,n.vmax=s.max),e.initializeScalers(t,n)})}var w=t.getObject("charting",!0,e),E=g.lambda("item.clear()"),S=g.lambda("item.purgeGroup()"),x=g.lambda("item.destroy()"),T=g.lambda("item.dirty = false"),N=g.lambda("item.dirty = true"),C=g.lambda("item.name");return e=r(f("dojo-bidi")?"dojox.charting.NonBidiChart":"dojox.charting.Chart",null,{constructor:function(e,t){t||(t={}),this.margins=t.margins?t.margins:{l:10,t:10,r:10,b:10},this.stroke=t.stroke,this.fill=t.fill,this.delayInMs=t.delayInMs||200,this.title=t.title,this.titleGap=t.titleGap,this.titlePos=t.titlePos,this.titleFont=t.titleFont,this.titleFontColor=t.titleFontColor,this.chartTitle=null,this.htmlLabels=!0,"htmlLabels"in t&&(this.htmlLabels=t.htmlLabels),this.theme=null,this.axes={},this.stack=[],this.plots={},this.series=[],this.runs={},this.dirty=!0,this.node=s.byId(e);var n=o.getMarginBox(e);this.surface=v.createSurface(this.node,n.w||400,n.h||300),-1==this.surface.declaredClass.indexOf("vml")&&(this._nativeClip=!0)},destroy:function(){n.forEach(this.series,x),n.forEach(this.stack,x),g.forIn(this.axes,x),this.surface.destroy(),this.chartTitle&&this.chartTitle.tagName&&u.destroy(this.chartTitle)},getCoords:function(){var e=this.node,t=i.getComputedStyle(e),t=o.getMarginBox(e,t),e=o.position(e,!0);return t.x=e.x,t.y=e.y,t},setTheme:function(e){return this.theme=e.clone(),this.dirty=!0,this},addAxis:function(e,t){var n;n=t&&t.type||"Default";if("string"==typeof n){if(!w.axis2d||!w.axis2d[n])throw Error("Can't find axis: "+n+" - Check require() dependencies.");n=new w.axis2d[n](this,t)}else n=new n(this,t);return n.name=e,n.dirty=!0,e in this.axes&&this.axes[e].destroy(),this.axes[e]=n,this.dirty=!0,this},getAxis:function(e){return this.axes[e]},removeAxis:function(e){return e in this.axes&&(this.axes[e].destroy(),delete this.axes[e],this.dirty=!0),this},addPlot:function(e,t){var n;n=t&&t.type||"Default";if("string"==typeof n){if(!w.plot2d||!w.plot2d[n])throw Error("Can't find plot: "+n+" - didn't you forget to dojo.require() it?");n=new w.plot2d[n](this,t)}else n=new n(this,t);return n.name=e,n.dirty=!0,e in this.plots?(this.stack[this.plots[e]].destroy(),this.stack[this.plots[e]]=n):(this.plots[e]=this.stack.length,this.stack.push(n)),this.dirty=!0,this},getPlot:function(e){return this.stack[this.plots[e]]},removePlot:function(e){if(e in this.plots){var t=this.plots[e];delete this.plots[e],this.stack[t].destroy(),this.stack.splice(t,1),g.forIn(this.plots,function(e,n,r){e>t&&(r[n]=e-1)});var r=n.filter(this.series,function(t){return t.plot!=e});r.length<this.series.length&&(n.forEach(this.series,function(t){t.plot==e&&t.destroy()}),this.runs={},n.forEach(r,function(e,t){this.runs[e.plot]=t},this),this.series=r),this.dirty=!0}return this},getPlotOrder:function(){return g.map(this.stack,C)},setPlotOrder:function(e){var t={},n=g.filter(e,function(e){return!(e in this.plots)||e in t?!1:(t[e]=1,!0)},this);return n.length<this.stack.length&&g.forEach(this.stack,function(e){e=e.name,e in t||n.push(e)}),e=g.map(n,function(e){return this.stack[this.plots[e]]},this),g.forEach(e,function(e,t){this.plots[e.name]=t},this),this.stack=e,this.dirty=!0,this},movePlotToFront:function(e){if(e in this.plots){var t=this.plots[e];if(t){var n=this.getPlotOrder();return n.splice(t,1),n.unshift(e),this.setPlotOrder(n)}}return this},movePlotToBack:function(e){if(e in this.plots){var t=this.plots[e];if(t<this.stack.length-1){var n=this.getPlotOrder();return n.splice(t,1),n.push(e),this.setPlotOrder(n)}}return this},addSeries:function(e,t,n){return t=new h(this,t,n),t.name=e,e in this.runs?(this.series[this.runs[e]].destroy(),this.series[this.runs[e]]=t):(this.runs[e]=this.series.length,this.series.push(t)),this.dirty=!0,!("ymin"in t)&&"min"in t&&(t.ymin=t.min),!("ymax"in t)&&"max"in t&&(t.ymax=t.max),this},getSeries:function(e){return this.series[this.runs[e]]},removeSeries:function(e){if(e in this.runs){var t=this.runs[e];delete this.runs[e],this.series[t].destroy(),this.series.splice(t,1),g.forIn(this.runs,function(e,n,r){e>t&&(r[n]=e-1)}),this.dirty=!0}return this},updateSeries:function(e,t,n){return e in this.runs&&(e=this.series[this.runs[e]],e.update(t),n?this.dirty=!0:(this._invalidateDependentPlots(e.plot,!1),this._invalidateDependentPlots(e.plot,!0))),this},getSeriesOrder:function(e){return g.map(g.filter(this.series,function(t){return t.plot==e}),C)},setSeriesOrder:function(e){var t,n={},r=g.filter(e,function(e){if(!(e in this.runs)||e in n)return!1;var r=this.series[this.runs[e]];if(t){if(r.plot!=t)return!1}else t=r.plot;return n[e]=1,!0},this);return g.forEach(this.series,function(e){var i=e.name;!(i in n)&&e.plot==t&&r.push(i)}),this.series=g.map(r,function(e){return this.series[this.runs[e]]},this).concat(g.filter(this.series,function(e){return e.plot!=t})),g.forEach(this.series,function(e,t){this.runs[e.name]=t},this),this.dirty=!0,this},moveSeriesToFront:function(e){if(e in this.runs){var t=this.runs[e],n=this.getSeriesOrder(this.series[t].plot);if(e!=n[0])return n.splice(t,1),n.unshift(e),this.setSeriesOrder(n)}return this},moveSeriesToBack:function(e){if(e in this.runs){var t=this.runs[e],n=this.getSeriesOrder(this.series[t].plot);if(e!=n[n.length-1])return n.splice(t,1),n.push(e),this.setSeriesOrder(n)}return this},resize:function(e,t){switch(arguments.length){case 1:o.setMarginBox(this.node,e);break;case 2:o.setMarginBox(this.node,{w:e,h:t})}var n=o.getMarginBox(this.node),r=this.surface.getDimensions();return r.width!=n.w||r.height!=n.h?(this.surface.setDimensions(n.w,n.h),this.dirty=!0,this.render()):this},getGeometry:function(){var e={};return g.forIn(this.axes,function(t){t.initialized()&&(e[t.name]={name:t.name,vertical:t.vertical,scaler:t.scaler,ticks:t.ticks})}),e},setAxisWindow:function(e,t,r,i){var s=this.axes[e];return s&&(s.setWindow(t,r),n.forEach(this.stack,function(t){if(t.hAxis==e||t.vAxis==e)t.zoom=i})),this},setWindow:function(e,t,r,i,s){return"plotArea"in this||this.calculateGeometry(),g.forIn(this.axes,function(n){var s,o;s=n.getScaler().bounds,o=s.span/(s.upper-s.lower),n.vertical?(s=t,o=i/o/s):(s=e,o=r/o/s),n.setWindow(s,o)}),n.forEach(this.stack,function(e){e.zoom=s}),this},zoomIn:function(e,t,n){var r=this.axes[e];if(r){var r=r.getScaler().bounds,i=Math.min(t[0],t[1]),s=Math.max(t[0],t[1]),i=t[0]<r.lower?r.lower:i,s=t[1]>r.upper?r.upper:s;this.setAxisWindow(e,(r.upper-r.lower)/(s-i),i-r.lower),n?this.delayedRender():this.render()}},calculateGeometry:function(){if(this.dirty)return this.fullGeometry();var e=n.filter(this.stack,function(e){return e.dirty||e.hAxis&&this.axes[e.hAxis].dirty||e.vAxis&&this.axes[e.vAxis].dirty},this);return b(e,this.plotArea),this},fullGeometry:function(){this._makeDirty(),n.forEach(this.stack,E),this.theme||this.setTheme(new c),n.forEach(this.series,function(e){if(!(e.plot in this.plots)){if(!w.plot2d||!w.plot2d.Default)throw Error("Can't find plot: Default - didn't you forget to dojo.require() it?");var t=new w.plot2d.Default(this,{});t.name=e.plot,this.plots[e.plot]=this.stack.length,this.stack.push(t)}this.stack[this.plots[e.plot]].addSeries(e)},this),n.forEach(this.stack,function(e){e.assignAxes&&e.assignAxes(this.axes)},this);var e=this.dim=this.surface.getDimensions();e.width=v.normalizedLength(e.width),e.height=v.normalizedLength(e.height),g.forIn(this.axes,E),b(this.stack,e);var t=this.offsets={l:0,r:0,t:0,b:0},r=this;g.forIn(this.axes,function(e){f("dojo-bidi")&&r._resetLeftBottom(e),g.forIn(e.getOffsets(),function(e,n){t[n]=Math.max(e,t[n])})});if(this.title){this.titleGap=0==this.titleGap?0:this.titleGap||this.theme.chart.titleGap||20,this.titlePos=this.titlePos||this.theme.chart.titlePos||"top",this.titleFont=this.titleFont||this.theme.chart.titleFont,this.titleFontColor=this.titleFontColor||this.theme.chart.titleFontColor||"black";var i=v.normalizedLength(v.splitFontString(this.titleFont).size);t["top"==this.titlePos?"t":"b"]+=i+this.titleGap}return g.forIn(this.margins,function(e,n){t[n]+=e}),this.plotArea={width:e.width-t.l-t.r,height:e.height-t.t-t.b},g.forIn(this.axes,E),b(this.stack,this.plotArea),this},render:function(){return this._delayedRenderHandle&&(clearTimeout(this._delayedRenderHandle),this._delayedRenderHandle=null),this.theme&&this.theme.clear(),this.dirty?this.fullRender():(this.calculateGeometry(),g.forEachRev(this.stack,function(e){e.render(this.dim,this.offsets)},this),g.forIn(this.axes,function(e){e.render(this.dim,this.offsets)},this),this._makeClean(),this)},fullRender:function(){this.fullGeometry();var e=this.offsets,t=this.dim,r=Math.max(0,t.width-e.l-e.r),i=Math.max(0,t.height-e.t-e.b);n.forEach(this.series,S),g.forIn(this.axes,S),n.forEach(this.stack,S);var s=this.surface.children;if(d.dispose)for(var o=0;o<s.length;++o)d.dispose(s[o]);return this.chartTitle&&this.chartTitle.tagName&&u.destroy(this.chartTitle),this.surface.clear(),this.chartTitle=null,this._renderChartBackground(t,e),this._renderPlotBackground(t,e,r,i),g.foldr(this.stack,function(n,r){return r.render(t,e),0},0),this._nativeClip||this._renderChartBackground(t,e),this.title&&(r="canvas"==v.renderer&&this.htmlLabels||!f("ie")&&!f("opera")&&this.htmlLabels?"html":"gfx",i=v.normalizedLength(v.splitFontString(this.titleFont).size),this.chartTitle=p.createText[r](this,this.surface,t.width/2,"top"==this.titlePos?i+this.margins.t:t.height-this.margins.b,"middle",this.title,this.titleFont,this.titleFontColor)),g.forIn(this.axes,function(n){n.render(t,e)}),this._makeClean(),this},_renderChartBackground:function(e,t){var n=this.theme,r,s=void 0!==this.fill?this.fill:n.chart&&n.chart.fill,n=void 0!==this.stroke?this.stroke:n.chart&&n.chart.stroke;if("inherit"==s){r=this.node;for(s=new a(i.get(r,"backgroundColor"));0==s.a&&r!=document.documentElement;)s=new a(i.get(r,"backgroundColor")),r=r.parentNode}s&&(this._nativeClip?(s=l.prototype._shapeFill(l.prototype._plotFill(s,e),{x:0,y:0,width:e.width+1,height:e.height+1}),this.surface.createRect({width:e.width+1,height:e.height+1}).setFill(s)):(s=l.prototype._plotFill(s,e,t),t.l&&(r={x:0,y:0,width:t.l,height:e.height+1},this.surface.createRect(r).setFill(l.prototype._shapeFill(s,r))),t.r&&(r={x:e.width-t.r,y:0,width:t.r+1,height:e.height+2},this.surface.createRect(r).setFill(l.prototype._shapeFill(s,r))),t.t&&(r={x:0,y:0,width:e.width+1,height:t.t},this.surface.createRect(r).setFill(l.prototype._shapeFill(s,r))),t.b&&(r={x:0,y:e.height-t.b,width:e.width+1,height:t.b+2},this.surface.createRect(r).setFill(l.prototype._shapeFill(s,r))))),n&&this.surface.createRect({width:e.width-1,height:e.height-1}).setStroke(n)},_renderPlotBackground:function(e,t,n,r){var i=this.theme,s=i.plotarea&&i.plotarea.fill,i=i.plotarea&&i.plotarea.stroke,o={x:t.l-1,y:t.t-1,width:n+2,height:r+2};s&&(s=l.prototype._shapeFill(l.prototype._plotFill(s,e,t),o),this.surface.createRect(o).setFill(s)),i&&this.surface.createRect({x:t.l,y:t.t,width:n+1,height:r+1}).setStroke(i)},delayedRender:function(){return this._delayedRenderHandle||(this._delayedRenderHandle=setTimeout(t.hitch(this,function(){this.render()}),this.delayInMs)),this},connectToPlot:function(e,t,n){return e in this.plots?this.stack[this.plots[e]].connect(t,n):null},fireEvent:function(e,t,n){if(e in this.runs){var r=this.series[this.runs[e]].plot;r in this.plots&&(r=this.stack[this.plots[r]])&&r.fireEvent(e,t,n)}return this},_makeClean:function(){n.forEach(this.axes,T),n.forEach(this.stack,T),n.forEach(this.series,T),this.dirty=!1},_makeDirty:function(){n.forEach(this.axes,N),n.forEach(this.stack,N),n.forEach(this.series,N),this.dirty=!0},_invalidateDependentPlots:function(e,t){if(e in this.plots){var r=this.stack[this.plots[e]],i,s=t?"vAxis":"hAxis";r[s]?(i=this.axes[r[s]])&&i.dependOnData()&&(i.dirty=!0,n.forEach(this.stack,function(e){e[s]&&e[s]==r[s]&&(e.dirty=!0)})):r.dirty=!0}},setDir:function(e){return this},_resetLeftBottom:function(e){},formatTruncatedLabel:function(e,t,n){}}),f("dojo-bidi")?r("dojox.charting.Chart",[e,m]):e}),define("dojox/charting/SimpleTheme","dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/Color dojox/lang/utils dojox/gfx/gradutils".split(" "),function(e,t,n,r,i,s){var o=n("dojox.charting.SimpleTheme",null,{shapeSpaces:{shape:1,shapeX:1,shapeY:1},constructor:function(n){n=n||{};var r=o.defaultTheme;t.forEach("chart plotarea axis grid series marker indicator".split(" "),function(t){this[t]=e.delegate(r[t],n[t])},this),n.seriesThemes&&n.seriesThemes.length?(this.colors=null,this.seriesThemes=n.seriesThemes.slice(0)):(this.seriesThemes=null,this.colors=(n.colors||o.defaultColors).slice(0)),this.markerThemes=null,n.markerThemes&&n.markerThemes.length&&(this.markerThemes=n.markerThemes.slice(0)),this.markers=n.markers?e.clone(n.markers):e.delegate(o.defaultMarkers),this.noGradConv=n.noGradConv,this.noRadialConv=n.noRadialConv,n.reverseFills&&this.reverseFills(),this._current=0,this._buildMarkerArray()},clone:function(){var e=new this.constructor({chart:this.chart,plotarea:this.plotarea,axis:this.axis,grid:this.grid,series:this.series,marker:this.marker,colors:this.colors,markers:this.markers,indicator:this.indicator,seriesThemes:this.seriesThemes,markerThemes:this.markerThemes,noGradConv:this.noGradConv,noRadialConv:this.noRadialConv});return t.forEach("clone clear next skip addMixin post getTick".split(" "),function(t){this.hasOwnProperty(t)&&(e[t]=this[t])},this),e},clear:function(){this._current=0},next:function(t,n,s){var o=i.merge,u;if(this.colors){u=e.delegate(this.series);var o=e.delegate(this.marker),a=new r(this.colors[this._current%this.colors.length]),l;u.stroke&&u.stroke.color?(u.stroke=e.delegate(u.stroke),l=new r(u.stroke.color),u.stroke.color=new r(a),u.stroke.color.a=l.a):u.stroke={color:a},o.stroke&&o.stroke.color?(o.stroke=e.delegate(o.stroke),l=new r(o.stroke.color),o.stroke.color=new r(a),o.stroke.color.a=l.a):o.stroke={color:a},!u.fill||u.fill.type?u.fill=a:(l=new r(u.fill),u.fill=new r(a),u.fill.a=l.a),!o.fill||o.fill.type?o.fill=a:(l=new r(o.fill),o.fill=new r(a),o.fill.a=l.a)}else u=this.seriesThemes?o(this.series,this.seriesThemes[this._current%this.seriesThemes.length]):this.series,o=this.markerThemes?o(this.marker,this.markerThemes[this._current%this.markerThemes.length]):u;return u={series:u,marker:o,symbol:o&&o.symbol||this._markers[this._current%this._markers.length]},++this._current,n&&(u=this.addMixin(u,t,n)),s&&(u=this.post(u,t)),u},skip:function(){++this._current},addMixin:function(n,r,s,o){if(e.isArray(s))t.forEach(s,function(e){n=this.addMixin(n,r,e)},this);else{var u={};"color"in s&&("line"==r||"area"==r?(e.setObject("series.stroke.color",s.color,u),e.setObject("marker.stroke.color",s.color,u)):e.setObject("series.fill",s.color,u)),t.forEach("stroke outline shadow fill filter font fontColor labelWiring".split(" "),function(t){var n="marker"+t.charAt(0).toUpperCase()+t.substr(1),r=n in s;t in s&&(e.setObject("series."+t,s[t],u),r||e.setObject("marker."+t,s[t],u)),r&&e.setObject("marker."+t,s[n],u)}),"marker"in s&&(u.symbol=s.marker,u.symbol=s.marker),n=i.merge(n,u)}return o&&(n=this.post(n,r)),n},post:function(e,t){var n=e.series.fill,r;if(!this.noGradConv&&this.shapeSpaces[n.space]&&"linear"==n.type){"bar"==t?r={x1:n.y1,y1:n.x1,x2:n.y2,y2:n.x2}:!this.noRadialConv&&"shape"==n.space&&("slice"==t||"circle"==t)&&(r={type:"radial",cx:0,cy:0,r:100});if(r)return i.merge(e,{series:{fill:r}})}return e},getTick:function(e,t){var n=this.axis.tick,r=e+"Tick",s=i.merge;return n?this.axis[r]&&(n=s(n,this.axis[r])):n=this.axis[r],t&&(n?t[r]&&(n=s(n,t[r])):n=t[r]),n},inspectObjects:function(e){t.forEach("chart plotarea axis grid series marker indicator".split(" "),function(t){e(this[t])},this),this.seriesThemes&&t.forEach(this.seriesThemes,e),this.markerThemes&&t.forEach(this.markerThemes,e)},reverseFills:function(){this.inspectObjects(function(e){e&&e.fill&&(e.fill=s.reverse(e.fill))})},addMarker:function(e,t){this.markers[e]=t,this._buildMarkerArray()},setMarkers:function(e){this.markers=e,this._buildMarkerArray()},_buildMarkerArray:function(){this._markers=[];for(var e in this.markers)this._markers.push(this.markers[e])}});return e.mixin(o,{defaultMarkers:{CIRCLE:"m-3,0 c0,-4 6,-4 6,0 m-6,0 c0,4 6,4 6,0",SQUARE:"m-3,-3 l0,6 6,0 0,-6 z",DIAMOND:"m0,-3 l3,3 -3,3 -3,-3 z",CROSS:"m0,-3 l0,6 m-3,-3 l6,0",X:"m-3,-3 l6,6 m0,-6 l-6,6",TRIANGLE:"m-3,3 l3,-6 3,6 z",TRIANGLE_INVERTED:"m-3,-3 l3,6 3,-6 z"},defaultColors:["#54544c","#858e94","#6e767a","#948585","#474747"],defaultTheme:{chart:{stroke:null,fill:"white",pageStyle:null,titleGap:20,titlePos:"top",titleFont:"normal normal bold 14pt Tahoma",titleFontColor:"#333"},plotarea:{stroke:null,fill:"white"},axis:{stroke:{color:"#333",width:1},tick:{color:"#666",position:"center",font:"normal normal normal 7pt Tahoma",fontColor:"#333",labelGap:4},majorTick:{width:1,length:6},minorTick:{width:.8,length:3},microTick:{width:.5,length:1},title:{gap:15,font:"normal normal normal 11pt Tahoma",fontColor:"#333",orientation:"axis"}},series:{stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",font:"normal normal normal 8pt Tahoma",fontColor:"#000",labelWiring:{width:1,color:"#ccc"}},marker:{stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",font:"normal normal normal 8pt Tahoma",fontColor:"#000"},indicator:{lineStroke:{width:1.5,color:"#333"},lineOutline:{width:.1,color:"#ccc"},lineShadow:null,lineFill:null,stroke:{width:1.5,color:"#333"},outline:{width:.1,color:"#ccc"},shadow:null,fill:"#ccc",radius:3,font:"normal normal normal 10pt Tahoma",fontColor:"#000",markerFill:"#ccc",markerSymbol:"m-3,0 c0,-4 6,-4 6,0 m-6,0 c0,4 6,4 6,0",markerStroke:{width:1.5,color:"#333"},markerOutline:{width:.1,color:"#ccc"},markerShadow:null}}}),o}),define("dojox/charting/themes/common",["dojo/_base/lang"],function(e){return e.getObject("dojox.charting.themes",!0)}),define("dojox/charting/themes/PurpleRain",["../SimpleTheme","./common"],function(e,t){return t.PurpleRain=new e({colors:["#4879bc","#ef446f","#3f58a7","#8254a2","#4956a6"]}),t.PurpleRain}),define("dojox/charting/axis2d/Default","dojo/_base/lang dojo/_base/array dojo/sniff dojo/_base/declare dojo/_base/connect dojo/dom-geometry ./Invisible ../scaler/linear ./common dojox/gfx dojox/lang/utils dojox/lang/functional dojo/has!dojo-bidi?../bidi/axis2d/Default".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h){return o=r(n("dojo-bidi")?"dojox.charting.axis2d.NonBidiDefault":"dojox.charting.axis2d.Default",o,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,rotation:0,htmlLabels:!0,enableCache:!1,dropLabels:!0,labelSizeChange:!1},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],labelFunc:null,maxLabelSize:0,maxLabelCharCount:0,trailingSymbol:null,stroke:{},majorTick:{},minorTick:{},microTick:{},tick:{},font:"",fontColor:"",title:"",titleGap:0,titleFont:"",titleFontColor:"",titleOrientation:""},constructor:function(t,n){this.opt=e.clone(this.defaultParams),l.updateWithObject(this.opt,n),l.updateWithPattern(this.opt,n,this.optionalParams),this.opt.enableCache&&(this._textFreePool=[],this._lineFreePool=[],this._textUsePool=[],this._lineUsePool=[]),this._invalidMaxLabelSize=!0},setWindow:function(e,t){return e!=this.scale&&(this._invalidMaxLabelSize=!0),this.inherited(arguments)},_groupLabelWidth:function(t,n,r){return t.length?(50<t.length&&(t.length=50),e.isObject(t[0])&&(t=c.map(t,function(e){return e.text})),r&&(t=c.map(t,function(t){return 0==e.trim(t).length?"":t.substring(0,r)+this.trailingSymbol},this)),t=t.join("<br>"),f._base._getTextBox(t,{font:n}).w||0):0},_getMaxLabelSize:function(n,r,i,s,o,a){if(null==this._maxLabelSize&&6==arguments.length){var f=this.opt;this.scaler.minMinorStep=this._prevMinMinorStep=0;var l=e.clone(f);delete l.to,delete l.from;var c=u.buildScaler(n,r,i,l,f.to-f.from);c.minMinorStep=0,this._majorStart=c.major.start,f=u.buildTicks(c,f);if(a&&f){var h=c=0,p=function(e){e.label&&this.push(e.label)},d=[];this.opt.majorLabels&&(t.forEach(f.major,p,d),c=this._groupLabelWidth(d,o,l.maxLabelCharCount),l.maxLabelSize&&(c=Math.min(l.maxLabelSize,c))),d=[],this.opt.dropLabels&&this.opt.minorLabels&&(t.forEach(f.minor,p,d),h=this._groupLabelWidth(d,o,l.maxLabelCharCount),l.maxLabelSize&&(h=Math.min(l.maxLabelSize,h))),this._maxLabelSize={majLabelW:c,minLabelW:h,majLabelH:a,minLabelH:a}}else this._maxLabelSize=null}return this._maxLabelSize},calculate:function(e,t,n){this.inherited(arguments),this.scaler.minMinorStep=this._prevMinMinorStep;if((this._invalidMaxLabelSize||n!=this._oldSpan)&&Infinity!=e&&-Infinity!=t){this._invalidMaxLabelSize=!1,this.opt.labelSizeChange&&(this._maxLabelSize=null),this._oldSpan=n;var r=this.opt,i=this.chart.theme.axis,s=r.rotation%360,o=this.chart.theme.axis.tick.labelGap,a=r.font||i.majorTick&&i.majorTick.font||i.tick&&i.tick.font,i=a?f.normalizedLength(f.splitFontString(a).size):0,a=this._getMaxLabelSize(e,t,n,s,a,i);"number"!=typeof o&&(o=4);if(a&&r.dropLabels){var r=Math.abs(Math.cos(s*Math.PI/180)),l=Math.abs(Math.sin(s*Math.PI/180));0>s&&(s+=360);switch(s){case 0:case 180:this.vertical?s=i:(s=a.majLabelW,i=a.minLabelW);break;case 90:case 270:this.vertical?(s=a.majLabelW,i=a.minLabelW):s=i;break;default:var s=this.vertical?Math.min(a.majLabelW,i/r):Math.min(a.majLabelW,i/l),c=Math.sqrt(a.minLabelW*a.minLabelW+i*i),i=Math.min(c,this.vertical?i*r+a.minLabelW*l:a.minLabelW*r+i*l)}this.scaler.minMinorStep=this._prevMinMinorStep=Math.max(s,i)+o,this._skipInterval=this.scaler.minMinorStep<=this.scaler.minor.tick*this.scaler.bounds.scale?0:Math.floor((s+o)/(this.scaler.major.tick*this.scaler.bounds.scale))}else this._skipInterval=0}return this.ticks=u.buildTicks(this.scaler,this.opt),this},getOffsets:function(){var e={l:0,r:0,t:0,b:0};if(!this.scaler)return e;var t=this.opt,n=this.chart.theme.axis,r=this.chart.theme.axis.tick.labelGap,i=t.titleFont||n.title&&n.title.font,n=0==t.titleGap?0:t.titleGap||n.title&&n.title.gap,s=this.chart.theme.getTick("major",t),o=this.chart.theme.getTick("minor",t),i=i?f.normalizedLength(f.splitFontString(i).size):0,u=t.rotation%360,a=t.leftBottom,l=Math.abs(Math.cos(u*Math.PI/180)),c=Math.abs(Math.sin(u*Math.PI/180));this.trailingSymbol=void 0===t.trailingSymbol||null===t.trailingSymbol?this.trailingSymbol:t.trailingSymbol,"number"!=typeof r&&(r=4),0>u&&(u+=360);var h=this._getMaxLabelSize();if(h){var p=Math.ceil(Math.max(h.majLabelW,h.minLabelW))+1,d=Math.ceil(Math.max(h.majLabelH,h.minLabelH))+1;if(this.vertical)switch(h=a?"l":"r",u){case 0:case 180:e[h]=p,e.t=e.b=d/2;break;case 90:case 270:e[h]=d,e.t=e.b=p/2;break;default:45>=u||180<u&&225>=u?(e[h]=d*c/2+p*l,e[a?"t":"b"]=d*l/2+p*c,e[a?"b":"t"]=d*l/2):315<u||180>u&&135<u?(e[h]=d*c/2+p*l,e[a?"b":"t"]=d*l/2+p*c,e[a?"t":"b"]=d*l/2):90>u||180<u&&270>u?(e[h]=d*c+p*l,e[a?"t":"b"]=d*l+p*c):(e[h]=d*c+p*l,e[a?"b":"t"]=d*l+p*c)}else switch(h=a?"b":"t",u){case 0:case 180:e[h]=d,e.l=e.r=p/2;break;case 90:case 270:e[h]=p,e.l=e.r=d/2;break;default:45<=u&&90>=u||225<=u&&270>=u?(e[h]=d*l/2+p*c,e[a?"r":"l"]=d*c/2+p*l,e[a?"l":"r"]=d*c/2):90<=u&&135>=u||270<=u&&315>=u?(e[h]=d*l/2+p*c,e[a?"l":"r"]=d*c/2+p*l,e[a?"r":"l"]=d*c/2):45>u||180<u&&225>u?(e[h]=d*l+p*c,e[a?"r":"l"]=d*c+p*l):(e[h]=d*l+p*c,e[a?"l":"r"]=d*c+p*l)}e[h]+=r+Math.max(0<s.length?s.length:0,0<o.length?o.length:0)+(t.title?i+n:0)}return e},cleanGroup:function(e){this.opt.enableCache&&this.group&&(this._lineFreePool=this._lineFreePool.concat(this._lineUsePool),this._lineUsePool=[],this._textFreePool=this._textFreePool.concat(this._textUsePool),this._textUsePool=[]),this.inherited(arguments)},createText:function(e,t,n,r,i,s,o,u,f){return!this.opt.enableCache||"html"==e?a.createText[e](this.chart,t,n,r,i,s,o,u,f):(0<this._textFreePool.length?(e=this._textFreePool.pop(),e.setShape({x:n,y:r,text:s,align:i}),t.add(e)):e=a.createText[e](this.chart,t,n,r,i,s,o,u),this._textUsePool.push(e),e)},createLine:function(e,t){var n;return this.opt.enableCache&&0<this._lineFreePool.length?(n=this._lineFreePool.pop(),n.setShape(t),e.add(n)):n=e.createLine(t),this.opt.enableCache&&this._lineUsePool.push(n),n},render:function(e,r){var i,s,o,l,c,h,p,d,v,m,g,y,b,E,S=this._isRtl();if(!this.dirty||!this.scaler)return this;var x=this.opt;v=this.chart.theme.axis;var C=x.leftBottom,k=x.rotation%360,L=0,A,O,L=this.chart.theme.axis.tick.labelGap,M=x.font||v.majorTick&&v.majorTick.font||v.tick&&v.tick.font,_=x.titleFont||v.title&&v.title.font,D=x.fontColor||v.majorTick&&v.majorTick.fontColor||v.tick&&v.tick.fontColor||"black",P=x.titleFontColor||v.title&&v.title.fontColor||"black";c=0==x.titleGap?0:x.titleGap||v.title&&v.title.gap||15;var H=x.titleOrientation||v.title&&v.title.orientation||"axis",B=this.chart.theme.getTick("major",x),j=this.chart.theme.getTick("minor",x),F=this.chart.theme.getTick("micro",x),I="stroke"in x?x.stroke:v.stroke,q=M?f.normalizedLength(f.splitFontString(M).size):0;h=Math.abs(Math.cos(k*Math.PI/180)),A=Math.abs(Math.sin(k*Math.PI/180));var R=_?f.normalizedLength(f.splitFontString(_).size):0;"number"!=typeof L&&(L=4),0>k&&(k+=360);var U=this._getMaxLabelSize(),U=U&&U.majLabelW;if(this.vertical){b=e.height-r.b,E=void 0,g=r.t,y=void 0,v=(e.height-r.b+r.t)/2,m=void 0,A=q*A+(U||0)*h+L+Math.max(0<B.length?B.length:0,0<j.length?j.length:0)+R+c,p=0,d=-1,s=i=0,c=1,h=0,o=L,l=0;switch(k){case 0:O="end",s=.4*q;break;case 90:O="middle",i=-q;break;case 180:O="start",s=.4*-q;break;case 270:O="middle";break;default:45>k?(O="end",s=.4*q):90>k?(O="end",s=.4*q):135>k?O="start":225>k?(O="start",s=.4*-q):270>k?(O="start",i=C?0:.4*q):315>k?(O="end",i=C?0:.4*q):(O="end",s=.4*q)}if(C)E=y=r.l,L=H&&"away"==H?90:270,m=r.l-A+(270==L?R:0),c=-1,o=-o;else switch(E=y=e.width-r.r,L=H&&"axis"==H?90:270,m=e.width-r.r+A-(270==L?0:R),O){case"start":O="end";break;case"end":O="start";break;case"middle":i+=q}}else{E=r.l,b=void 0,y=e.width-r.r,g=void 0,m=(e.width-r.r+r.l)/2,v=void 0,A=q*h+(U||0)*A+L+Math.max(0<B.length?B.length:0,0<j.length?j.length:0)+R+c,p=S?-1:1,c=s=i=d=0,h=1,o=0,l=L;switch(k){case 0:O="middle",s=q;break;case 90:O="start",i=.4*-q;break;case 180:O="middle";break;case 270:O="end",i=.4*q;break;default:45>k?(O="start",s=C?q:0):135>k?(O="start",i=.4*-q):180>k?(O="start",s=C?0:-q):225>k?(O="end",s=C?0:-q):315>k?(O="end",s=C?.4*q:0):(O="end",s=C?q:0)}if(C)b=g=e.height-r.b,L=H&&"axis"==H?180:0,v=e.height-r.b+A-(L?R:0);else switch(b=g=r.t,L=H&&"away"==H?180:0,v=r.t-A+(L?0:R),h=-1,l=-l,O){case"start":O="end";break;case"end":O="start";break;case"middle":s-=q}}this.cleanGroup();var z=this.group,C=this.scaler,H=this.ticks,W=u.getTransformerFromModel(this.scaler),X=(!x.title||!L)&&!k&&this.opt.htmlLabels&&!n("ie")&&!n("opera")?"html":"gfx",$=c*B.length,J=h*B.length,K=this._skipInterval;z.createLine({x1:E,y1:b,x2:y,y2:g}).setStroke(I),x.title&&(_=a.createText[X](this.chart,z,m,v,"middle",x.title,_,P),"html"==X?this.htmlElements.push(_):_.setTransform(f.matrix.rotategAt(L,m,v)));if(null==H)return this.dirty=!1,this;var G=0<H.major.length?(H.major[0].value-this._majorStart)/C.major.tick:0,Y=this.opt.majorLabels;return t.forEach(H.major,function(e,t){var n=W(e.value),r=(S?y:E)+p*n,u=b+d*n;t+=G,this.createLine(z,{x1:r,y1:u,x2:r+$,y2:u+J}).setStroke(B);if(e.label&&(!K||0==(t-(1+K))%(1+K))){var a=x.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,M,x.maxLabelCharCount):{text:e.label,truncated:!1},a=x.maxLabelSize?this.getTextWithLimitLength(a.text,M,x.maxLabelSize,a.truncated):a,n=this.createText(X,z,r+(0<B.length?$:0)+o+(k?0:i),u+(0<B.length?J:0)+l+(k?0:s),O,a.text,M,D);a.truncated&&this.chart.formatTruncatedLabel(n,e.label,X),a.truncated&&this.labelTooltip(n,this.chart,e.label,a.text,M,X),"html"==X?this.htmlElements.push(n):k&&n.setTransform([{dx:i,dy:s},f.matrix.rotategAt(k,r+(0<B.length?$:0)+o,u+(0<B.length?J:0)+l)])}},this),$=c*j.length,J=h*j.length,Y=this.opt.minorLabels&&C.minMinorStep<=C.minor.tick*C.bounds.scale,t.forEach(H.minor,function(e){var t=W(e.value),n=(S?y:E)+p*t,r=b+d*t;this.createLine(z,{x1:n,y1:r,x2:n+$,y2:r+J}).setStroke(j);if(Y&&e.label){var u=x.maxLabelCharCount?this.getTextWithLimitCharCount(e.label,M,x.maxLabelCharCount):{text:e.label,truncated:!1},u=x.maxLabelSize?this.getTextWithLimitLength(u.text,M,x.maxLabelSize,u.truncated):u,t=this.createText(X,z,n+(0<j.length?$:0)+o+(k?0:i),r+(0<j.length?J:0)+l+(k?0:s),O,u.text,M,D);u.truncated&&this.chart.formatTruncatedLabel(t,e.label,X),u.truncated&&this.labelTooltip(t,this.chart,e.label,u.text,M,X),"html"==X?this.htmlElements.push(t):k&&t.setTransform([{dx:i,dy:s},f.matrix.rotategAt(k,n+(0<j.length?$:0)+o,r+(0<j.length?J:0)+l)])}},this),$=c*F.length,J=h*F.length,t.forEach(H.micro,function(e){var t=W(e.value);e=E+p*t,t=b+d*t,this.createLine(z,{x1:e,y1:t,x2:e+$,y2:t+J}).setStroke(F)},this),this.dirty=!1,this},labelTooltip:function(t,n,r,o,u,a){var l=["dijit/Tooltip"],c={type:"rect"},h=["above","below"];o=f._base._getTextBox(o,{font:u}).w||0,u=u?f.normalizedLength(f.splitFontString(u).size):0,"html"==a?(e.mixin(c,s.position(t.firstChild,!0)),c.width=Math.ceil(o),c.height=Math.ceil(u),this._events.push({shape:dojo,handle:i.connect(t.firstChild,"onmouseover",this,function(e){require(l,function(e){e.show(r,c,h)})})}),this._events.push({shape:dojo,handle:i.connect(t.firstChild,"onmouseout",this,function(e){require(l,function(e){e.hide(c)})})})):(a=t.getShape(),n=n.getCoords(),c=e.mixin(c,{x:a.x-o/2,y:a.y}),c.x+=n.x,c.y+=n.y,c.x=Math.round(c.x),c.y=Math.round(c.y),c.width=Math.ceil(o),c.height=Math.ceil(u),this._events.push({shape:t,handle:t.connect("onmouseenter",this,function(e){require(l,function(e){e.show(r,c,h)})})}),this._events.push({shape:t,handle:t.connect("onmouseleave",this,function(e){require(l,function(e){e.hide(c)})})}))},_isRtl:function(){return!1}}),n("dojo-bidi")?r("dojox.charting.axis2d.Default",[o,h]):o}),define("dojox/charting/plot2d/Default","dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils dojox/gfx/fx".split(" "),function(e,t,n,r,i,s,o,u,a,f,l){var c=a.lambda("item.purgeGroup()");return t("dojox.charting.plot2d.Default",[i,s],{defaultParams:{lines:!0,areas:!1,markers:!1,tension:"",animate:!1,enableCache:!1,interpolate:!1},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",marker:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:""},constructor:function(t,n){this.opt=e.clone(e.mixin(this.opt,this.defaultParams)),f.updateWithObject(this.opt,n),f.updateWithPattern(this.opt,n,this.optionalParams),this.animate=this.opt.animate},createPath:function(e,t,n){var r;return this.opt.enableCache&&0<e._pathFreePool.length?(r=e._pathFreePool.pop(),r.setShape(n),t.add(r)):r=t.createPath(n),this.opt.enableCache&&e._pathUsePool.push(r),r},buildSegments:function(e,t){for(var n=this.series[e],r=t?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,i=t?Math.min(n.data.length,Math.ceil(this._hScaler.bounds.to)):n.data.length,s=null,o=[];r<i;r++)if(null==n.data[r]||!t&&null==n.data[r].y){if(!this.opt.interpolate||t)s=null}else s||(s=[],o.push({index:r,rseg:s})),s.push(t&&n.data[r].hasOwnProperty("y")?n.data[r].y:n.data[r]);return o},render:function(t,i){if(this.zoom&&!this.isDataDirty())return this.performZoom(t,i);this.resetEvents(),this.dirty=this.isDirty();var s;this.dirty&&(n.forEach(this.series,c),this._eventSeries={},this.cleanGroup(),this.getGroup().setTransform(null),s=this.getGroup(),u.forEachRev(this.series,function(e){e.cleanGroup(s)}));for(var a=this.chart.theme,f,h,p=this.events(),d=this.series.length-1;0<=d;--d){var v=this.series[d];if(!this.dirty&&!v.dirty)a.skip(),this._reconnectEvents(v.name);else if(v.cleanGroup(),this.opt.enableCache&&(v._pathFreePool=(v._pathFreePool?v._pathFreePool:[]).concat(v._pathUsePool?v._pathUsePool:[]),v._pathUsePool=[]),v.data.length){var m=a.next(this.opt.areas?"area":"line",[this.opt,v],!0),g,y=this._hScaler.scaler.getTransformerFromModel(this._hScaler),b=this._vScaler.scaler.getTransformerFromModel(this._vScaler),E=this._eventSeries[v.name]=Array(v.data.length);s=v.group;for(var S=n.some(v.data,function(e){return"number"==typeof e||e&&!e.hasOwnProperty("x")}),x=this.buildSegments(d,S),T=0;T<x.length;T++){var C=x[T];g=S?n.map(C.rseg,function(e,n){return{x:y(n+C.index+1)+i.l,y:t.height-i.b-b(e),data:e}},this):n.map(C.rseg,function(e){return{x:y(e.x)+i.l,y:t.height-i.b-b(e.y),data:e}},this);if(S&&this.opt.interpolate)for(;T<x.length;)T++,(C=x[T])&&(g=g.concat(n.map(C.rseg,function(e,n){return{x:y(n+C.index+1)+i.l,y:t.height-i.b-b(e),data:e}},this)));var k=this.opt.tension?o.curve(g,this.opt.tension):"";if(this.opt.areas&&1<g.length){var L=this._plotFill(m.series.fill,t,i),A=e.clone(g);this.opt.tension?v.dyn.fill=s.createPath(k+" "+("L"+A[A.length-1].x+","+(t.height-i.b)+" L"+A[0].x+","+(t.height-i.b)+" L"+A[0].x+","+A[0].y)).setFill(L).getFill():(A.push({x:g[g.length-1].x,y:t.height-i.b}),A.push({x:g[0].x,y:t.height-i.b}),A.push(g[0]),v.dyn.fill=s.createPolyline(A).setFill(L).getFill())}if(this.opt.lines||this.opt.markers)f=m.series.stroke,m.series.outline&&(h=v.dyn.outline=o.makeStroke(m.series.outline),h.width=2*h.width+f.width);this.opt.markers&&(v.dyn.marker=m.symbol);var O=null,M=null,_=null;if(f&&m.series.shadow&&1<g.length){var D=m.series.shadow,L=n.map(g,function(e){return{x:e.x+D.dx,y:e.y+D.dy}});this.opt.lines&&(v.dyn.shadow=this.opt.tension?s.createPath(o.curve(L,this.opt.tension)).setStroke(D).getStroke():s.createPolyline(L).setStroke(D).getStroke()),this.opt.markers&&m.marker.shadow&&(D=m.marker.shadow,_=n.map(L,function(e){return this.createPath(v,s,"M"+e.x+" "+e.y+" "+m.symbol).setStroke(D).setFill(D.color)},this))}if(this.opt.lines&&1<g.length){var H;h&&(v.dyn.outline=this.opt.tension?s.createPath(k).setStroke(h).getStroke():s.createPolyline(g).setStroke(h).getStroke()),v.dyn.stroke=this.opt.tension?(H=s.createPath(k)).setStroke(f).getStroke():(H=s.createPolyline(g)).setStroke(f).getStroke(),H.setFilter&&m.series.filter&&H.setFilter(m.series.filter)}k=null;if(this.opt.markers){var B=m,O=Array(g.length),M=Array(g.length);h=null,B.marker.outline&&(h=o.makeStroke(B.marker.outline),h.width=2*h.width+(B.marker.stroke?B.marker.stroke.width:0)),n.forEach(g,function(e,t){if(this.opt.styleFunc||"number"!=typeof e.data){var n="number"!=typeof e.data?[e.data]:[];this.opt.styleFunc&&n.push(this.opt.styleFunc(e.data)),B=a.addMixin(m,"marker",n,!0)}else B=a.post(m,"marker");n="M"+e.x+" "+e.y+" "+B.symbol,h&&(M[t]=this.createPath(v,s,n).setStroke(h)),O[t]=this.createPath(v,s,n).setStroke(B.marker.stroke).setFill(B.marker.fill)},this),v.dyn.markerFill=B.marker.fill,v.dyn.markerStroke=B.marker.stroke,!k&&this.opt.labels&&(k=O[0].getBoundingBox()),p?n.forEach(O,function(e,t){var n={element:"marker",index:t+C.index,run:v,shape:e,outline:M[t]||null,shadow:_&&_[t]||null,cx:g[t].x,cy:g[t].y};S?(n.x=t+C.index+1,n.y=v.data[t+C.index]):(n.x=C.rseg[t].x,n.y=v.data[t+C.index].y),this._connectEvents(n),E[t+C.index]=n},this):delete this._eventSeries[v.name]}if(this.opt.labels){var j=k?k.width:2,F=k?k.height:2;n.forEach(g,function(e,t){if(this.opt.styleFunc||"number"!=typeof e.data){var n="number"!=typeof e.data?[e.data]:[];this.opt.styleFunc&&n.push(this.opt.styleFunc(e.data)),B=a.addMixin(m,"marker",n,!0)}else B=a.post(m,"marker");this.createLabel(s,C.rseg[t],{x:e.x-j/2,y:e.y-F/2,width:j,height:F},B)},this)}}v.dirty=!1}else v.dirty=!1,a.skip()}return r("dojo-bidi")&&this._checkOrientation(this.group,t,i),this.animate&&(f=this.getGroup(),l.animateTransform(e.delegate({shape:f,duration:1200,transform:[{name:"translate",start:[0,t.height-i.b],end:[0,0]},{name:"scale",start:[1,0],end:[1,1]},{name:"original"}]},this.animate)).play()),this.dirty=!1,this}})}),define("dojox/charting/plot2d/MarkersOnly",["dojo/_base/declare","./Default"],function(e,t){return e("dojox.charting.plot2d.MarkersOnly",t,{constructor:function(){this.opt.lines=!1,this.opt.markers=!0}})}),define("dojox/charting/action2d/Tooltip","dijit/Tooltip dojo/_base/lang dojo/_base/declare dojo/_base/window dojo/_base/connect dojo/dom-style ./PlotAction dojox/gfx/matrix dojo/has dojo/has!dojo-bidi?../bidi/action2d/Tooltip dojox/lang/functional dojox/lang/functional/scan dojox/lang/functional/fold".split(" "),function(e,t,n,r,i,s,o,u,a,f,l){var c=function(e,t){var n=e.run&&e.run.data&&e.run.data[e.index];return n&&"number"!=typeof n&&(n.tooltip||n.text)?n.tooltip||n.text:t.tooltipFunc?t.tooltipFunc(e):e.y},h=Math.PI/4,p=Math.PI/2;return s=n(a("dojo-bidi")?"dojox.charting.action2d.NonBidiTooltip":"dojox.charting.action2d.Tooltip",o,{defaultParams:{text:c,mouseOver:!0},optionalParams:{},constructor:function(e,t,n){this.text=n&&n.text?n.text:c,this.mouseOver=n&&void 0!=n.mouseOver?n.mouseOver:!0,this.connect()},process:function(n){if("onplotreset"===n.type||"onmouseout"===n.type)e.hide(this.aroundRect),this.aroundRect=null,"onplotreset"===n.type&&delete this.angles;else if(n.shape&&!(this.mouseOver&&"onmouseover"!==n.type||!this.mouseOver&&"onclick"!==n.type)){var s={type:"rect"},o=["after-centered","before-centered"];switch(n.element){case"marker":s.x=n.cx,s.y=n.cy,s.w=s.h=1;break;case"circle":s.x=n.cx-n.cr,s.y=n.cy-n.cr,s.w=s.h=2*n.cr;break;case"spider_circle":s.x=n.cx,s.y=n.cy,s.w=s.h=1;break;case"spider_plot":return;case"column":o=["above-centered","below-centered"];case"bar":s=t.clone(n.shape.getShape()),s.w=s.width,s.h=s.height;break;case"candlestick":s.x=n.x,s.y=n.y,s.w=n.width,s.h=n.height;break;default:this.angles||(this.angles="number"==typeof n.run.data[0]?l.map(l.scanl(n.run.data,"+",0),"* 2 * Math.PI / this",l.foldl(n.run.data,"+",0)):l.map(l.scanl(n.run.data,"a + b.y",0),"* 2 * Math.PI / this",l.foldl(n.run.data,"a + b.y",0)));var f=u._degToRad(n.plot.opt.startAngle),c=(this.angles[n.index]+this.angles[n.index+1])/2+f;s.x=n.cx+n.cr*Math.cos(c),s.y=n.cy+n.cr*Math.sin(c),s.w=s.h=1,f&&(0>c||c>2*Math.PI)&&(c=Math.abs(2*Math.PI-Math.abs(c))),c<h||(c<p+h?o=["below-centered","above-centered"]:c<Math.PI+h?o=["before-centered","after-centered"]:c<2*Math.PI-h&&(o=["above-centered","below-centered"]))}a("dojo-bidi")&&this._recheckPosition(n,s,o),f=this.chart.getCoords(),s.x+=f.x,s.y+=f.y,s.x=Math.round(s.x),s.y=Math.round(s.y),s.w=Math.ceil(s.w),s.h=Math.ceil(s.h),this.aroundRect=s,(n=this.text(n,this.plot))&&e.show(this._format(n),this.aroundRect,o),this.mouseOver||(this._handle=i.connect(r.doc,"onclick",this,"onClick"))}},onClick:function(){this.process({type:"onmouseout"})},_recheckPosition:function(e,t,n){},_format:function(e){return e}}),a("dojo-bidi")?n("dojox.charting.action2d.Tooltip",[s,f]):s}),define("dojox/charting/action2d/Magnify","dojo/_base/connect dojo/_base/declare ./PlotAction dojox/gfx/matrix dojox/gfx/fx dojo/fx dojo/fx/easing".split(" "),function(e,t,n,r,i,s,o){return t("dojox.charting.action2d.Magnify",n,{defaultParams:{duration:400,easing:o.backOut,scale:2},optionalParams:{},constructor:function(e,t,n){this.scale=n&&"number"==typeof n.scale?n.scale:2,this.connect()},process:function(t){if(t.shape&&t.type in this.overOutEvents&&"cx"in t&&"cy"in t&&"spider_plot"!=t.element&&"spider_poly"!=t.element){var n=t.run.name,o=t.index,u=[],a,f,c;n in this.anim?a=this.anim[n][o]:this.anim[n]={},a?a.action.stop(!0):this.anim[n][o]=a={},"onmouseover"==t.type?(f=r.identity,c=this.scale):(f=r.scaleAt(this.scale,t.cx,t.cy),c=1/this.scale),f={shape:t.shape,duration:this.duration,easing:this.easing,transform:[{name:"scaleAt",start:[1,t.cx,t.cy],end:[c,t.cx,t.cy]},f]},t.shape&&u.push(i.animateTransform(f)),t.outline&&(f.shape=t.outline,u.push(i.animateTransform(f))),t.shadow&&(f.shape=t.shadow,u.push(i.animateTransform(f))),u.length?(a.action=s.combine(u),"onmouseout"==t.type&&e.connect(a.action,"onEnd",this,function(){this.anim[n]&&delete this.anim[n][o]}),a.action.play()):delete this.anim[n][o]}}})}),define("dojox/charting/widget/SelectableLegend","dojo/_base/array dojo/_base/declare dojo/query dojo/_base/connect dojo/_base/Color ./Legend dijit/form/CheckBox ../action2d/Highlight dojox/lang/functional dojox/gfx/fx dojo/keys dojo/dom-construct dojo/dom-prop".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=t(null,{constructor:function(t){this.legend=t,this.index=0,this.horizontalLength=this._getHrizontalLength(),e.forEach(t.legends,function(e,t){0<t&&n("input",e).attr("tabindex",-1)}),this.firstLabel=n("input",t.legends[0])[0],r.connect(this.firstLabel,"focus",this,function(){this.legend.active=!0}),r.connect(this.legend.domNode,"keydown",this,"_onKeyEvent")},_getHrizontalLength:function(){var e=this.legend.horizontal;return"number"==typeof e?Math.min(e,this.legend.legends.length):e?this.legend.legends.length:1},_onKeyEvent:function(e){if(this.legend.active)if(e.keyCode==l.TAB)this.legend.active=!1;else{var t=this.legend.legends.length;switch(e.keyCode){case l.LEFT_ARROW:this.index--,0>this.index&&(this.index+=t);break;case l.RIGHT_ARROW:this.index++,this.index>=t&&(this.index-=t);break;case l.UP_ARROW:0<=this.index-this.horizontalLength&&(this.index-=this.horizontalLength);break;case l.DOWN_ARROW:this.index+this.horizontalLength<t&&(this.index+=this.horizontalLength);break;default:return}this._moveToFocus(),Event.stop(e)}},_moveToFocus:function(){n("input",this.legend.legends[this.index])[0].focus()}});return t("dojox.charting.widget.SelectableLegend",s,{outline:!1,transitionFill:null,transitionStroke:null,postCreate:function(){this.legends=[],this.legendAnim={},this._cbs=[],this.inherited(arguments)},refresh:function(){this.legends=[],this._clearLabels(),this.inherited(arguments),this._applyEvents(),new p(this)},_clearLabels:function(){for(var e=this._cbs;e.length;)e.pop().destroyRecursive()},_addLabel:function(e,t){this.inherited(arguments);var r=n("td",this.legendBody),i=r[r.length-1];this.legends.push(i),r=new o({checked:!0}),this._cbs.push(r),c.place(r.domNode,i,"first"),i=n("label",i)[0],h.set(i,"for",r.id)},_applyEvents:function(){this.chart.dirty||e.forEach(this.legends,function(t,i){var s,o=[],u,f;this._isPie()?(s=this.chart.stack[0],o.push(s.group.children[i]),u=s.name,f=this.chart.series[0].name):(s=this.chart.series[i],o=s.group.children,u=s.plot,f=s.name);var l={fills:a.map(o,"x.getFill()"),strokes:a.map(o,"x.getStroke()")};s=n(".dijitCheckBox",t)[0],r.connect(s,"onclick",this,function(e){this._toggle(o,i,t.vanished,l,f,u),t.vanished=!t.vanished,e.stopPropagation()});var c=n(".dojoxLegendIcon",t)[0],h=this._getFilledShape(this._surfaces[i].children);e.forEach(["onmouseenter","onmouseleave"],function(e){r.connect(c,e,this,function(e){this._highlight(e,h,o,i,t.vanished,l,f,u)})},this)},this)},_toggle:function(t,n,r,s,o,u){e.forEach(t,function(e,t){var n=s.fills[t],o=this._getTransitionFill(u),a=s.strokes[t],l=this.transitionStroke;n&&(o&&("string"==typeof n||n instanceof i)?f.animateFill({shape:e,color:{start:r?o:n,end:r?n:o}}).play():e.setFill(r?n:o)),a&&!this.outline&&e.setStroke(r?a:l)},this)},_highlight:function(t,n,r,i,s,o,u,a){if(!s){var f=this._getAnim(a),l=this._isPie(),c="mouseenter"==t.type?"onmouseover":"mouseleave"==t.type?"onmouseout":"on"+t.type;f.process({shape:n,index:l?"legend"+i:"legend",run:{name:u},type:c}),e.forEach(r,function(e,t){e.setFill(o.fills[t]);var n={shape:e,index:l?i:t,run:{name:u},type:c};f.duration=100,f.process(n)})}},_getAnim:function(e){return this.legendAnim[e]||(this.legendAnim[e]=new u(this.chart,e),this.chart.getPlot(e).dirty=!1),this.legendAnim[e]},_getTransitionFill:function(e){return-1!=this.chart.stack[this.chart.plots[e]].declaredClass.indexOf("dojox.charting.plot2d.Stacked")?this.chart.theme.plotarea.fill:null},_getFilledShape:function(e){for(var t=0;e[t];){if(e[t].getFill())return e[t];t++}return null},_isPie:function(){return"dojox.charting.plot2d.Pie"==this.chart.stack[0].declaredClass},destroy:function(){this._clearLabels(),this.inherited(arguments)}})}),define("esri/geometry/Polyline","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has esri/kernel esri/lang esri/SpatialReference esri/geometry/Geometry esri/geometry/Point esri/geometry/Extent".split(" "),function(e,t,n,r,i,s,o,u,a,f){var l={type:"polyline",paths:null};return e=e(u,{declaredClass:"esri.geometry.Polyline",constructor:function(e){n.mixin(this,l),this.paths=[],this._path=0,e&&(n.isArray(e)?this.paths=n.isArray(e[0][0])?e:[e]:e.paths?n.mixin(this,e):this.spatialReference=e,this.spatialReference&&(this.spatialReference=new o(this.spatialReference))),this.verifySR()},_extent:null,addPath:function(e){return this._extent=null,this._path=this.paths.length,this.paths[this._path]=[],n.isArray(e[0])?t.forEach(e,this._addPointArr,this):t.forEach(e,this._addPoint,this),this},_addPointArr:function(e){this.paths[this._path].push(e)},_addPoint:function(e){this.paths[this._path].push([e.x,e.y])},_insertPoints:function(e,n){this._extent=null,this._path=n,this.paths[this._path]||(this.paths[this._path]=[]),t.forEach(e,this._addPoint,this)},_validateInputs:function(e,t){return null!==e&&void 0!==e&&(0>e||e>=this.paths.length)||null!==t&&void 0!==e&&(0>t||t>=this.paths[e].length)?!1:!0},getPoint:function(e,t){if(this._validateInputs(e,t))return new a(this.paths[e][t],this.spatialReference)},setPoint:function(e,t,n){if(this._validateInputs(e,t))return this._extent=null,this.paths[e][t]=[n.x,n.y],this},insertPoint:function(e,t,n){if(this._validateInputs(e)&&s.isDefined(t)&&0<=t&&t<=this.paths[e].length)return this._extent=null,this.paths[e].splice(t,0,[n.x,n.y]),this},removePath:function(e){if(this._validateInputs(e,null)){this._extent=null,e=this.paths.splice(e,1)[0];var t,n=e.length,r=this.spatialReference;for(t=0;t<n;t++)e[t]=new a(e[t],r);return e}},removePoint:function(e,t){if(this._validateInputs(e,t))return this._extent=null,new a(this.paths[e].splice(t,1)[0],this.spatialReference)},getExtent:function(){var e;if(this._extent)return e=new f(this._extent),e._partwise=this._partwise,e;e=this.paths;var t=e.length;if(t&&e[0].length){var n,r,i,s,o,u,a,l,c=s=e[0][0][0],h=o=e[0][0][1],p=Math.min,d=Math.max,v=this.spatialReference,m=[],g,y,b,E;for(u=0;u<t;u++){n=e[u],g=y=n[0]&&n[0][0],b=E=n[0]&&n[0][1],l=n.length;for(a=0;a<l;a++)r=n[a],i=r[0],r=r[1],c=p(c,i),h=p(h,r),s=d(s,i),o=d(o,r),g=p(g,i),b=p(b,r),y=d(y,i),E=d(E,r);m.push(new f({xmin:g,ymin:b,xmax:y,ymax:E,spatialReference:v?v.toJson():null}))}return this._extent={xmin:c,ymin:h,xmax:s,ymax:o,spatialReference:v?v.toJson():null},this._partwise=1<m.length?m:null,e=new f(this._extent),e._partwise=this._partwise,e}},toJson:function(){var e={paths:n.clone(this.paths)},t=this.spatialReference;return t&&(e.spatialReference=t.toJson()),e}}),e.defaultProps=l,r("extend-esri")&&(n.setObject("geometry.Polyline",e,i),i.geometry.defaultPolyline=l),e}),define("modules/crosstool.js",["modules/addsymbol.js","modules/addtextsymbol.js","modules/identify.js","modules/tools.js","modules/clearnode.js","modules/cleargraphics.js","modules/featureevents.js","modules/canvasidentify.js","dojo/aspect","dojo/on","dojo/dom-class","dojo/dom-construct","dojo/_base/Color","dojo/Deferred","dojox/charting/Chart","dojox/charting/themes/PurpleRain","dojox/charting/axis2d/Default","dojox/charting/plot2d/MarkersOnly","dojox/charting/action2d/Tooltip","dojox/charting/action2d/Magnify","dojox/charting/widget/SelectableLegend","esri/tasks/geometry","esri/geometry/Polyline","esri/geometry/Point","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N){return function(m,E,C,k,L,A){A=A?A:{};var O,M,_=window,D=document,P=A.map||_.esri.map||_.map,H=A.rastersShowing||null,B=A.eventFeatures||[],j=A.chartNames||null,F=A.chartDates||null,I=A.tooltip||null,q=n(k,P,L,H),R=u(m,P),U=P.spatialReference,z=P.graphics,W,X,V=[],$=1,J,K,Q=1,G,Y=D.all&&D.addEventListener&&!window.atob?!0:!1,Z=T.STYLE_SOLID,et=new T(Z,new h([0,0,0]),2),tt=new N({size:6,color:new h([0,0,0])}),nt=new T(Z,new h([180,180,180]),2),rt=new N(N.STYLE_CIRCLE,6,new T(Z,new h([180,180,180]),1),new h([140,140,140])),it=new N(N.STYLE_CIRCLE,10,et,new h("#4879bc")),st={CIRCLE:"m-3, 0 c0,-5 7,-5 7, 0 m-7, 0 c0, 5 7, 5 7, 0",SQUARE:"m-3,-3 l0, 7 7, 0 0,-7 z",DIAMOND:"m0,-3 l3, 3 -3, 3 -3,-3 z",CROSS:"m0,-3 l0, 7 m-3,-3 l7, 0",X:"m-3,-3 l7, 7 m0,-7 l-7, 7",TRIANGLE:"m-3, 3 l3,-7 3, 7 z",TRIANGLE_INVERTED:"m-3,-3 l3, 7 3,-7 z"},ot=function(e,t){var n=Math,r=n.pow(10,t);return n.round(e*r)/r},ut=function(e,t){K=new S(U),K.addPath([e,t]),J.setGeometry(K),Q=1},at=function(e,t){Q&&(Q=0,ut(e,t))},ft=function(e){e.pageX<X+10&&e.pageX>X-10&&e.pageY<W+10&&e.pageY>W-10&&ct(e)},lt=function(e){this.e1=e,this.e2=null,this.task=new R.task,this.results=null,this.seriesCount=0,this.pointObj=null,this.graphics=[],this.legend=null,this.swellOver=null,this.swellOut=null,this.chart=null,this.charted=0,this.chartContainer=null,this.chartNumber=$++,this.chartName="",this.prepared=[]},ct=function(t){window.chartNames=j;var n=new lt(t),r=t.mapPoint;V.push(n),vt(r,n).then(function(e){n.task.prepare(e),n.chartName=j[e[0]],n.prepared=e}),e(P,r,tt,n.graphics),J=e(P,null,et,n.graphics),M.handlers[1].remove(),M.handlers[2]=P.on("mouse-move",function(e){at(r,e.mapPoint)}),M.handlers[3]=P.on("mouse-up",function(e){e.pageX<X+10&&e.pageX>X-10&&e.pageY<W+10&&e.pageY>W-10&&mt(t,e,n)}),M.handlers[4]=P.on("zoom-start",dt),M.handlers[5]=P.on("pan-start",dt)},ht=function(){M.handlers[2].remove(),M.handlers[3].remove(),M.handlers[4].remove(),M.handlers[5].remove(),M.handlers[1]=P.on("mouse-up",ft)},pt=function(){var e=V.pop();Nt(e),$--},dt=function(){pt(),ht()},vt=function(e,t){function f(e){for(var t=0;t<e.length;t++)u[e[t].layerId]||(u[e[t].layerId]=1);if(++a===9){for(var r in u)o[o.length]=+r;n.resolve(o)}}var n=new p,r=e.x,i=e.y,s=e.spatialReference,o=[],u={},a=0;for(var l=-40;l<80;l+=40)for(var c=-40;c<80;c+=40){var h=new x({x:r+l,y:i+c,spatialReference:s});q(h).then(f)}return n},mt=function(n,r,i){var s=n.mapPoint,o=r.mapPoint;i.e2=r,at(s,o);if(o.x===s.x&&o.y===s.y)return;e(P,o,tt,i.graphics),ht(),i.pointObj=gt(i),t(P,i.chartNumber,i.e1.mapPoint,i.pointObj.ang,0,i.graphics,M.handlers),setTimeout(function(){i.task.execute(i.prepared,i.pointObj,yt(i))},10)},gt=function(e){var t=Math,n=e.e1.mapPoint,r=e.e2.mapPoint,i=e.e1.screenPoint,s=e.e2.screenPoint,o=i.x,u=i.y,a=n.x-r.x,f=n.y-r.y,l=o-s.x,c=u-s.y,h=t.atan(f/a),p=t.cos((n.getLatitude()+r.getLatitude())/360*t.PI),d=3.28084,v=t.sqrt(a*a+f*f)*p*d,m=t.sqrt(l*l+c*c),g=t.ceil(v/600)*3,y=g/d/p,b=g*m/v,w=t.ceil(v/g+1),E=new Array(w*2),S=t.cos(h),x=t.sin(h),T=b*S,N=b*x,C=y*S,k=y*x;l<0?N=-N:l>0?(T=-T,C=-C,k=-k):(T=0,k=-k,C=0);for(var L=0,A=E.length;L<A;L+=2)E[L]=t.round(o),E[L+1]=t.round(u),o+=T,u+=N;return{points:E,xGap:C,yGap:k,ftGap:g,dist:v,ang:h}},yt=function(e){var t=bt(e),n=0;return function(r){if(!r){pt();return}setTimeout(function(){e.results=r;for(var i in r){var s=r[i];for(var o=0,u=s.length;o<u;o++)s[o].y<n&&(n=s[o].y);t.addSeries(F[i],s),e.seriesCount++}t.addAxis("y",{vertical:!0,min:n-5,max:5,title:"(ft)",titleGap:8}),new y(t,"default"),new b(t,"default"),t.render(),xt(e),At(e),e.charted=1},0)}},bt=function(e){var t=c.create("div",{height:300},G),n=c.create("div",{height:300},t),r=new d(n);return G.scrollTop=G.scrollHeight,r.addPlot("default",{type:g}),r.addAxis("x",{min:-1,max:Math.ceil(e.pointObj.dist),title:"(ft)",titleGap:8,titleOrientation:"away"}),r.addAxis("y",{vertical:!0,min:-30,max:5,title:"(ft)",titleGap:8}),r.title="Profile "+e.chartNumber+": "+e.chartName,r.titleFont="italic bold normal 24px Harabara",r.titleFontColor="#99ceff",r.setTheme(v),e.chart=r,e.chartContainer=t,Et(e),St(e),r.render(),r},wt=function(e){var t="x,y,z\n",n=ot(e.pointObj.xGap,2),r=ot(e.pointObj.yGap,2),i=ot(e.e1.mapPoint.x,2),s=ot(e.e1.mapPoint.y,2),o,u,a=function(e){var i=e.y;t+=o+","+u+","+i+"\n",o=ot(o+n,2),u=ot(u+r,2)};for(var f in e.results)o=i,u=s,e.results[f].forEach(a);return t},Et=function(e){var t=e.chartName+"_Profile"+e.chartNumber+"_"+"WebMercator.txt",n=D.createElement("a");n.textContent="Export",n.className="export",_.Blob?(_.navigator.msSaveBlob?n.onclick=function(){_.navigator.msSaveBlob(new _.Blob([wt(e)]),t)}:n.download=t,n.onmousedown=function(){n.href=_.URL.createObjectURL(new _.Blob([wt(e)]))}):n.onclick=function(e){var t=c.create("div",{"class":"ie9noexport"},n);t.textContent="Exporting is only supported in modern browsers.",_.setTimeout(function(){n.removeChild(t)},1500)},Y&&(n.style.color="#FF0000"),e.chartContainer.appendChild(n)},St=function(e){var t=D.createElement("div");t.className="closebox graphclose",e.chartContainer.appendChild(t),f.once(t,"click",function(){Nt(e,1)})},xt=function(e){var t=D.createElement("div");e.chartContainer.appendChild(t),e.legend=new w({chart:e.chart,outline:!1},t)},Tt=function(){},Nt=function(e,t){if(t){e.chartNumber===$-1&&$--;for(var n=0;n<V.length;n++)if(V[n]===e){V.splice(n,1);break}}var r=e.chartContainer;r&&(e.charted&&(Ct(e),e.legend.destroy()),e.chart.destroy(),i(r),G.removeChild(r)),s(P,e.graphics)},Ct=function(e){e.swellOver.remove(),e.swellOver=null,e.swellOut.remove(),e.swellOut=null},kt=function(e){for(var t=0,n=e.length;t<n;t++)At(e[t]),e[t].legend.refresh()},Lt=function(e){for(var t=0,n=e.length;t<n;t++)Ct(e[t]);f.once(_,"mouseup",function(t){G.style.visibility="hidden";for(var n=0,r=e.length;n<r;n++)e[n].chart.resize();G.style.visibility="visible",kt(e)})},At=function(t){var n,r={},i=t.chartContainer.querySelector("g>g"),s=i.firstChild.childNodes,o=t.graphics;for(var u=0;u<s.length;u+=2)r[s[u].getAttribute("path").slice(1,6)]=u/2;s=null,t.swellOver=f(i,"mouseover",function(i){var s=i.target.getAttribute("path").slice(1,6);r[s]!==undefined&&(n=r[s]),n!==undefined&&e(P,Ot(n,t),it,o)}),t.swellOut=f(i,"mouseout",function(){n!==undefined&&(z.remove(o[o.length-1]),o.length=o.length-1)})},Ot=function(e,t){var n=t.pointObj,r=t.e1,i=r.mapPoint.x,s=r.mapPoint.y,o=e*n.xGap,u=e*n.yGap;return new x({x:i+o,y:s+u,spatialReference:U})};return O={handlers:[],init:function(e){function t(e){l.contains(C,"clickable")?r.toggle(e,M):I&&I(e)}M=this,E.init(),t(e),a.after(E,"resize",function(e,t){t==="width"&&V.length&&Lt(V)},!0),f(C,"mousedown",t),f(E.getClose(),"click",function(){r.wipe(O,C,B)}),v.chart.fill="rgba(0,0,0,0)",v.plotarea.fill="rgba(0,0,0,0)",v.setMarkers(st)},start:function(){E.show(),G=E.getContainer(),this.revive()},idle:function(){for(var e=0;e<M.handlers.length;e++)M.handlers[e].remove();M.handlers.length=0,o.enable(B)},revive:function(){o.disable(B),M.handlers[0]=P.on("mouse-down",function(e){X=e.pageX,W=e.pageY}),M.handlers[1]=P.on("mouse-up",ct)},stop:function(){this.idle(),$=1;for(var e=0,t=V.length;e<t;e++)Nt(V[e]);i(G),E.hide(),V.length=0}},O}}),define("modules/identtool.js",["modules/addsymbol.js","modules/addtextsymbol.js","modules/identify.js","modules/tools.js","modules/featureevents.js","modules/clearnode.js","modules/cleargraphics.js","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","dojo/on","dojo/dom-class","dojo/_base/Color"],function(e,t,n,r,i,s,o,u,a,f,l,c){return function(h,p,d,v){function B(e){var t=g.createElement("div");return t.className="identDiv",t.style.top=e.y-10+"px",t.style.left=e.x+10+"px",t}function j(e){var t=this.style,n=e.offsetY-10+"px",r=e.offsetX+10+"px";t.top=n,t.left=r,t.display="block"}function F(e){this.style.display="none"}function I(e){e.setSymbol(A)}function q(e,n,r){var i=1,o,u="",a="No Data";e&&e.forEach(function(e,t){var n=e.value,s=e.layerId,f=E[s],l;n!=="NoData"?(l=Math.round(n*10)/10,a=l,i=0):l="No Data",o||(o=new B(r));if(f!==u){u=f;var c=g.createElement("strong");c.innerHTML=f,o.appendChild(c)}var h=g.createElement("span");h.className="identEntry",h.innerHTML=S[s]+": <span class='identValue'>"+l+"</span> ft",o.appendChild(h)}),i?(t(y,a,n.geometry,0,O,M.labels,M.handlers),I(n),s(o),o.parentNode.removeChild(o)):(t(y,a,n.geometry,0,0,M.labels,M.handlers),H.push(o),P.push(f(n.getNode(),"mouseover",j.bind(o))),P.push(f(n.getNode(),"mouseout",F.bind(o))),N.appendChild(o))}function R(t){var n=t.mapPoint,r=t.screenPoint,i=e(y,n,L,M.graphics);T(n).then(function(e){q(e,i,r)})}function U(e){var t=g.getElementsByTagName("script")[0],n=g.createElement("link");n.rel="stylesheet",n.href=e||"modules/identtool.css",t.parentNode.insertBefore(n,t)}var m=window,g=document,y=v.map||m.esri.map||m.map,b=v.rastersShowing||null,w=v.eventFeatures||[],E=v.names||[],S=v.dates||[],x=v.tooltip||null,T=n(p,y,d,b),N=g.getElementById("mapDiv"),C=u.STYLE_SOLID,k=new u(C,new c([0,0,0]),2),L=new a({size:6,color:new c([0,0,0])}),A=new a(a.STYLE_CIRCLE,6,new u(C,new c([180,180,180]),1),new c([140,140,140])),O=new c([180,180,180]),M,_,D,P=[],H=[];return{handlers:[],graphics:[],labels:[],init:function(e){function t(e){if(l.contains(ident,"clickable"))return r.toggle(e,M);x&&x(e)}M=this,U(),t(e),f(ident,"mousedown",t)},start:function(){this.revive()},idle:function(){i.enable(w),y.setMapCursor("default"),this.handlers[0].remove(),this.handlers[1].remove(),this.handlers[2]&&this.handlers[2].remove(),this.handlers.length=0,identOff=1},revive:function(){i.disable(w),y.setMapCursor("help"),this.handlers[0]=y.on("mouse-down",function(e){_=e.pageX,D=e.pageY}),this.handlers[1]=y.on("mouse-up",function(e){e.pageX<_+10&&e.pageX>_-10&&e.pageY<D+10&&e.pageY>D-10&&R(e)}),identOff=0},stop:function(){g.getElementsByClassName("idle")[0]!==ident&&this.idle(),o(y,this.graphics),o(y,this.labels),P.forEach(function(e){e.remove()}),H.forEach(function(e){s(e),e.parentNode.removeChild(e)}),this.graphics.length=0,this.labels.length=0,P.length=0,H.length=0},isShowing:function(){return g.getElementsByClassName("activeTool")[0]===ident||g.getElementsByClassName("idle")[0]===ident}}}}),require({cache:{"url:esri/dijit/templates/Measurement.html":"<div class=\"esriMeasurement\">\n  <div dojoType='dijit.form.ToggleButton' baseClass='esriButton' dojoAttachPoint='area' checked='false' iconClass='areaIcon' showLabel='false' dojoAttachEvent='onClick:areaToggleButton'></div>\n  <div dojoType='dijit.form.ToggleButton' baseClass='esriButton' dojoAttachPoint='distance' iconClass='distanceIcon' showLabel='false' dojoAttachEvent='onClick:distanceToggleButton'></div>\n  <div dojoType='dijit.form.ToggleButton' baseClass='esriButton' dojoAttachPoint='location' iconClass='locationIcon' showLabel='false' dojoAttachEvent='onClick:locationToggleButton'></div>\n  <div style=\"display:inline;margin-left:2px;margin-right:2px;padding-top:2px;\">|</div>\n  <button dojoType='dijit.form.DropDownButton' baseClass='esriToggleButton' dojoAttachPoint='unit' label='unit' value='unit' style='visibility:hidden;'></button>\n  <div dojoType='dijit.layout.ContentPane' dojoAttachPoint='resultLabel' class='resultLabel'></div>\n  <div dojoType='dijit.layout.ContentPane' dojoAttachPoint='resultValue' align='left' class='result'></div>\n</div>"}}),define("esri/dijit/Measurement","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/number dojo/dom-style dijit/_Widget dijit/_Templated dijit/registry dijit/Menu dijit/MenuItem esri/SpatialReference esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/geometry/geodesicUtils esri/geometry/webMercatorUtils esri/geometry/Point esri/geometry/Polyline esri/geometry/Polygon esri/graphic esri/tasks/AreasAndLengthsParameters esri/tasks/LengthsParameters esri/tasks/GeometryService esri/kernel esri/config esri/domUtils esri/lang esri/units esri/WKIDUnitConversion esri/dijit/_EventedWidget dojo/text!esri/dijit/templates/Measurement.html dojo/i18n!esri/nls/jsapi dijit/form/ToggleButton dijit/form/DropDownButton dijit/layout/ContentPane".split(" "),function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P){return t=t([_,f,l],{declaredClass:"esri.dijit.Measurement",widgetsInTemplate:!0,templateString:D,unitDictionary:[],result:null,inputPoints:[],measureGraphics:[],numberPattern:"#,###,###,##0.0",_eventMap:{"measure-end":["toolName","geometry"]},constructor:function(t,r){t=t||{};if(t.map){this._map=t.map;if(this._map.loaded)this._map.cs=this._checkCS(this._map.spatialReference);else var o=i.connect(this._map,"onLoad",this,function(){i.disconnect(o),o=null,this._map.cs=this._checkCS(this._map.spatialReference)});this._geometryService=k.defaults.geometryService;if(t.pointSymbol)this._pointSymbol=t.pointSymbol;else{var u=e.toUrl("esri/dijit/images/flag.png");this._pointSymbol=new v(u,24,24),this._pointSymbol.setOffset(9,11)}this._lineSymbol=t.lineSymbol?t.lineSymbol:new m(m.STYLE_SOLID,new s([0,128,255]),3),this._defaultLengthUnit=t.defaultLengthUnit?t.defaultLengthUnit:O.MILES,this._defaultAreaUnit=t.defaultAreaUnit?t.defaultAreaUnit:O.ACRES,this._defaultLocationUnit=t.defaultLocationUnit?t.defaultLocationUnit:O.DECIMAL_DEGREES,this._snappingCallback=n.hitch(this,this._snappingCallback)}else console.log("dijit.MeasureTool: unable to find the 'map' property in parameters")},startup:function(){var e=P.widgets.measurement;this.unitDictionary[e.NLS_length_miles]=1,this.unitDictionary[e.NLS_length_kilometers]=1.609344,this.unitDictionary[e.NLS_length_feet]=5280,this.unitDictionary[e.NLS_length_meters]=1609.34,this.unitDictionary[e.NLS_length_yards]=1760,this.unitDictionary[e.NLS_length_nautical_miles]=.869,this.unitDictionary[e.NLS_area_acres]=1,this.unitDictionary[e.NLS_area_sq_kilometers]=.004047,this.unitDictionary[e.NLS_area_sq_miles]=.0015625,this.unitDictionary[e.NLS_area_sq_feet]=43560,this.unitDictionary[e.NLS_area_sq_meters]=4046.87,this.unitDictionary[e.NLS_area_hectares]=.4047,this.unitDictionary[e.NLS_area_sq_yards]=4840,this.unitDictionary[e.NLS_area_sq_nautical_miles]=.001179874545293396,this.units={esriMiles:e.NLS_length_miles,esriKilometers:e.NLS_length_kilometers,esriFeet:e.NLS_length_feet,esriMeters:e.NLS_length_meters,esriYards:e.NLS_length_yards,esriNauticalMiles:e.NLS_length_nautical_miles,esriAcres:e.NLS_area_acres,esriSquareKilometers:e.NLS_area_sq_kilometers,esriSquareMiles:e.NLS_area_sq_miles,esriSquareFeet:e.NLS_area_sq_feet,esriSquareMeters:e.NLS_area_sq_meters,esriHectares:e.NLS_area_hectares,esriSquareYards:e.NLS_area_sq_yards,esriSquareNauticalMiles:e.NLS_area_sq_nautical_miles,esriDecimalDegrees:e.NLS_decimal_degrees,esriDegreeMinuteSeconds:e.NLS_deg_min_sec},c.byNode(this.distance.domNode).setLabel(P.widgets.measurement.NLS_distance),c.byNode(this.area.domNode).setLabel(P.widgets.measurement.NLS_area),c.byNode(this.location.domNode).setLabel(P.widgets.measurement.NLS_location),c.byNode(this.resultLabel.domNode).setContent(P.widgets.measurement.NLS_resultLabel)},measureArea:function(){this._map.navigationManager.setImmediateClick(!0),this._createAreaUnitList(),this.inputPoints=[],this.tempGraphic=new S,this.tempGraphic.setSymbol(this._lineSymbol),this.tempGraphic.setGeometry(new w(this._map.spatialReference)),this._map.graphics.add(this.tempGraphic),"PCS"===this._map.cs&&(this._geometryAreaHandler=i.connect(this._geometryService,"onAreasAndLengthsComplete",this,"_outputArea")),this.mouseClickMapHandler=i.connect(this._map,"onClick",this,"_measureAreaMouseClickHandler"),this.doubleClickMapHandler=i.connect(this._map,"onDblClick",this,"_measureAreaDblClickHandler")},measureDistance:function(){this._map.navigationManager.setImmediateClick(!0),"PCS"===this._map.cs&&(this._projectMapExtent(this._map.extent),this._mapExtentChangeHandler=i.connect(this._map,"onExtentChange",this,"_projectMapExtent")),this.inputPoints=[],this._createLengthUnitList(),this.mouseClickMapHandler=i.connect(this._map,"onClick",this,"_measureDistanceMouseClickHandler"),this.doubleClickMapHandler=i.connect(this._map,"onDblClick",this,"_measureDistanceDblClickHandler")},measureLocation:function(){this._map.navigationManager.setImmediateClick(!0),this.measureGraphics=[],this._createLocationUnitList(),this._map.graphics.remove(this.locationGraphic),"PCS"===this._map.cs&&(this._projectMapExtent(this._map.extent),this._mapExtentChangeHandler=i.connect(this._map,"onExtentChange",n.hitch(this,this._projectMapExtent))),this._clickMapHandler=i.connect(this._map,"onClick",this,"_measureLocationClickHandler"),this.mouseMoveMapHandler=i.connect(this._map,"onMouseMove",this,"_showCoordinates"),this.mouseDragMapHandler=i.connect(this._map,"onMouseDrag",n.hitch(this,function(){c.byNode(this.resultValue.domNode).setAttribute("disabled",!0)}))},setTool:function(e,t){this.closeTool();var n=c.byNode(this[e].domNode).checked;a.set(this.unit.domNode,"visibility","visible"),c.byNode(this.area.domNode).setAttribute("checked",!1),c.byNode(this.distance.domNode).setAttribute("checked",!1),c.byNode(this.location.domNode).setAttribute("checked",!1);if(!0===t||!1===t)n=t;c.byNode(this[e].domNode).setAttribute("checked",n),n&&(this.activeTool=e,this.map.isDoubleClickZoom&&this._map.disableDoubleClickZoom(),"area"===e?this.measureArea():"distance"===e?this.measureDistance():"location"===e&&this.measureLocation(),this._map.snappingManager&&(this._map.snappingManager._startSelectionLayerQuery(),this._map.snappingManager._setUpSnapping()))},areaToggleButton:function(){this.clearResult(),this.setTool("area")},distanceToggleButton:function(){this.clearResult(),this.setTool("distance")},locationToggleButton:function(){this.clearResult(),this.setTool("location")},closeTool:function(){var e=this._map;e.navigationManager.setImmediateClick(!1),e.isDoubleClickZoom||e.enableDoubleClickZoom(),this.inputPoints=[],e.snappingManager&&e.snappingManager._snappingGraphic&&e.graphics.remove(e.snappingManager._snappingGraphic),i.disconnect(this.mouseClickMapHandler),i.disconnect(this.mouseMoveMapHandler),i.disconnect(this.doubleClickMapHandler),i.disconnect(this.mouseDragMapHandler),i.disconnect(this._clickMapHandler),i.disconnect(this._mapExtentChangeHandler),i.disconnect(this._geometryAreaHandler),this.mouseClickMapHandler=this.mouseMoveMapHandler=this.doubleClickMapHandler=this.mouseDragMapHandler=this._clickMapHandler=this._mapExtentChangeHandler=this._geometryAreaHandler=null,this._map.snappingManager&&(this._map.snappingManager._stopSelectionLayerQuery(),this._map.snappingManager._killOffSnapping())},clearResult:function(){var e=this._map;this.result=0,c.byNode(this.resultValue.domNode).setAttribute("content","");var t;for(t=0;t<this.measureGraphics.length;t++)e.graphics.remove(this.measureGraphics[t]);this.measureGraphics=[],e.graphics.remove(this.tempGraphic)},show:function(){L.show(this.domNode)},hide:function(){L.hide(this.domNode)},showTool:function(e){this[e].domNode.style.display="inline"},hideTool:function(e){this[e].domNode.style.display="none"},destroy:function(){this.closeTool(),this.clearResult(),this.inherited(arguments),this._map=this._geometryService=this.measureGraphic=this.measureGraphic=this.tempGraphic=null},onMeasureEnd:function(){},_densifyGeometry:function(e){return"Web Mercator"===this._map.cs&&(e=y.webMercatorToGeographic(e)),e="PCS"===this._map.cs?e:g.geodesicDensify(e,5e5),"Web Mercator"===this._map.cs&&(e=y.geographicToWebMercator(e)),e},_measureAreaMouseClickHandler:function(e){var t;this._map.snappingManager&&(t=this._map.snappingManager._snappingPoint),e=t||e.mapPoint,this.inputPoints.push(e),this._currentStartPt=e;if(1===this.inputPoints.length){this.tempGraphic.setGeometry(new w(this._map.spatialReference));for(t=0;t<this.measureGraphics.length;t++)this._map.graphics.remove(this.measureGraphics[t]);this.measureGraphics=[],this.result=0,this._outputResult(this.result,P.widgets.measurement.NLS_area_acres),this.mouseMoveMapHandler=i.connect(this._map,"onMouseMove",this,"_measureAreaMouseMoveHandler")}this.measureGraphic=new S,this.measureGraphic.setSymbol(this._lineSymbol),this.measureGraphics.push(this.measureGraphic);if(1<this.inputPoints.length){var n=new w(this._map.spatialReference);n.addPath([this.inputPoints[this.inputPoints.length-2],e]),t=new w(this._map.spatialReference),t.addPath([this.inputPoints[0],e]),e=this._densifyGeometry(n),t=this._densifyGeometry(t),this.tempGraphic.setGeometry(t),this.measureGraphic.setGeometry(e),this._map.graphics.add(this.measureGraphic)}},_measureAreaMouseMoveHandler:function(e){var t;if(0<this.inputPoints.length){var n=new w(this._map.spatialReference),r;this._map.snappingManager&&(r=this._map.snappingManager._snappingPoint),t=r||e.mapPoint,n.addPath([this._currentStartPt,t]),e=this._densifyGeometry(n),this.tempGraphic.setGeometry(e)}1<this.inputPoints.length&&(e=new w(this._map.spatialReference),e.addPath([t,this.inputPoints[0]]),t=this._densifyGeometry(e),this.tempGraphic.setGeometry(this.tempGraphic.geometry.addPath(t.paths[0])))},_measureAreaDblClickHandler:function(e){i.disconnect(this.mouseMoveMapHandler),this.mouseMoveMapHandler=null,e=new E(this._map.spatialReference);var t=[],n;for(n=0;n<this.inputPoints.length;n++)t.push([this.inputPoints[n].x,this.inputPoints[n].y]);t.push([this.inputPoints[0].x,this.inputPoints[0].y]),e.addRing(t),this.inputPoints=[],this.measurementGeometry=this._densifyGeometry(e),this._getArea(e)},_getArea:function(e){var t=[],i=new x;i.areaUnit=N.UNIT_ACRES,i.calculationType="geodesic",E.prototype.isSelfIntersecting(e)?this._geometryService.simplify([e],n.hitch(this,function(e){r.forEach(e,n.hitch(this,function(n,r){"PCS"===this._map.cs?(i.polygons=e,this._geometryService.areasAndLengths(i)):("Web Mercator"===this._map.cs&&(n=y.webMercatorToGeographic(n)),t.push(n))}));var s=g.geodesicAreas(t,O.ACRES);this._showArea(s[0])})):("Web Mercator"===this._map.cs&&(e=y.webMercatorToGeographic(e)),t.push(e),"PCS"===this._map.cs?(i.polygons=t,this._geometryService.areasAndLengths(i)):(e=g.geodesicAreas(t,O.ACRES),this._showArea(Math.abs(e[0]))))},_outputArea:function(e){this._showArea(Math.abs(e.areas[0]))},_showArea:function(e){e&&(this.result=e,e=c.byNode(this.unit.domNode).label,this._outputResult(this.result,e)),this.onMeasureEnd(this.activeTool,this.measurementGeometry)},_measureDistanceDblClickHandler:function(e){i.disconnect(this.mouseMoveMapHandler),this.mouseMoveMapHandler=null,e=new w(this._map.spatialReference),e.addPath(this.inputPoints),e=this._densifyGeometry(e);if("PCS"===this._map.cs){var t=new T;t.polylines=[e],t.lengthUnit=9093,t.calculationType="geodesic",this._geometryService.lengths(t,n.hitch(this,function(e){this.result=e.lengths[0],this._showDistance(this.result)}))}this.inputPoints=[],this.onMeasureEnd(this.activeTool,e)},_measureDistanceMouseClickHandler:function(e){var t;this._map.snappingManager&&(t=this._map.snappingManager._snappingPoint),e=t||e.mapPoint,this.inputPoints.push(e),this._currentStartPt=e;if(1===this.inputPoints.length){for(t=0;t<this.measureGraphics.length;t++)this._map.graphics.remove(this.measureGraphics[t]);this._map.graphics.remove(this.tempGraphic),this.measureGraphics=[],this.result=0,this._outputResult(this.result,P.widgets.measurement.NLS_length_miles),this.tempGraphic=new S,this.tempGraphic.setSymbol(this._lineSymbol),this._map.graphics.add(this.tempGraphic),this.mouseMoveMapHandler=i.connect(this._map,"onMouseMove",this,"_measureDistanceMouseMoveHandler")}this.tempGraphic.setGeometry(new w(this._map.spatialReference)),this.flagGraphic=new S,this.flagGraphic.setSymbol(this._pointSymbol),this.flagGraphic.setGeometry(e),this.measureGraphics.push(this.flagGraphic),this._map.graphics.add(this.flagGraphic),1<this.inputPoints.length&&(this.measureGraphic=new S,this.measureGraphic.setSymbol(this._lineSymbol),this.measureGraphics.push(this.measureGraphic),t=new w(this._map.spatialReference),t.addPath([this.inputPoints[this.inputPoints.length-2],e]),t=this._densifyGeometry(t),this.measureGraphic.setGeometry(t),this._map.graphics.add(this.measureGraphic),this.result+=this._geodesicDistance(this.inputPoints[this.inputPoints.length-2],e),this._showDistance(this.result))},_measureDistanceMouseMoveHandler:function(e){if(0<this.inputPoints.length){var t=new w(this._map.spatialReference),n;this._map.snappingManager&&(n=this._map.snappingManager._snappingPoint),e=n||e.mapPoint,t.addPath([this._currentStartPt,e]),t=this._densifyGeometry(t),this.tempGraphic.setGeometry(t),t=this._geodesicDistance(this._currentStartPt,e),this._showDistance(t+this.result)}},_geodesicDistance:function(e,t){var n=new w(this._map.spatialReference);return"PCS"===this._map.cs&&(e=this._getGCSLocation(e),t=this._getGCSLocation(t)),n.addPath([e,t]),"Web Mercator"===this._map.cs&&(n=y.webMercatorToGeographic(n)),g.geodesicLengths([n],O.MILES)[0]},_showDistance:function(e){e&&this._outputResult(e,c.byNode(this.unit.domNode).label)},_measureLocationClickHandler:function(e){c.byNode(this.location.domNode).setAttribute("checked",!1);var t;this._map.snappingManager&&(t=this._map.snappingManager._snappingPoint),e=t||e.mapPoint,this.locationToggleButton(),this.locationGraphic=new S,this.locationGraphic.setGeometry(e),this.locationGraphic.setSymbol(this._pointSymbol),this._map.graphics.add(this.locationGraphic),this.measureGraphics.push(this.locationGraphic),t={mapPoint:e},"PCS"===this._map.cs?this._showCoordinates(t,!0):this._showCoordinates(t),this.onMeasureEnd(this.activeTool,e)},_getGCSLocation:function(e){if("Web Mercator"===this._map.cs)e=y.webMercatorToGeographic(e);else if("PCS"===this._map.cs&&this._map._newExtent){var t=Math.abs((this._map._newExtent.xmax-this._map._newExtent.xmin)/(this._map.extent.xmax-this._map.extent.xmin)),n=Math.abs((this._map._newExtent.ymax-this._map._newExtent.ymin)/(this._map.extent.ymax-this._map.extent.ymin));e=new b((e.x-this._map.extent.xmin)*t+this._map._newExtent.xmin,(e.y-this._map.extent.ymin)*n+this._map._newExtent.ymin,this._map.spatialReference)}return e},_projectMapExtent:function(e){e=new S(e);var t=new d({wkid:4326});this._geometryService.project([e.geometry],t,n.hitch(this,function(e){!this.mouseMoveMapHandler&&"location"===this.activeTool&&(this.mouseMoveMapHandler=i.connect(this._map,"onMouseMove",n.hitch(this,this._showCoordinates)),this.mouseDragMapHandler=i.connect(this._map,"onMouseDrag",n.hitch(this,function(){c.byNode(this.resultValue.domNode).setAttribute("disabled",!0)}))),this._map._newExtent=e[0]}))},_showCoordinates:function(e,t){var r;this._map.snappingManager&&(r=this._map.snappingManager._snappingPoint),r=r||e.mapPoint;var i;if(t){var s=new d({wkid:4326});this._geometryService.project([r],s,n.hitch(this,function(e){i=e[0],this.locationX=i.x,this.locationY=i.y,this._outputLocationResult(i.x,i.y,c.byNode(this.unit.domNode).label)}))}else i=this._getGCSLocation(r),this.locationX=i.x,this.locationY=i.y,this._outputLocationResult(i.x,i.y,c.byNode(this.unit.domNode).label)},_checkCS:function(e){if(e.wkid)return 3857===e.wkid||102100===e.wkid||102113===e.wkid?"Web Mercator":A.isDefined(M[e.wkid])?"PCS":"GCS";if(e.wkt)return-1!==e.wkt.indexOf("WGS_1984_Web_Mercator")?"Web Mercator":0===e.wkt.indexOf("PROJCS")?"PCS":"GCS"},_switchUnit:function(e){c.byNode(this.unit.domNode).setAttribute("label",e),null!==this.result&&this._outputResult(this.result,e)},_outputResult:function(e,t){var n=e*this.unitDictionary[t];0===n?c.byNode(this.resultValue.domNode).setAttribute("content",""):1e6<n?c.byNode(this.resultValue.domNode).setAttribute("content",u.format(n.toPrecision(9),{pattern:this.numberPattern})+" "+t):c.byNode(this.resultValue.domNode).setAttribute("content",u.format(n.toFixed(2),{pattern:this.numberPattern})+" "+t)},_switchLocationUnit:function(e){c.byNode(this.unit.domNode).setAttribute("label",e),null===this.result||""===this.resultValue.domNode.innerHTML||this._outputLocationResult(this.locationX,this.locationY,e)},_outputLocationResult:function(e,t,n){var r,i,s=P.widgets.measurement;n===s.NLS_decimal_degrees?(r=e.toFixed(6),i=t.toFixed(6)):n===s.NLS_deg_min_sec&&(s=n=!1,0>e&&(n=!0,e=Math.abs(e)),0>t&&(s=!0,t=Math.abs(t)),r=Math.floor(e)+""+Math.floor(60*(e-Math.floor(e)))+"'"+Math.floor(60*(60*(e-Math.floor(e))-Math.floor(60*(e-Math.floor(e)))))+'"',i=Math.floor(t)+""+Math.floor(60*(t-Math.floor(t)))+"'"+Math.floor(60*(60*(t-Math.floor(t))-Math.floor(60*(t-Math.floor(t)))))+'"',n&&(r="-"+r),s&&(i="-"+i)),c.byNode(this.resultValue.domNode).setAttribute("content",P.widgets.measurement.NLS_longitude+": "+r+"<br/>"+P.widgets.measurement.NLS_latitude+": "+i)},_createLengthUnitList:function(){var e=new h({style:"display: none;"}),t=P.widgets.measurement;r.forEach([t.NLS_length_miles,t.NLS_length_kilometers,t.NLS_length_feet,t.NLS_length_meters,t.NLS_length_yards,t.NLS_length_nautical_miles],n.hitch(this,function(t,r){var i=new p({label:t,onClick:n.hitch(this,function(){this._switchUnit(t)})});i.setAttribute("class","unitDropDown"),e.addChild(i)})),c.byNode(this.unit.domNode).setAttribute("dropDown",e),t=this.units[this._defaultLengthUnit],c.byNode(this.unit.domNode).setAttribute("label",t)},_createAreaUnitList:function(){var e=new h({style:"display: none;"}),t=P.widgets.measurement;r.forEach([t.NLS_area_acres,t.NLS_area_sq_miles,t.NLS_area_sq_kilometers,t.NLS_area_hectares,t.NLS_area_sq_yards,t.NLS_area_sq_feet,t.NLS_area_sq_meters],n.hitch(this,function(t,r){var i=new p({label:t,onClick:n.hitch(this,function(){this._switchUnit(t)})});i.setAttribute("class","unitDropDown"),e.addChild(i)})),c.byNode(this.unit.domNode).setAttribute("dropDown",e),t=this.units[this._defaultAreaUnit],c.byNode(this.unit.domNode).setAttribute("label",t)},_createLocationUnitList:function(){var e=new h({style:"display: none;"}),t=P.widgets.measurement;r.forEach([t.NLS_decimal_degrees,t.NLS_deg_min_sec],n.hitch(this,function(t,r){var i=new p({label:t,onClick:n.hitch(this,function(){this._switchLocationUnit(t)})});i.setAttribute("class","unitDropDown"),e.addChild(i)})),c.byNode(this.unit.domNode).setAttribute("dropDown",e),t=this.units[this._defaultLocationUnit],c.byNode(this.unit.domNode).setAttribute("label",t)}}),o("extend-esri")&&n.setObject("dijit.Measurement",t,C),t}),define("modules/measuretool.js",["esri/dijit/Measurement","dojo/aspect","dojo/dom-class","dojo/on","modules/tools.js","modules/featureevents.js"],function(e,t,n,r,i,s){return function(o,u,a,f){f=f?f:{};var l,c,h={},p=f.map||window.esri.map,d=f.eventFeatures||[],v={init:function(f){var m=document,g=m.createElement("div");g.id="measur",m.body.appendChild(g),l=new e({map:p,lineSymbol:u,pointSymbol:a,defaultLengthUnit:esri.Units.FEET,defaultAreaUnit:esri.Units.SQUARE_MILES},g),l.startup(),g=m.getElementById("measur"),n.add(g,"atop selectable"),i.toggle(f,v),r(o,"mousedown",function(e){i.toggle(e,v)}),t.after(l,"setTool",function(e,t){t!==!1&&(c=e,h[e]&&l._switchUnit(h[e]),s.disable(d),n.contains(o,"idle")&&(n.replace(o,"activeTool","idle"),v.revive()))},!0),t.after(l,"_switchUnit",function(e){c&&(h[c]=e)},!0)},start:function(){l.show()},idle:function(){s.enable(d),c&&l.setTool(c,!1)},revive:function(){c&&l.setTool(c,!0)},stop:function(){this.idle(),l.clearResult(),c=null,l.hide()}};return v}}),define("modules/tooltip.js",["require"],function(e){var t=window,n=document,r,i=n.all&&n.addEventListener&&!window.atob?!0:!1;return i&&(r=e("dojo/_base/fx",function(e){return e})),function s(e,n){n=n||{};var o=e.style,u=n.offsetX||-110,a=n.offsetY||30,f=n.duration||2e3,l=n.transition||100,c="opacity "+l/1e3+"s ease";return o["-webkit-transition"]=c,o["-moz-transition"]=c,o["-o-transition"]=c,o.transition=c,s.displayTimeout=function(){e.style.display="none"},s.timeout=function(){o.opacity=0,s.currTimeouts[1]=t.setTimeout(s.displayTimeout,l)},s.ieTimeout=function(){r.animateProperty({node:e,duration:l+50,properties:{opacity:0},onEnd:s.displayTimeout}).play()},s.currTimeouts=[],function(n){t.clearTimeout(s.currTimeouts[0]);var l=n.pageX-n.offsetX+u+"px",c=n.pageY-n.offsetY+a+"px";o.display="none",o.top=c,o.left=l,o.display="block",i?(r.animateProperty({node:e,duration:75,properties:{opacity:1}}).play(),s.currTimeouts[0]=t.setTimeout(s.ieTimeOut,f)):(t.clearTimeout(s.currTimeouts[1]),o.opacity=1,s.currTimeouts[0]=t.setTimeout(s.timeout,f))}}}),define("modules/getdate.js",[],function(){return function(e){var t=new Date(e),n=t.toUTCString();return n=n.charAt(6)===" "?n.substring(0,5)+"0"+n.substring(5):n,n.slice(12,16)+"-"+(1+t.getUTCMonth()<10?"0"+(1+t.getUTCMonth()):1+t.getUTCMonth())+"-"+n.slice(5,7)}}),define("modules/gridcategory.js",["dojo/dom-class"],function(e){var t=0;return function(n,r,i,s,o,u){function b(){e.remove(a,"gridToggleX");for(var t=0,n=r.length;t<n;t++){var i=r[t].OBJECTID,s=E(i);h[i]&&e.add(s,"hiddenGridToggle")}c=!1}function w(t){if(!c){e.add(a,"gridToggleX");for(var n=0,i=r.length;n<i;n++){var s=r[n].OBJECTID,o=E(s);h[s]&&e.remove(o,"hiddenGridToggle")}c=!0}}function E(e){return f.firstChild.childNodes[u[e-1]]}function S(t){h[t]&&e.add(a,"gridHighlight")}function x(t){h[t]&&e.remove(a,"gridHighlight")}function T(){a=f.getElementsByClassName("gridToggle")[l]}function N(){return a.parentNode.parentNode.parentNode}var a,f=o.childNodes[1],l=t++,c=!0,h={},p=document.getElementById(o.id+"-row-"+l),d=p.firstChild.firstChild,v=d.firstChild;d.removeChild(d.childNodes[3]),d.removeChild(d.childNodes[1]),e.add(v,"gridToggle"),e.remove(v,"dgrid-cell"),T();for(var m=0,g=r.length;m<g;m++){var y=r[m];y[i].slice(0,9)===s&&(h[y.OBJECTID]=1)}return b(v),n.on(".gridToggle:mousedown",function(e){c?b():w()}),{addHighlight:S,removeHighlight:x,setNode:T,getRow:N}}}),require(["dijit/layout/BorderContainer","dijit/layout/ContentPane","dgrid/Grid","dgrid/editor","dgrid/extensions/ColumnResizer","dojo/_base/declare","dojo/parser","dojo/dom-construct","dojo/dom","dojo/query","dojo/dom-class","dojo/on","dojo/ready","dojo/aspect","dojo/_base/Color","dojo/has","esri/map","esri/SpatialReference","esri/geometry/Extent","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/tasks/geometry","esri/dijit/TimeSlider","esri/TimeExtent","esri/dijit/Scalebar","esri/renderers/SimpleRenderer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/geometry/Point","modules/tools.js","modules/popup.js","modules/crosstool.js","modules/identtool.js","modules/measuretool.js","modules/clearnode.js","modules/tooltip.js","modules/getdate.js","modules/gridcategory.js","require"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q){var R=0;h(function(){function Sn(e,t,n){var r=Mn.prevArr.indexOf(e);Dn(e,"",1),dn[e]?(dn[e]=0,n&&r>-1&&Gn(Mn.prevArr,r),Zt--,t&&Gn(Yt,Yt.indexOf(e))):console.log("NOT STORED")}function xn(e){dn[e]||(dn[e]=1,Yt[Zt]=e,Zt++)}function Tn(){for(var e=0,t=Zt;e<t;e++)Sn(Yt[e],0,0);Yt.length=0,Mn.prevArr.length=0}function Nn(e,t){Tn(),xn(e),Mn.prevArr.length=1,Mn.prevArr[0]=e,Dn(e,"hi",1),it(t)}function An(e){pt.setExtent(e)}function Mn(t,n){var r=Date.now(),i=0,s=Mn.binLength-1,o,u,a,f,l=Mn.prevArr,c=Mn.currArr,h,p,d,v,m=0;if(t===null)v=Mn.lastMouseBin;else{h=t.mapPoint.x,p=t.mapPoint.y,d=h+1e3;for(;i<s;i++)if(h<Gt[i+1])break;v=Qt[i]||Qt[i-1],Mn.lastMouseBin=v,i=0}n&&v!==Mn.lastClickBin&&(Tn(),Mn.lastClickBin=v),v?s=v.length:s=0;for(;i<s;i++){o=v[i],u=o.oid;if(o.xmin>d&&!n)break;if(bn[u])if(o.xmax>=h&&o.xmin<=h&&o.ymin<=p&&o.ymax>=p)m=1,Dn(u,"hi",1),Wt&&(pt.setMapCursor("pointer"),Wt=0),n&&(c.push(u),dn[u]||xn(u));else{if(dn[u]){n&&Sn(u,1,0);continue}Dn(u,"",1)}}n&&m&&(l.length===c.length&&e.JSON.stringify(l)===e.JSON.stringify(c)?(Tn(),Mn.currArr.length=0):(a=l,Mn.prevArr=c,a.length=0,Mn.currArr=a),it(null));if(!m&&n&&l)for(var i=0;i<l.length;i++)Dn(l[i],"hi",1),dn[l[i]]||xn(l[i]);v=null}function _n(){console.log("redrawing");for(var e=1;e<Nt;e++)bn[e]&&(dn[e]?Dn(e,"hi",0):Dn(e,"",0))}function Dn(e,t,n){if(n&&(t&&vn[e]||!t&&!vn[e]))return;var r=wt?kn:Ln,i,s=Hn(e),o;if(!s)return;i=Tt[e-1].attributes.Date,color=Pn(i),n&&(o=Ot.oidToRow(e),t!==""?(l.add(o,"highl"+color),vn[e]=1):(l.remove(o,"highl"+color),vn[e]=0)),an>12&&(t?t="":color+="thin"),s.setSymbol(r[color+t])}function Pn(e){if(e<129384e7)return"gre";if(e<1325376e6)return"mag";if(e<13570272e5)return"blu";if(e<13885632e5)return"red";if(e<14200992e5)return"bro"}function Hn(e){return dt.graphics[e-1]}function Bn(e){var t=e.target.parentNode;if(t.children[2])return+t.children[2].innerHTML;if(e.target.className=="dgrid-input")return+t.parentNode.children[2].innerHTML}function jn(e){return Ot.oidToRow(e).firstChild.firstChild.children[3].firstChild}function Fn(){M=t.createElement("div"),W=t.createElement("div"),i?(M.id="gridView",W.id="dataView",M.innerHTML='<div id="gridNode"></div>'):(M.id="lP",W.id="rP",W.className="mov atop",M.innerHTML='<div id="gridNode"></div><div id="lPSplitter"><div class="splitterThumb"></div></div>'),W.innerHTML='<div id="dataCon"><div id="dataNode"></div><div id="downloadNode"><strong id="dlTitle">Downloads:</strong><a class="lrp" href="zips/Metadata.zip" target="_self">Metadata</a><a class="lrp" id="dlLink" href="tryagain.zip" target="_self">Dataset</a></div></div><div id="infopane"></div><div id="foot" class="unselectable"><div class="footDiv">Help</div><div class="footDiv">Terms of Use</div><div class="footDiv">Contact</div></div>',p.appendChild(M),p.appendChild(W),Wn(),Vn(),i?Un():(Xn(),Rn())}function In(){if(i){var e=t.createElement("div"),n=t.createElement("div"),r=o/2;e.id="dataTab",n.id="gridTab",e.className="atop unselectable",n.className="atop unselectable",e.innerHTML='<strong class="sideways">Info</strong>',n.innerHTML='<strong class="sideways">Grid</strong>',e.style.top=r-100+"px",n.style.top=r-100+"px",p.appendChild(e),p.appendChild(n)}else{var s=t.createElement("div");s.id="closeRp",s.className="mov atop unselectable",s.innerHTML='<div id="arro"></div>',p.appendChild(s);var u=t.createElement("img");u.id="legend",u.className="legend atop",u.title="Image Legend (NAVD88 ft)",u.src="",t.body.appendChild(u)}}function qn(){function e(e){var t=e.target;t.tagName==="STRONG"&&(t=t.parentNode);var n=+t.getAttribute("data-oid");t.style.cursor="default",Nn(n,Lt.graphics[n-1].attributes)}i?c(V,".multiSelect:touchstart",e):c(V,".multiSelect:mousedown",e)}function Rn(){function o(){var e=0,n=t.length;i=1,r.style.backgroundPosition="-32px -16px";if(s)for(;e<n;e++)t[e]===W?kt.animateProperty({node:t[e],duration:300,properties:{marginRight:0}}).play():kt.animateProperty({node:t[e],duration:300,properties:{marginRight:285}}).play();else for(;e<n;e++)l.add(t[e],"movd")}function u(){var e=0,n=t.length;i=0,J.style.display="none",r.style.backgroundPosition="-96px -16px";if(s)for(;e<n;e++)t[e]===W?kt.animateProperty({node:t[e],duration:250,properties:{marginRight:-285}}).play():kt.animateProperty({node:t[e],duration:250,properties:{marginRight:0}}).play();else for(;e<n;e++)l.remove(t[e],"movd")}function h(){u(),Tn()}function p(){V.style.marginTop=0,B(V),V.innerHTML=st,e.setTimeout(o,0)}function d(t,n){if(Zt===0){h();return}if(i)if(s){var r={node:X,duration:150,properties:{opacity:0},onEnd:function(){t(n),kt.fadeIn({node:X}).play()}};kt.animateProperty(r).play()}else V.style.opacity=0,J.style.opacity=0,e.setTimeout(function(){t(n),V.style.opacity=1,J.style.opacity=1},125);else t(n),o()}function v(){i?h():p()}var t=f(".mov"),n=a.byId("closeRp"),r=a.byId("arro"),i=0;c(n,"mousedown",v),it=zn(d),e.setTimeout(p,300)}function Un(){function m(){if(Zt===0){g(),y();return}if(glowing)return;l.add(e,"tabglow")}function g(){l.remove(e,"tabglow")}function y(){e.firstElementChild.innerText="Info",B(V),V.innerHTML=st}function b(t,n){if(s&&Zt===0)return y(),E(W);e.firstElementChild.innerText="Data",t(n);if(r&&!s)return;w(W,f),i=1,s=1}function w(e,t,r){e.style.cssText=r,e.style.zIndex=++n,l.add(t,"tabglow")}function E(e,t){e.style.cssText=d,l.remove(t,"tabglow"),setTimeout(function(){n--,e.style.zIndex=1e3},155)}function S(){i&&s?(E(W,e),i=0,s=0):(w(W,e,f),i=1,s=1)}function x(){r&&!s?(E(M,t),r=0,i?s=1:n=1e3):(w(M,t,p),r=1,s=0)}var e=a.byId("dataTab"),t=a.byId("gridTab"),n=1e3,r=0,i=0,s=0,o="translate3d("+h+"px,0,0);",u="translate3d(-"+h+"px,0,0);",f="-webkit-transform:"+o+"transform:"+o,p="-webkit-transform:"+u+"transform:"+u,d="-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);z-index:9999",v;c(e,"touchstart",S),c(t,"touchstart",x),it=zn(b),y()}function zn(e){function t(t){e(i,t)}function r(e){switch(e.Project.slice(0,2)){case"GL":return"Grant Line Canal";case"OR":return"Old River";case"DC":return"Doughty Cut"}}function i(e){if(!e)if(Zt===1){var t=Yt[0];s(Lt.graphics[t-1].attributes,t-1)}else{var n="<h2>"+Zt+" projects selected</h2><div id='multiSelectWrapper'>",r=0,i=0;while(r<Zt)dn[i]===1&&(n+="<span class='multiSelect' data-oid='"+i+"'><strong>"+yn[i-1]+": </strong>"+gn[i-1]+"</span><br/>",r++),i++;n+="</div>",J.style.display="none",V.style.marginTop=Rt/2-65+"px",V.innerHTML=n}else e&&e.Project&&s(e,e.OBJECTID-1)}function s(e,t){V.style.marginTop="0",V.innerHTML="<h2>"+yn[t]+"</h2>"+"<span class = 'spirp'><strong>Collection Date: </strong>"+gn[t]+"</span>"+"<span class = 'spirp'><strong>Client: </strong>"+(e.Client||"Groundwater Supply Assessment Section, DWR")+"</span>"+"<span class = 'spirp'><strong>Waterways Covered: </strong>"+(e.Waterways||r(e))+"</span>"+"<span class = 'spirp'><strong>Purpose: </strong>"+(e.Purpose||n)+"</span>",J.style.display="block"}var n="Data was collected to determine the sediment impacts of the agricultural barriers at Middle River, Grant Line Canal, and Old River near the Delta Mendota Canal. Measurements have been made since 1998 at nineteen stations. Multibeam/RTK bathymetry has been gathered since 2011. Four stations have monthly data, the rest are visited in the Fall and Spring.";return t}function Wn(){X=a.byId("dataCon"),V=a.byId("dataNode"),J=a.byId("downloadNode"),$=a.byId("dlLink"),U=a.byId("gridNode"),z=a.byId("lPSplitter"),K=a.byId("cros"),Q=a.byId("ident"),G=a.byId("mea"),Y=a.byId("noClick"),Z=a.byId("mapDiv_zoom_slider"),et=a.byId("fex"),tt=a.byId("topo"),nt=a.byId("sat"),rt=a.byId("timeDiv")}function Xn(){var e=M.clientWidth+6;s?S.style.left=e+"px":(S.style["-webkit-transform"]="translate3d("+e+"px,0, 0)",S.style.transform="translate3d("+e+"px,0, 0)"),S.style.width=h-e+"px"}function Vn(){i?$n(o/2-32):(W.style.height=o-225+"px",$n(o-257))}function $n(e){X.style.height=e+"px"}function Jn(){var e=h,t=Jn.appTitle=Jn.appTitle?Jn.appTitle:a.byId("appTitle");e<600&&Jn.fullText!==0?(t.innerHTML="Bathymetry",t.style.width="175px",Jn.fullText=0):e>599&&Jn.fullText===0&&(t.style.width="380px",t.innerHTML="Delta Bathymetry Catalog",Jn.fullText=1)}function Kn(){return i?Rt=o-32:Rt=o-257,Rt}function Qn(e){return!isNaN(parseFloat(e))&&isFinite(e)}function Gn(e,t){var n=e.length-1;return e[t]=e[n],e.length=n,e}function Yn(){Ht=null}var e=window,t=document,i=v("touch"),s=document.all&&document.addEventListener&&!window.atob?!0:!1,o=e.innerHeight,h=e.innerWidth,p=a.byId("mainWindow"),S=a.byId("mapDiv"),M,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st="<p>The <strong>Delta Bathymetry Catalog</strong> houses the complete set of multibeam bathymetric data collected by the Bathymetry and Technical Support section of the California Department of Water Resources.</p><p>Click on a feature in the map or table to bring up its <strong>description</strong>. Double-click to view the <strong>raster image</strong>.</p> <p><strong>Download</strong> data as text files from the descrption pane.</p> <p><strong>Measure</strong> distances, <strong>identify</strong> raster elevations, and draw <strong>profile graphs</strong> with the tools at the top-right.</p> <p>Change what displays by <strong>collection date</strong> with the slider at bottom-right. <strong>Sort</strong> by date and name with the table's column headers.</p> <p>See the <strong>help</strong> below for further information.</p>";In(),Fn(),Jn(),s&&(kt=q("dojo/_base/fx",function(e){return e})),t.body.style.visibility="visible",esri.config.defaults.io.corsDetection=!1,esri.config.defaults.io.corsEnabledServers.push("mrsbmapp00642"),esri.config.defaults.geometryService=new esri.tasks.GeometryService("http://sampleserver3.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer");var ot="http://mrsbmapp00642/ArcGIS/rest/services/BATH/Web_Rr/MapServer",ut="http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",at,ft=new g(102100),lt=new y(-13612e3,4519e3,-13405e3,4662600,ft),ct,ht=o>940?11:o>475?10:9;i?ct=new O({x:-13528681.36062705,y:4583780.268055417,spatialReference:ft}):ct=new O({x:-13523942.264873397,y:4586455.564045421,spatialReference:ft});var pt=new m(S,{extent:lt,center:ct,zoom:ht}),dt,vt=k.STYLE_SOLID,mt=L.STYLE_SOLID,gt=new L(mt,new k(vt,new d([255,255,255,.001]),1),new d([0,0,0,.001])),yt=new E(ut),bt=new w(ot,{id:"raster"}),wt=1,Et=0;window.map=pt,pt.addLayer(yt),bt.setVisibleLayers([-1]);var St={geometryType:"esriGeometryPolygon",spatialReference:ft,displayFieldName:"OBJECTID",fields:[{name:"OBJECTID",type:"esriFieldTypeOID"},{name:"Project",type:"esriFieldTypeString"},{name:"Date",type:"esriFieldTypeDate"},{name:"Waterways",type:"esriFieldTypeString"},{name:"Method",type:"esriFieldTypeString"},{name:"Client",type:"esriFieldTypeString"},{name:"Purpose",type:"esriFieldTypeString"}]};window.tiout=dt=new b({featureSet:window.TIGHT_OUTLINES,layerDefinition:{geometryType:"esriGeometryPolygon",spatialReference:ft,displayFieldName:"Shape_Length",fields:[{name:"OBJECTID",type:"esriFieldTypeOID"}]}},{id:"tiout",mode:b.MODE_SNAPSHOT}),dt.setRenderer(new C(gt)),pt.addLayer(dt),dt.on("graphic-node-add",function(e){if(bn[e.graphic.attributes.OBJECTID])return;e.node.setAttribute("class","hiddenPath")});var xt=window.DATA_OUTLINES,Tt=xt.features,Nt=Tt.length,Ct=!!document.all,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt=!1,jt=0,Ft,It,qt,Rt=Kn(),Ut,zt,Wt=1,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt=[],Zt=0,en,tn=[],nn,rn,sn,un,an=8,fn,ln=0,cn=0,hn=new Array(Nt),pn=new Array(Nt),dn=new Array(Nt+1),vn=new Array(Nt+1),mn=new Array(Nt),gn=new Array(Nt),yn=new Array(Nt),bn=new Array(Nt+1),wn={};Lt=new b({layerDefinition:St,featureSet:xt},{id:"out",mode:b.MODE_SNAPSHOT,outFields:["*"]}),Lt.setRenderer(new C(gt)),pt.addLayer(Lt),tn.push(Lt),zt=new E("http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"),pt.addLayer(zt),zt.hide();var En=function(){function p(e){l.add(e,"tsHighlight")}function d(e){l.remove(e,"tsHighlight")}function v(e){var t=e.target.innerHTML;t.charAt(0)==="A"?at.setThumbIndexes([0,at.timeStops.length]):at.setThumbIndexes([6*(t-2010),6*(t-2010)+6])}function m(){Et?(l.add(Xt,"whiteScaleLabels"),l.add(labelCon,"satLabels")):(l.remove(Xt,"whiteScaleLabels"),l.remove(labelCon,"satLabels"))}new N({map:pt}),Xt=f(".esriScalebar")[0];var e,n=new T(new Date("01/01/2010 UTC"),new Date("12/31/2014 UTC"));pt.setTimeExtent(n),at=new x({style:"width:300px;",id:"timeSlider",intermediateChanges:!0},u.create("div",null,rt)),at.setThumbCount(2),at.createTimeStopsByTimeInterval(n,2,"esriTimeUnitsMonths"),e=at.timeStops.length,at.setThumbIndexes([0,e]),at.setTickCount(Math.ceil(e/2)),at.startup(),pt.setTimeSlider(at),labelCon=t.createElement("div");var r=at.fullTimeExtent.endTime.getFullYear()+1,s,o=[];labelCon.className="labelCon atop",i&&(labelCon.className+=" labelTouch",rt.style.display="none");for(var a=2010;a<=r;a++){var h=t.createElement("div");o.push(h),h.className="tsLabel",a===r?(h.innerText="All",s=h):h.innerText=a,labelCon.appendChild(h)}return S.appendChild(labelCon),p(s),i?c(labelCon,".tsLabel:touchstart",function(e){d(s),s=e.target,p(s),setTimeout(function(){v(e)},0)}):(c(labelCon,".tsLabel:mouseover",function(e){e.target!==s&&p(e.target)}),c(labelCon,".tsLabel:mouseout",function(e){e.target!==s&&d(e.target)}),c(labelCon,".tsLabel:mousedown",function(e){d(s),s=e.target,v(e)})),m(),m}();(function(){var e,t,n,r="Soil Sed. ";for(var i=0;i<Nt;i++)e=Tt[i].attributes,hn[i]=i,pn[i]=t=i+1,dn[i]=0,vn[i]=0,bn[i]=1,wn[t]=0,gn[i]=F(e.Date),yn[i]=e.Project.length<6?r+e.Project:e.Project})(),vn[Nt]=0,dn[Nt]=0,bn[Nt]=1,window.oidStore=dn,function(){for(var e=0;e<Nt;e++){var t={};featureAttr=Tt[e].attributes,t.__Date=featureAttr.Date,t.Date=gn[e],t.Project=yn[e],t.OBJECTID=featureAttr.OBJECTID,mn[e]=t}}(),function(){var e=0,t=Lt.graphics,n=t.length,r,i,s,o;Kt=new Array(n),Gt=new Array(Math.ceil(n/10)),Qt=new Array(Gt.length);for(;e<n;e++)r=t[e]._extent,Kt[e]={oid:t[e].attributes.OBJECTID,xmin:r.xmin,xmax:r.xmax,ymin:r.ymin,ymax:r.ymax};Kt.sort(function(e,t){return e.xmin-t.xmin});for(i=0,s=Gt.length-1;i<s;i++)Gt[i]=Kt[i*n/10>>0].xmin,Qt[i]=[];Gt[s]=Kt[n-1].xmin;for(e=0;e<n;e++){o=Kt[e];for(i=0;i<s;i++)o.xmin<=Gt[i+1]&&o.xmax>=Gt[i]&&Qt[i].push(o)}}(),console.log("grid"),Ot=function(){function E(e,t){return e.__Date-t.__Date}function S(e,t){return t.__Date-e.__Date}function x(e,t){return e.Project===t.Project?E(e,t):e.Project>t.Project?1:-1}function T(e,t){return e.Project===t.Project?E(e,t):e.Project>t.Project?-1:1}function N(e,n,r){var i=0,s=n.length,u,a=r.children,f,l,c=t.createDocumentFragment(),h=Ut.getRow().id,p=n.shift();n.sort(e),n.unshift(p);for(var i=0,s=n.length;i<s;i++)f=n[i].OBJECTID-1,l=a[v[f]].cloneNode(!0),c.appendChild(l),v[f]=i;u=r.cloneNode(!1),u.appendChild(c),r.parentNode.replaceChild(u,o),o=u,c=null,Ut.setNode()}function C(e){return o.children[v[e-1]]}function k(e){var t=C(e),n=t.offsetTop;if(!n&&(l.contains(t,"hiddenRow")||l.contains(t,"hiddenGridToggle")))return;var r=Mt.scrollTop;if(n>Mt.clientHeight+r-55||n<r)Mt.scrollTop=n-95}function L(e){var t=+e.startTime,n=+e.endTime,r=bt.visibleLayers,i,s,o,u=mn,a=Zt,f,c=L.toBeHidden,p,d,v=L.rastersAsOIDs;for(var m=h,g=u.length;m<g;m++){s=u[m].OBJECTID;if(s===g)continue;d=Hn(s)._shape,d&&(o=d.rawNode),f=C(s),i=+u[m].__Date;if(i<t||i>n){l.add(f,"hiddenRow");if(pt.layerIds[2]){p=s-1,c.push(s);for(var y=1;y<r.length;y++)r[y]===p&&(Gn(r,y),y--)}bn[s]=0,d&&o.setAttribute("class","hiddenPath")}else bn[s]===0&&(l.remove(f,"hiddenRow"),bn[s]=1,d&&o.setAttribute("class",""))}if(pt.layerIds[2]){$(c);for(var m=1;m<r.length;m++)v.push(r[m]+1);W(v,0)}a!==Zt&&it(null),v.length=0,c.length=0}function A(){g=0,l.add(b[0],"sortTarget"),l.remove(b[1],"sortTarget"),Zt&&k(Yt[0])}function O(){m=0,l.add(b[1],"sortTarget"),l.remove(b[0],"sortTarget"),Zt&&k(Yt[0])}function _(){return m===0&&Zt>1?(N(x,mn,o),m=1,A(),!0):!1}function D(){m>0?(N(T,mn,o),m=-1):(N(x,mn,o),m=1),A()}function P(){g>0?(N(S,mn,o),g=-1):(N(E,mn,o),g=1),O()}function H(){var e=0;for(var t=1,n=hn.length;t<=n;t++)if(wn[t]){e=1;break}e?(W.reusableArray.length=0,W(W.reusableArray,0),J()):(W(pn,0),V(pn))}function B(t){u&&(e.requestAnimationFrame(function(){j(t)}),u=0)}function j(e){var t=e.x+"px";M.style.width=t,Xn(),u=1}function F(t){var n=t.target,r=Bn(t),i;if(!r)return;Dn(r,"hi",1),n!==Ht&&(window.clearTimeout(Pt),Ht=n,Pt=e.setTimeout(Yn,400),i=Lt.graphics[r-1].attributes,dn[r]&&Zt===1?(Sn(r,1,1),it(null)):Nn(r))}function q(e){var t,n=Bn(e);if(n){var r=Hn(n);if(!r)return;e.target.localName!=="div"&&(Nn(n),t=jn(n),An(r._extent.expand(1.3)),t.checked||(t.checked=!0,wn[n]=1,W.reusableArray[0]=n,W(W.reusableArray,0)))}}function R(e,t,n){var r=n.x,i=n.y,s=Hn(e)._extent;if(s.xmax>=r&&s.xmin<=r&&s.ymin<=i&&s.ymax>=i&&t>=14)return;var o=s.expand(1.3);o.xmax-o.xmin>R.xcutoff||o.ymax-o.ymin>R.ycutoff?An(o):(pt.setLevel(15),pt.centerAt(s.getCenter()))}function W(e,t){pt.layerIds[2]||(pt.addLayer(bt),i||(en.node.src="images/leg.png",en.show()));var n=bt,r=n.visibleLayers,s,o=r.length,u,a;e.length>1&&function(){for(var t=0,n=e.length;t<n;t++)bn[e[t]]&&r.indexOf(e[t]-1)===-1&&r.push(e[t]-1)}();if(e.length===1&&e[0]!==-1){a=e[0]-1;while(o--)if(a===r[o]&&t){u=r.splice(o,1)[0];break}a!==u&&r.push(a)}e.length===0&&(r=[-1]),n.setVisibleLayers(r),n.suspended&&(n.resume(),i||en.show()),r.length===1&&(n.suspend(),i||en.hide()),X(r)}function X(e){e.length>1?(l.replace(Q,"clickable","unclick"),l.replace(K,"clickable","unclick")):(l.replace(Q,"unclick","clickable"),l.replace(K,"unclick","clickable"))}function V(e){var t;for(var n=0,r=e.length;n<r;n++)bn[e[n]]&&(t=jn(e[n]),t.checked=!0,wn[e[n]]=1)}function $(e){var t;for(var n=0,r=e.length;n<r;n++)t=jn(e[n]),t.checked=!1,wn[e[n]]=0}function J(){var e=f(".dgrid-input",U);for(var t=0,n=e.length;t<n;t++)e[t].checked=!1,wn[t+1]=0}var s=Nt,o,u=1,h=0,p,d,v=new Array(mn.length+1),m=0,g=1,y,b;At=new n({bufferRows:Infinity,columns:{Project:{label:"Project",sortable:!1},Date:{label:"Date",sortable:!1},OBJECTID:{label:"OBJECTID"},Editor:r({field:"Image",sortable:!1},"checkbox"),__Date:{label:"_Date"}},cellNavigation:0},U),mn.unshift({__Date:1315008e6,Date:"Various",Project:"Soil Sedimentation",OBJECTID:mn.length+1}),At.renderArray(mn),console.log("OI"),y=a.byId("gridNode-header").firstChild,b=y.children,b[0].title="Sort by Name",b[1].title="Sort by Date",b[3].title="Turn images on or off",o=f(".dgrid-content")[0],Mt=f(".dgrid-scroller")[0],Mt.style.overflowY="scroll";for(var w=0,s=mn.length;w<s;w++)v[w]=w+1;return v[mn.length-1]=0,Ut=I(At,mn,"Project","Soil Sed.",U,v),h++,L.rastersAsOIDs=[],L.toBeHidden=[],at.on("time-extent-change",L),N(E,mn,o),l.add(b[1],"sortTarget"),R.xcutoff=6500,R.ycutoff=4500,W.reusableArray=[],c(At,".dgrid-input:change",function(e){var t=+e.target.parentNode.parentNode.children[2].innerHTML;wn[t]?wn[t]=0:(wn[t]=1,R(t,pt.getLevel(),pt.extent.getCenter())),W.reusableArray[0]=t,W(W.reusableArray,1)}),i||(At.on(".dgrid-cell:mousedown",F),At.on(".dgrid-cell:dblclick",q),At.on(".dgrid-cell:mouseover",function(e){var t=Bn(e);t&&Dn(t,"hi",1)}),At.on(".dgrid-cell:mouseout",function(e){var t=Bn(e);if(dn[t])return;Dn(t,"",1)}),c(b[0],"mousedown",D),c(b[1],"mousedown",P),c(b[3],"mousedown",H),c(z,"mousedown",function(t){M.style.minWidth=0;var n=c(e,"mousemove",B);c.once(e,"mouseup",function(e){pt.resize(),n.remove()})})),{timeUpdate:L,oidToRow:C,scrollToRow:k,setVisibleRasters:W,checkImageInputs:V,clickSort:_,expand:B,sedToggle:Ut}}(),console.log("post grid");var Cn=new d([0,0,0,0]),kn={grethin:new L(mt,new k(vt,new d([18,160,0]),.5),Cn),magthin:new L(mt,new k(vt,new d([221,4,178]),.5),Cn),bluthin:new L(mt,new k(vt,new d([50,84,255]),.5),Cn),redthin:new L(mt,new k(vt,new d([255,0,0]),.5),Cn),brothin:new L(mt,new k(vt,new d([112,84,59]),.5),Cn),gre:new L(mt,new k(vt,new d([18,160,0]),1.5),Cn),mag:new L(mt,new k(vt,new d([221,4,178]),1.5),Cn),blu:new L(mt,new k(vt,new d([50,84,255]),1.5),Cn),red:new L(mt,new k(vt,new d([255,0,0]),1.5),Cn),bro:new L(mt,new k(vt,new d([112,84,59]),1.5),Cn),grehi:new L(mt,new k(vt,new d([18,160,0]),4),Cn),maghi:new L(mt,new k(vt,new d([221,4,178]),4),Cn),bluhi:new L(mt,new k(vt,new d([50,84,255]),4),Cn),redhi:new L(mt,new k(vt,new d([255,0,0]),4),Cn),brohi:new L(mt,new k(vt,new d([112,84,59]),4),Cn)},Ln={magthin:new L(mt,new k(vt,new d([252,109,224]),1),Cn),bluthin:new L(mt,new k(vt,new d([119,173,255]),1),Cn),redthin:new L(mt,new k(vt,new d([243,63,51]),1),Cn),grethin:new L(mt,new k(vt,new d([24,211,48]),1),Cn),brothin:new L(mt,new k(vt,new d([169,152,137]),1),Cn),mag:new L(mt,new k(vt,new d([252,109,224]),1.5),Cn),blu:new L(mt,new k(vt,new d([119,173,255]),1.5),Cn),red:new L(mt,new k(vt,new d([243,63,51]),1.5),Cn),gre:new L(mt,new k(vt,new d([24,211,48]),1.5),Cn),bro:new L(mt,new k(vt,new d([169,152,137]),1.5),Cn),maghi:new L(mt,new k(vt,new d([252,109,224]),4),Cn),bluhi:new L(mt,new k(vt,new d([119,173,255]),4),Cn),redhi:new L(mt,new k(vt,new d([243,63,51]),4),Cn),grehi:new L(mt,new k(vt,new d([24,211,48]),4),Cn),brohi:new L(mt,new k(vt,new d([169,152,137]),4),Cn)};dt.on("update-end",function(e,t,n,r){console.log("update-end"),_n(dt.graphics)}),sn=function(){zt.show(),yt.hide(),Et=1,wt=0,l.remove(tt,"currentbmap"),l.add(nt,"currentbmap"),En(),_n(dt.graphics)},un=function(){yt.show(),zt.hide(),Et=0,wt=1,l.remove(nt,"currentbmap"),l.add(tt,"currentbmap"),En(),_n(dt.graphics)},basemapOff=function(){zt.hide(),yt.hide(),Et=0,wt=0,l.remove(nt,"currentbmap"),l.remove(tt,"currentbmap")},rn=function(e){var t=e.extent,n=e.level,r=0;n>17&&an<18&&wt&&sn();if(an>12&&n<13||an<13&&n>12)r=1;an=n,r&&_n(dt.graphics)},nn=pt.on("zoom-end",rn),c(tt,"mousedown",function(e){wt?basemapOff():un()}),c(nt,"mousedown",function(e){Et?basemapOff():sn()}),function(){function v(e){if(e.target.tagName==="B"){var t=e.target.textContent.slice(0,3);switch(t){case"Zoo":Z||(Z=a.byId("mapDiv_zoom_slider")),l.toggle(Z,"helpglow");break;case"Glo":l.toggle(a.byId("fex"),"helpglow");break;case"Bas":l.toggle(tt,"helpglow"),l.toggle(nt,"helpglow");break;case"Sli":l.toggle(z,"helpglow");break;case"Ide":l.toggle(Q,"helpglow");break;case"Pro":l.toggle(K,"helpglow");break;case"Mea":l.toggle(G,"helpglow");break;case"Tim":l.toggle(a.byId("timeSlider"),"helpglow")}}}function m(){p=0,B(u),h=0,u.style.borderTop="none"}function g(){p=e.setTimeout(m,205),s?(kt.animateProperty({node:u,duration:200,properties:{bottom:-210}}).play(),kt.animateProperty({node:X,duration:200,properties:{height:Rt}}).play()):($n(Rt),u.style["-webkit-transform"]="translate3d(0,0,0)",u.style.transform="translate3d(0,0,0)")}function y(){h=1,u.style.borderTop="2px solid #99ceff",s?(u.style.width=X.offsetWidth+16+"px",kt.animateProperty({node:u,duration:200,properties:{bottom:0}}).play(),kt.animateProperty({node:X,duration:200,properties:{height:Rt-210}}).play()):(u.style["-webkit-transform"]="translate3d(0,-242px,0)",u.style.transform="translate3d(0,-242px,0)",setTimeout(function(){$n(Rt-242)},180))}function b(e){p&&clearTimeout(p),d?l.remove(d,"activeFoot"):y();if(d===e.target){g(),d=null;return}d=e.target;var i=d.innerHTML.slice(0,1);i==="H"?u.innerHTML=t:i==="T"?u.innerHTML=n:u.innerHTML=r,l.add(d,"activeFoot")}var t="<strong id = 'infoPaneTitle'>Help</strong><p>Zoom in and out with the <b>Zoom buttons</b> or the mousewheel. Shift and drag on the map to zoom to a selected area.</p><p>Go to the full extent of the data with the <b>Globe</b>.</p><p>Select map or satellite view with the <b>Basemap buttons</b>.</p><p>Browse through projects in the table. Sort the table with the column headers and collapse it with the <b>Slider</b>.</p><p>Turn on a raster by double-clicking it in the table or map, or checking its checkbox in the table.</p><ul>When a raster is displayed:<br/><li>With the <b>Identify</b> tool, click to display NAVD88 elevation at any point.</li><li>Draw a cross-section graph with the <b>Profile tool</b>. Click the start and end points of the line to generate a graph in a draggable window. Hover over points to display elevation.</li></ul><p>Use the <b>Measure tool</b> to calculate distance, area, or geographic location.</p><p>Project information and Identify results are displayed in the right pane. Toggle this pane with the <b>Arrow button</b>.</p><p>Use the <b>Time slider</b> to filter the display of features by date. Drag the start and end thumbs or click a year to only display data from that year.</p>",n="<strong id = 'infoPaneTitle'>Terms of Use</strong><p>The data displayed in this application is for qualitative purposes only. Do not use the data as displayed in rigorous analyses. If downloading the data, familiarize yourself with the metadata before use. Not for use as a navigation aid. The data reflects measurements taken at specific time periods and the Department of Water Resources makes no claim as to the current state of these channels, nor to the accuracy of the data as displayed. Do not share or publish this data without including proper attribution.</p>",r="<strong id = 'infoPaneTitle'>Contact</strong><p>For information on scheduling new bathymetric surveys, contact  <a href = 'mailto:shawn.mayr@water.ca.gov?subject = Bathymetric Survey'>Shawn Mayr</a>, (916) 376-9664.</p><p>For information on this application or the data contained herein, contact  <a href = 'mailto:wyatt.pearsall@water.ca.gov?subject = Bathymetry Catalog'>Wyatt Pearsall</a>, (916) 376-9643.</p>",u=a.byId("infopane"),f=a.byId("foot"),h=0,p,d;i||(c(u,"mouseover",function(e){v(e)}),c(u,"mouseout",function(e){v(e)})),c($,"mouseover",function(e){var t=V.firstChild.textContent.split(" ").join(""),n=new Date(V.firstChild.nextElementSibling.textContent.slice(-11)),r=n.getFullYear(),i=n.getUTCMonth()+1,s=n.getUTCDate();i+="",s+="",i=i.length===1?"0"+i:i,s=s.length===1?"0"+s:s,$.href="zips/"+t+"_"+r+"_"+i+"_"+s+".zip"}),c(f,"mousedown",b),c(e,"resize",function(t){var n=o=e.innerHeight;Kn(),Xn(),Jn(),ht=n>940?11:n>475?10:9,+V.style.marginTop.slice(0,1)&&(V.style.marginTop=(n-257)/2-15+"px"),s?(kt.animateProperty({node:W,duration:300,properties:{height:n-225}}).play(),h?kt.animateProperty({node:X,duration:300,properties:{height:n-507}}).play():kt.animateProperty({node:X,duration:300,properties:{height:n-257}}).play()):(W.style.height=n-225+"px",h?X.style.height=n-507+"px":X.style.height=n-257+"px")}),Kn()}(),i||(en=function(){function t(){s?kt.animateProperty({node:e,duration:200,properties:{right:30}}).play():l.replace(e,"movd","legend")}function n(){s?kt.animateProperty({node:e,duration:200,properties:{right:-255}}).play():l.replace(e,"legend","movd")}var e=a.byId("legend");return{node:e,show:t,hide:n}}()),c(et,"mousedown",function(e){pt.centerAndZoom(ct,ht)}),qt=j(Y),c.once(K,"mousedown",function(e){var t={map:pt,rastersShowing:wn,eventFeatures:tn,chartNames:yn,chartDates:gn,tooltip:qt};R=1,Vt=D(bt,_(),K,ot,hn,t),Vt.init(e)}),c.once(Q,"mousedown",function(e){var t={map:pt,rastersShowing:wn,eventFeatures:tn,names:yn,dates:gn,tooltip:qt};$t=P(Q,ot,hn,t),$t.init(e)}),Jt=H(G,new k(vt,new d([0,0,0]),2),new A({size:6,color:new d([0,0,0])}),{map:pt,eventFeatures:tn}),c.once(G,"mousedown",function(e){R=1,Jt.init(e)}),Lt.on("mouse-over",function(e){_t&&_t.remove(),_t=Lt.on("mouse-move",On)});function On(e){if(Date.now()<jt+100)return;if(Bt){Bt=!1;return}Mn(e,0),jt=Date.now()}Lt.on("mouse-out",function(e){Wt||(pt.setMapCursor("default"),Wt=1),_t.remove(),_t=null,Mn(null,0)}),Lt.on("mouse-down",function(e){ln=e.pageX,cn=e.pageY}),Lt.on("mouse-up",function(t){if(t.pageX<ln+10&&t.pageX>ln-10&&t.pageY<cn+10&&t.pageY>cn-10){Bt=!0;var n=t.graphic.attributes,r=n.OBJECTID;r!==Ht&&(e.clearTimeout(Pt),Ht=r,Pt=e.setTimeout(Yn,400),Mn(t,1),Ot.clickSort()||Ot.scrollToRow(r))}}),Lt.on("dbl-click",function(e){var t,n=e.graphic.attributes.OBJECTID,r=Yt.indexOf(n)===-1;r&&(Mn(e,1),Ot.scrollToRow(n)),t=Mn.prevArr,t.length&&(pt.getScale()>73e3&&An(Hn(t[0])._extent.expand(1.3)),Ot.setVisibleRasters(t,0),Ot.checkImageInputs(t))}),Mn.prevArr=[],Mn.currArr=[],Mn.binLength=Gt.length,Mn.lastClickBin=[],function(t){t.requestAnimationFrame||function(e){var t="equestAnimationFrame",n="r"+t,r="R"+t;e[n]=e["webkit"+r]||e["moz"+r]||e[n]||function(e){setTimeout(e,16)}}(t)}(e),qn(),dt.refresh()})}),define("bathcat.js",function(){});