require(["esri/esri","dgrid/dgrid","dojox/dojox","modules/modules"],function(){require(["dijit/layout/BorderContainer","dijit/layout/ContentPane","dojo/_base/declare","dojo/parser","dojo/dom-construct","dojo/dom","dojo/query","dojo/dom-class","dojo/on","dojo/ready","dojo/aspect","dojo/_base/Color","dojo/has","esri/map","esri/config","esri/SpatialReference","esri/geometry/Extent","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/tasks/GeometryService","esri/tasks/geometry","esri/dijit/TimeSlider","esri/TimeExtent","esri/dijit/Scalebar","esri/renderers/SimpleRenderer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/geometry/Point","modules/geosearch","modules/symbols","modules/popup","modules/crosstool","modules/identtool","modules/measuretool","modules/clearnode","modules/tooltip","modules/getdate","modules/gridconnector","modules/setvisiblerasters","modules/basemap","modules/zoomlevel","require"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R){j(function(){function a(){for(var a=1,c=Sb+1;c>a;a++)kc[a]&&(Wb.isStored(a)?b(a,"hi",0):b(a,"",0))}function b(a,b,e){if(!e||!(b&&gc[a]||!b&&!gc[a])){var f,g,i=F[Yb()],j=d(a);j&&(f=Rb[a-1].attributes.Date,color=c(f),e&&(g=Vb.oidToRow(a),""!==b?(h.add(g,"highl"+color),gc[a]=1):(h.remove(g,"highl"+color),gc[a]=0)),Q.get()>12&&(b?b="":color+="thin"),j.setSymbol(i[color+b]))}}function c(a){return 129384e7>a?"gre":1325376e6>a?"mag":13570272e5>a?"blu":13885632e5>a?"red":14200992e5>a?"bro":void 0}function d(a){return Mb.graphics[a-1]}function j(a){var b=a.target.parentNode;return b.children[2]?+b.children[2].innerHTML:"dgrid-input"==a.target.className?+b.parentNode.children[2].innerHTML:void 0}function k(){if(wb){var a=tb.createElement("div"),b=tb.createElement("div"),c=zb/2;a.id="dataTab",b.id="gridTab",a.className="atop unselectable",b.className="atop unselectable",a.innerHTML='<strong class="sideways">Info</strong>',b.innerHTML='<strong class="sideways">Grid</strong>',a.style.top=c-100+"px",b.style.top=c-100+"px",Bb.appendChild(a),Bb.appendChild(b)}else{var d=tb.createElement("div");d.id="closeRp",d.className="mov atop unselectable",d.innerHTML='<div id="arro"></div>',Bb.appendChild(d);var e=tb.createElement("img");e.id="legend",e.className="legend atop",e.title="Image Legend (NAVD88 ft)",e.src="",tb.body.appendChild(e)}}function v(){bb=tb.createElement("div"),eb=tb.createElement("div"),wb?(bb.id="gridView",eb.id="dataView",bb.innerHTML='<div id="gridNode"></div>'):(bb.id="lP",eb.id="rP",eb.className="mov atop",bb.innerHTML='<div id="gridNode"></div><div id="lPSplitter"><div class="splitterThumb"></div></div>'),eb.innerHTML='<div id="dataCon"><div id="dataNode"></div><div id="downloadNode"><strong id="dlTitle">Downloads:</strong><a class="downloadlink" href="zips/Metadata.zip" target="_self">Metadata</a><a class="downloadlink" id="dlLink" href="tryagain.zip" target="_self">Dataset</a></div></div><div id="infopane"></div><div id="foot" class="unselectable"><div class="footDiv">Help</div><div class="footDiv">Terms of Use</div><div class="footDiv">Contact</div></div>',Bb.appendChild(bb),Bb.appendChild(eb),W(),Z(),wb?U():(X(),T())}function S(){function a(a){if("B"===a.target.tagName){var b=a.target.textContent.slice(0,3);switch(b){case"Zoo":nb||(nb=f.byId("mapDiv_zoom_slider")),h.toggle(nb,"helpglow");break;case"Glo":h.toggle(f.byId("fullExtentButton"),"helpglow");break;case"Bas":h.toggle(pb,"helpglow"),h.toggle(qb,"helpglow");break;case"Sli":h.toggle(db,"helpglow");break;case"Ide":h.toggle(kb,"helpglow");break;case"Pro":h.toggle(jb,"helpglow");break;case"Mea":h.toggle(lb,"helpglow");break;case"Arr":var c=f.byId("closeRp");c&&h.toggle(c,"helpglow");break;case"Tim":h.toggle(f.byId("timeSlider"),"helpglow")}}}function b(a){if(k&&clearTimeout(k),l?h.remove(l,"activeFoot"):d(),l===a.target)return e(),void(l=null);l=a.target;var b=l.innerHTML.slice(0,1);p.innerHTML="H"===b?m:"T"===b?n:o,h.add(l,"activeFoot")}function c(){k=0,K(p),r=0,p.style.borderTop="none"}function d(){r=1,p.style.borderTop="2px solid #99ceff",xb?(p.style.width=fb.offsetWidth+16+"px",yb.animateProperty({node:p,duration:200,properties:{bottom:0}}).play(),yb.animateProperty({node:fb,duration:200,properties:{height:ec-210}}).play()):(p.style["-webkit-transform"]="translate3d(0,-242px,0)",p.style.transform="translate3d(0,-242px,0)",setTimeout(function(){$(ec-242)},180))}function e(){k=sb.setTimeout(c,205),xb?(yb.animateProperty({node:p,duration:200,properties:{bottom:-210}}).play(),yb.animateProperty({node:fb,duration:200,properties:{height:ec}}).play()):($(ec),p.style["-webkit-transform"]="translate3d(0,0,0)",p.style.transform="translate3d(0,0,0)")}function g(a){var b=a.target;"STRONG"===b.tagName&&(b=b.parentNode);var c=+b.getAttribute("data-oid");b.style.cursor="default",Wb.clearAndSet(c,Nb.graphics[c-1].attributes)}function j(){var a=gb.firstChild.textContent.split(" ").join(""),b=new Date(gb.firstChild.nextElementSibling.textContent.slice(-11)),c=b.getFullYear(),d=b.getUTCMonth()+1,e=b.getUTCDate();d+="",e+="",d=1===d.length?"0"+d:d,e=1===e.length?"0"+e:e,hb.href="zips/"+a+"_"+c+"_"+d+"_"+e+".zip"}var k,l,m="<strong id = 'infoPaneTitle'>Help</strong><p>Zoom in and out with the <b>Zoom buttons</b> or the mousewheel. Shift and drag on the map to zoom to a selected area.</p><p>Go to the full extent of the data with the <b>Globe</b>.</p><p>Select map or satellite view with the <b>Basemap buttons</b>.</p><p>Browse through projects in the table. Sort the table with the column headers and collapse it with the <b>Slider</b>.</p><p>Turn on a raster by double-clicking it in the table or map, or checking its checkbox in the table.</p><ul>When a raster is displayed:<br/><li>With the <b>Identify</b> tool, click to display NAVD88 elevation at any point.</li><li>Draw a cross-section graph with the <b>Profile tool</b>. Click the start and end points of the line to generate a graph in a draggable window. Hover over points to display elevation.</li></ul><p>Use the <b>Measure tool</b> to calculate distance, area, or geographic location.</p><p>Project information and Identify results are displayed in the right pane. Toggle this pane with the <b>Arrow button</b>.</p><p>Use the <b>Time slider</b> to filter the display of features by date. Drag the start and end thumbs or click a year to only display data from that year.</p>",n="<strong id = 'infoPaneTitle'>Terms of Use</strong><p>The data displayed in this application is for qualitative purposes only. Do not use the data as displayed in rigorous analyses. If downloading the data, familiarize yourself with the metadata before use. Not for use as a navigation aid. The data reflects measurements taken at specific time periods and the Department of Water Resources makes no claim as to the current state of these channels, nor to the accuracy of the data as displayed. Do not share or publish this data without including proper attribution.</p>",o="<strong id = 'infoPaneTitle'>Contact</strong><p>For information on scheduling new bathymetric surveys, contact  <a href = 'mailto:shawn.mayr@water.ca.gov?subject = Bathymetric Survey'>Shawn Mayr</a>, (916) 376-9664.</p><p>For information on this application or the data contained herein, contact  <a href = 'mailto:wyatt.pearsall@water.ca.gov?subject = Bathymetry Catalog'>Wyatt Pearsall</a>, (916) 376-9643.</p>",p=f.byId("infopane"),q=f.byId("foot"),r=0;i(q,"mousedown",b),i(hb,"mouseover",j),wb?i(gb,".multiSelect:touchstart",g):(i(gb,".multiSelect:mousedown",g),i(p,"mouseover",a),i(p,"mouseout",a)),_()}function T(){function a(){var a=0,b=k.length;if(n=1,m.style.backgroundPosition="-32px -16px",xb)for(;b>a;a++)k[a]===eb?yb.animateProperty({node:k[a],duration:300,properties:{marginRight:0}}).play():yb.animateProperty({node:k[a],duration:300,properties:{marginRight:285}}).play();else for(;b>a;a++)h.add(k[a],"movd")}function b(){var a=0,b=k.length;if(n=0,ib.style.display="none",m.style.backgroundPosition="-96px -16px",xb)for(;b>a;a++)k[a]===eb?yb.animateProperty({node:k[a],duration:250,properties:{marginRight:-285}}).play():yb.animateProperty({node:k[a],duration:250,properties:{marginRight:0}}).play();else for(;b>a;a++)h.remove(k[a],"movd")}function c(){b(),Wb.clearAll()}function d(){gb.style.marginTop=0,K(gb),gb.innerHTML=Db,sb.setTimeout(a,0)}function e(b,d){if(!Wb.selected.length)return void c();if(n)if(xb){var e={node:fb,duration:150,properties:{opacity:0},onEnd:function(){b(d),yb.fadeIn({node:fb}).play()}};yb.animateProperty(e).play()}else gb.style.opacity=0,ib.style.opacity=0,sb.setTimeout(function(){b(d),gb.style.opacity=1,ib.style.opacity=1},125);else b(d),a()}function j(){n?c():d()}var k=g(".mov"),l=f.byId("closeRp"),m=f.byId("arro"),n=0;i(l,"mousedown",j),ab=V(e),sb.setTimeout(d,300)}function U(){function a(){j.firstElementChild.innerText="Info",K(gb),gb.innerHTML=Db}function b(b,e){return o&&!Wb.selected.length?(a(),d(eb)):(j.firstElementChild.innerText="Data",b(e),void((!m||o)&&(c(eb,r),n=1,o=1)))}function c(a,b,c){a.style.cssText=c,a.style.zIndex=++l,h.add(b,"tabglow")}function d(a,b){a.style.cssText=t,h.remove(b,"tabglow"),setTimeout(function(){l--,a.style.zIndex=1e3},155)}function e(){n&&o?(d(eb,j),n=0,o=0):(c(eb,j,r),n=1,o=1)}function g(){m&&!o?(d(bb,k),m=0,n?o=1:l=1e3):(c(bb,k,s),m=1,o=0)}var j=f.byId("dataTab"),k=f.byId("gridTab"),l=1e3,m=0,n=0,o=0,p="translate3d("+Ab+"px,0,0);",q="translate3d(-"+Ab+"px,0,0);",r="-webkit-transform:"+p+"transform:"+p,s="-webkit-transform:"+q+"transform:"+q,t="-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);z-index:9999";i(j,"touchstart",e),i(k,"touchstart",g),ab=V(b),a()}function V(a){function b(b){a(d,b)}function c(a){switch(a.Project.slice(0,2)){case"GL":return"Grant Line Canal";case"OR":return"Old River";case"DC":return"Doughty Cut"}}function d(a){var b,c=Wb.selected.length;if(a)a&&a.Project&&e(a,a.OBJECTID-1);else if(1===c)b=Wb.selected[0],e(Nb.graphics[b-1].attributes,b-1);else{for(var d="<h2>"+c+" projects selected</h2><div id='multiSelectWrapper'>",f=0;f<Wb.selected.length;f++)b=Wb.selected[f],d+="<span class='multiSelect' data-oid='"+b+"'><strong>"+jc[b-1]+": </strong>"+ic[b-1]+"</span><br/>";d+="</div>",ib.style.display="none",gb.style.marginTop=ec/2-65+"px",gb.innerHTML=d}}function e(a,b){gb.style.marginTop="0",gb.innerHTML="<h2>"+jc[b]+"</h2><span class = 'projectinfo'><strong>Collection Date: </strong>"+ic[b]+"</span><span class = 'projectinfo'><strong>Client: </strong>"+(a.Client||"Groundwater Supply Assessment Section, DWR")+"</span><span class = 'projectinfo'><strong>Waterways Covered: </strong>"+(a.Waterways||c(a))+"</span><span class = 'projectinfo'><strong>Purpose: </strong>"+(a.Purpose||f)+"</span>",ib.style.display="block"}var f="Data was collected to determine the sediment impacts of the agricultural barriers at Middle River, Grant Line Canal, and Old River near the Delta Mendota Canal. Measurements have been made since 1998 at nineteen stations. Multibeam/RTK bathymetry has been gathered since 2011. Four stations have monthly data, the rest are visited in the Fall and Spring.";return b}function W(){fb=f.byId("dataCon"),gb=f.byId("dataNode"),ib=f.byId("downloadNode"),hb=f.byId("dlLink"),cb=f.byId("gridNode"),db=f.byId("lPSplitter"),jb=f.byId("cros"),kb=f.byId("ident"),lb=f.byId("mea"),mb=f.byId("toolOffMessage"),nb=f.byId("mapDiv_zoom_slider"),ob=f.byId("fullExtentButton"),pb=f.byId("topo"),qb=f.byId("sat"),rb=f.byId("timeDiv")}function X(){var a=bb.clientWidth+6;xb?Cb.style.left=a+"px":(Cb.style["-webkit-transform"]="translate3d("+a+"px,0, 0)",Cb.style.transform="translate3d("+a+"px,0, 0)"),Cb.style.width=Ab-a+"px"}function Y(){var a=Ab,b=Y.appTitle=Y.appTitle?Y.appTitle:f.byId("appTitle");700>a&&0!==Y.fullText?(b.innerHTML="Bathymetry",Y.fullText=0):a>699&&0===Y.fullText&&(b.innerHTML="Delta Bathymetry Catalog",Y.fullText=1)}function Z(){wb?$(zb/2-32):(eb.style.height=zb-225+"px",$(zb-257))}function $(a){fb.style.height=a+"px"}function _(){return ec=wb?zb-32:zb-257}var ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb=window,tb=document,ub=tb.location.protocol,vb=tb.location.origin,wb=m("touch"),xb=tb.all&&tb.addEventListener&&!sb.atob?!0:!1,yb=xb?R("dojo/_base/fx",function(a){return a}):null,zb=sb.innerHeight,Ab=sb.innerWidth,Bb=f.byId("mainWindow"),Cb=f.byId("mapDiv"),Db="<p>The <strong>Delta Bathymetry Catalog</strong> houses the complete set of multibeam bathymetric data collected by the Bathymetry and Technical Support section of the California Department of Water Resources.</p><p>Click on a feature in the map or table to bring up its <strong>description</strong>. Double-click to view the <strong>raster image</strong>.</p> <p><strong>Download</strong> data as text files from the descrption pane.</p> <p><strong>Measure</strong> distances, <strong>identify</strong> raster elevations, and draw <strong>profile graphs</strong> with the tools at the top-right.</p> <p>Change what displays by <strong>collection date</strong> with the slider at bottom-right. <strong>Sort</strong> by date and name with the table's column headers.</p> <p>See the <strong>help</strong> below for further information.</p>";k(),v(),Y(),tb.body.style.visibility="visible",o.defaults.io.corsDetection=!1,o.defaults.io.corsEnabledServers.push(vb),o.defaults.geometryService=new u(ub+"//sampleserver3.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer");var Eb,Fb=vb+"/arcgis/rest/services/Public/bathymetry_rasters/MapServer",Gb=ub+"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",Hb=new p(102100),Ib=new q(-13612e3,4519e3,-13405e3,4662600,Hb),Jb=zb>940?11:zb>475?10:9;Eb=new D(wb?{x:-13528681.36062705,y:4583780.268055417,spatialReference:Hb}:{x:-13523942.264873397,y:4586455.564045421,spatialReference:Hb});var Kb=new n(Cb,{extent:Ib,center:Eb,zoom:Jb});window.map=Kb;var Lb,Mb,Nb,Ob=new t(Gb),Pb=new s(Fb,{id:"raster"});Kb.addLayer(Ob),Pb.setVisibleLayers([-1]);var Qb=window.DATA_OUTLINES,Rb=Qb.features,Sb=Rb.length,Tb=new B(B.STYLE_SOLID,new A(A.STYLE_SOLID,new l([255,255,255,0]),1),new l([0,0,0,0])),Ub={geometryType:"esriGeometryPolygon",spatialReference:Hb,displayFieldName:"OBJECTID",fields:[{name:"OBJECTID",type:"esriFieldTypeOID"},{name:"Project",type:"esriFieldTypeString"},{name:"Date",type:"esriFieldTypeDate"},{name:"Waterways",type:"esriFieldTypeString"},{name:"Method",type:"esriFieldTypeString"},{name:"Client",type:"esriFieldTypeString"},{name:"Purpose",type:"esriFieldTypeString"}]};Mb=new r({featureSet:window.TIGHT_OUTLINES,layerDefinition:{geometryType:"esriGeometryPolygon",spatialReference:Hb,displayFieldName:"Shape_Length",fields:[{name:"OBJECTID",type:"esriFieldTypeOID"}]}},{id:"tiout",mode:r.MODE_SNAPSHOT}),Nb=new r({layerDefinition:Ub,featureSet:Qb},{id:"out",mode:r.MODE_SNAPSHOT,outFields:["*"]}),Mb.setRenderer(new z(Tb)),Nb.setRenderer(new z(Tb)),Kb.addLayer(Mb),Kb.addLayer(Nb),Mb.on("graphic-node-add",function(a){kc[a.graphic.attributes.OBJECTID]||a.node.setAttribute("class","hiddenPath")}),Mb.on("update-end",function(){a(Mb.graphics)}),Lb=new t(ub+"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"),Kb.addLayer(Lb),Lb.hide();var Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc=[Nb],ec=_(),fc=new Array(Sb),gc=new Array(Sb+1),hc=new Array(Sb),ic=new Array(Sb),jc=new Array(Sb),kc=new Array(Sb+1),lc={};!function(){for(var a,b="Soil Sed. ",c=0;Sb>c;c++)a=Rb[c].attributes,fc[c]=c,gc[c]=0,kc[c]=1,lc[c+1]=0,ic[c]=M(a.Date),jc[c]=a.Project.length<6?b+a.Project:a.Project}(),gc[Sb]=0,kc[Sb]=1,function(){for(var a=0;Sb>a;a++){var b={},c=Rb[a].attributes;b.__Date=c.Date,b.Date=ic[a],b.Project=jc[a],b.OBJECTID=c.OBJECTID,hc[a]=b}}(),Wb=E(Nb,kc,b,ab),Vb=N(hc,cb,bb,db,Pb,kc,lc,d,X,Kb),$b=[{tool:null,anchor:jb,eventFeatures:dc},{tool:null,anchor:kb,eventFeatures:dc}],wb||(cc=function(){function a(){xb?yb.animateProperty({node:c,duration:200,properties:{right:30}}).play():h.replace(c,"movd","hiddenLegend")}function b(){xb?yb.animateProperty({node:c,duration:200,properties:{right:-255}}).play():h.replace(c,"hiddenLegend","movd")}var c=f.byId("legend");return{node:c,show:a,hide:b}}()),Xb=O(Kb,Pb,wb,$b,cc,kc),function(){function b(a){var b=Wb.selected.length;Vb.timeUpdate(a),b!==Wb.selected.length&&ab(null)}function c(a){var b=a.target.innerHTML;l.setThumbIndexes("A"===b.charAt(0)?[0,l.timeStops.length]:[6*(b-2010),6*(b-2010)+6])}function d(a){h.add(a,"tsHighlight")}function f(a){h.remove(a,"tsHighlight")}function j(){"sat"===Yb()?(h.add(k,"whiteScaleLabels"),h.add(p,"satLabels")):(h.remove(k,"whiteScaleLabels"),h.remove(p,"satLabels"))}new y({map:Kb});var k=g(".esriScalebar")[0];Yb=P([{name:"topo",layer:Ob,anchor:pb},{name:"sat",layer:Lb,anchor:qb}],Kb,function(){j(),a(Mb.graphics)}),i(ob,"mousedown",function(){Kb.centerAndZoom(Eb,Jb)});var l,m,n=new x(new Date("01/01/2010 UTC"),new Date("12/31/2014 UTC"));Kb.setTimeExtent(n),l=new w({style:"width:300px;",id:"timeSlider",intermediateChanges:!0},e.create("div",null,rb)),l.setThumbCount(2),l.createTimeStopsByTimeInterval(n,2,"esriTimeUnitsMonths"),m=l.timeStops.length,l.setThumbIndexes([0,m]),l.setTickCount(Math.ceil(m/2)),l.startup(),l.on("time-extent-change",b),Kb.setTimeSlider(l);var o,p=tb.createElement("div"),q=l.fullTimeExtent.endTime.getFullYear()+1,r=[];p.className="labelCon atop",wb&&(p.className+=" labelTouch",rb.style.display="none");for(var s=2010;q>=s;s++){var t=tb.createElement("div");r.push(t),t.className="tsLabel",s===q?(t.innerText="All",o=t):t.innerText=s,p.appendChild(t)}Cb.appendChild(p),d(o),wb?i(p,".tsLabel:touchstart",function(a){f(o),o=a.target,d(o),setTimeout(function(){c(a)},0)}):(i(p,".tsLabel:mouseover",function(a){a.target!==o&&d(a.target)}),i(p,".tsLabel:mouseout",function(a){a.target!==o&&f(a.target)}),i(p,".tsLabel:mousedown",function(a){f(o),o=a.target,c(a)})),j()}(),Zb=L(mb),i.once(jb,"mousedown",function(a){var b={map:Kb,rastersShowing:lc,eventFeatures:dc,chartNames:jc,chartDates:ic,tooltip:Zb};_b=H(Pb,G(),jb,Wb,b),$b[0].tool=_b,_b.init(a)}),i.once(kb,"mousedown",function(a){var b={map:Kb,rastersShowing:lc,eventFeatures:dc,names:jc,dates:ic,tooltip:Zb};ac=I(kb,Fb,fc,b),$b[1].tool=ac,ac.init(a)}),bc=J(lb,new A(A.STYLE_SOLID,new l([0,0,0]),2),new C({size:6,color:new l([0,0,0])}),{map:Kb,eventFeatures:dc}),i.once(lb,"mousedown",function(a){bc.init(a)}),function(){function a(){m=null}function c(c){var d,e=c.target,f=j(c);f&&(Wb.isStored(f)||"INPUT"!=e.tagName||!e.checked)&&(b(f,"hi",1),e!==m&&(window.clearTimeout(l),m=e,l=sb.setTimeout(a,400),d=Nb.graphics[f-1].attributes,Wb.isStored(f)&&1===Wb.selected.length?(Wb.clear(f,1,1),ab(null)):Wb.clearAndSet(f)))}function e(a){var b,c=j(a);if(c){var e=d(c);if(!e)return;"div"!==a.target.localName&&(Wb.clearAndSet(c),b=Vb.getInputBox(c),Kb.setExtent(e._extent.expand(1.3)),b.checked||(b.checked=!0,lc[c]=1,Xb.add(c),Xb.run(0)))}}function g(a){return function(b){a(b),Wb.selected.length&&Vb.scrollToRow(Wb.selected[0])}}function h(a){if(!(Date.now()<o+100)){if(n)return void(n=!1);Wb(a,0,0),o=Date.now()}}var k,l,m,n=!1,o=0,p=1,q=f.byId("gridNode-header").firstChild.children;Vb.gridSorter.date(),wb||(Vb.grid.on(".dgrid-cell:mousedown",c),Vb.grid.on(".dgrid-cell:dblclick",e),Vb.grid.on(".dgrid-cell:mouseover",function(a){var c=j(a);c&&b(c,"hi",1)}),Vb.grid.on(".dgrid-cell:mouseout",function(a){var c=j(a);Wb.isStored(c)||b(c,"",1)}),i(q[0],"mousedown",g(Vb.gridSorter.name)),i(q[1],"mousedown",g(Vb.gridSorter.date))),Nb.on("mouse-over",function(){k&&k.remove(),k=Nb.on("mouse-move",h),p&&(Kb.setMapCursor("pointer"),p=0)}),Nb.on("mouse-out",function(){p||(Kb.setMapCursor("default"),p=1),k.remove(),k=null,Wb(null,0,0)}),Nb.on("mouse-down",function(a){mouseDownX=a.pageX,mouseDownY=a.pageY}),Nb.on("mouse-up",function(b){if(b.pageX<mouseDownX+10&&b.pageX>mouseDownX-10&&b.pageY<mouseDownY+10&&b.pageY>mouseDownY-10){n=!0;var c=b.graphic.attributes,d=c.OBJECTID;d!==m&&(sb.clearTimeout(l),m=d,l=sb.setTimeout(a,400),Wb(b,1,0),Wb.selected.length>1&&Vb.gridSorter.ascendingName(),Vb.scrollToRow(d))}}),Nb.on("dbl-click",function(a){var b=a.graphic.attributes.OBJECTID,c=-1===Wb.selected.indexOf(b);c&&(Wb(a,1,0),Vb.scrollToRow(b)),Wb.selected.length&&(Kb.getScale()>73e3&&Kb.setExtent(d(Wb.selected[0])._extent.expand(1.3)),Xb(Wb.selected,0),Vb.checkImageInputs(Wb.selected))})}(),function(a){a.requestAnimationFrame||function(a){var b="equestAnimationFrame",c="r"+b,d="R"+b;a[c]=a["webkit"+d]||a["moz"+d]||a[c]||function(a){setTimeout(a,16)}}(a)}(sb),i(sb,"resize",function(){var a=zb=sb.innerHeight;Ab=sb.innerWidth,_(),X(),Y(),Jb=a>940?11:a>475?10:9,+gb.style.marginTop.slice(0,1)&&(gb.style.marginTop=(a-257)/2-15+"px"),xb?(yb.animateProperty({node:eb,duration:300,properties:{height:a-225}}).play(),yb.animateProperty({node:fb,duration:300,properties:{height:a-257}}).play()):(eb.style.height=a-225+"px",fb.style.height=a-257+"px")}),S(),Mb.refresh()})})});